import{cc as pe,bX as de,g as D,cn as fe,F as O,E as N,G as ge,ay as he,P as ee,L as me}from"./Layer-3211d6ef.js";import{F as w}from"./Vector-163f0152.js";import{L as k}from"./LineString-d3d6f49c.js";import{a as te,M as ye}from"./MultiPolygon-f290964a.js";import{m as y,X as Ee,p as A,c as se,a as j,b as x,d as U,e as u,r as h,f as c,g as F,h as _,i as K,w as m,j as M,k as ne,l as P,n as Re,o as re,O as G,q as Y,s as _e}from"./KML-c4ac6c3a.js";import{t as T}from"./Feature-5a984f38.js";import{T as Te}from"./TextFeature-89415c76.js";import{J as Pe}from"./JSONFeature-2245ccdf.js";import{M as Ae}from"./MultiPoint-e6eff345.js";const xe={ADD_FEATURES:"addfeatures"};class Se extends he{constructor(e,s,t,r){super(e),this.features=t,this.file=s,this.projection=r}}class Ne extends pe{constructor(e){e=e||{},super({handleEvent:de}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const s=e.formatConstructors?e.formatConstructors:[];for(let t=0,r=s.length;t<r;++t){let o=s[t];typeof o=="function"&&(o=new o),this.formats_.push(o),this.readAsBuffer_=this.readAsBuffer_||o.getType()==="arraybuffer"}this.projection_=e.projection?D(e.projection):null,this.dropListenKeys_=null,this.source_=e.source||null,this.target=e.target?e.target:null}handleResult_(e,s){const t=s.target.result,r=this.getMap();let o=this.projection_;o||(o=fe(),o||(o=r.getView().getProjection()));let i;const a=this.formats_;for(let l=0,p=a.length;l<p;++l){const f=a[l];let E=t;this.readAsBuffer_&&f.getType()!=="arraybuffer"&&(i===void 0&&(i=new TextDecoder().decode(t)),E=i);const R=this.tryReadFeatures_(f,E,{featureProjection:o});if(R&&R.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(R)),this.dispatchEvent(new Se(xe.ADD_FEATURES,e,R,o));break}}}registerListeners_(){const e=this.getMap();if(e){const s=this.target?this.target:e.getViewport();this.dropListenKeys_=[O(s,N.DROP,this.handleDrop,this),O(s,N.DRAGENTER,this.handleStop,this),O(s,N.DRAGOVER,this.handleStop,this),O(s,N.DROP,this.handleStop,this)]}}setActive(e){!this.getActive()&&e&&this.registerListeners_(),this.getActive()&&!e&&this.unregisterListeners_(),super.setActive(e)}setMap(e){this.unregisterListeners_(),super.setMap(e),this.getActive()&&this.registerListeners_()}tryReadFeatures_(e,s,t){try{return e.readFeatures(s,t)}catch{return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(ge),this.dropListenKeys_=null)}handleDrop(e){const s=e.dataTransfer.files;for(let t=0,r=s.length;t<r;++t){const o=s.item(t),i=new FileReader;i.addEventListener(N.LOAD,this.handleResult_.bind(this,o)),this.readAsBuffer_?i.readAsArrayBuffer(o):i.readAsText(o)}}handleStop(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}}const Ot=Ne,g=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],we="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Le={rte:oe,trk:ie,wpt:ae},Ie=y(g,{rte:U(oe),trk:U(ie),wpt:U(ae)}),Oe=y(g,{text:u(h,"linkText"),type:u(h,"linkType")}),Fe=y(g,{rte:c(tt),trk:c(st),wpt:c(rt)});class Me extends Ee{constructor(e){super(),e=e||{},this.dataProjection=D("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let s=0,t=e.length;s<t;++s){const r=e[s];if(this.readExtensions_){const o=r.get("extensionsNode_")||null;this.readExtensions_(r,o)}r.set("extensionsNode_",void 0)}}readFeatureFromNode(e,s){if(!g.includes(e.namespaceURI))return null;const t=Le[e.localName];if(!t)return null;const r=t(e,[this.getReadOptions(e,s)]);return r?(this.handleReadExtensions_([r]),r):null}readFeaturesFromNode(e,s){if(!g.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const t=A([],Ie,e,[this.getReadOptions(e,s)]);return t?(this.handleReadExtensions_(t),t):[]}return[]}writeFeaturesNode(e,s){s=this.adaptOptions(s);const t=se("http://www.topografix.com/GPX/1/1","gpx"),r="http://www.w3.org/2000/xmlns/";return t.setAttributeNS(r,"xmlns:xsi",j),t.setAttributeNS(j,"xsi:schemaLocation",we),t.setAttribute("version","1.1"),t.setAttribute("creator","OpenLayers"),x({node:t},Fe,qe,e,[s]),t}}const De=y(g,{name:u(h),cmt:u(h),desc:u(h),src:u(h),link:W,number:u(F),extensions:H,type:u(h),rtept:be}),Ge=y(g,{ele:u(_),time:u(K)}),Ce=y(g,{name:u(h),cmt:u(h),desc:u(h),src:u(h),link:W,number:u(F),type:u(h),extensions:H,trkseg:et}),ve=y(g,{trkpt:je}),Xe=y(g,{ele:u(_),time:u(K)}),Ue=y(g,{ele:u(_),time:u(K),magvar:u(_),geoidheight:u(_),name:u(h),cmt:u(h),desc:u(h),src:u(h),link:W,sym:u(h),type:u(h),fix:u(h),sat:u(F),hdop:u(_),vdop:u(_),pdop:u(_),ageofdgpsdata:u(_),dgpsid:u(F),extensions:H}),ke=["text","type"],Ke=y(g,{text:c(m),type:c(m)}),Ye=y(g,["name","cmt","desc","src","link","number","type","rtept"]),Ze=y(g,{name:c(m),cmt:c(m),desc:c(m),src:c(m),link:c(J),number:c(M),type:c(m),rtept:ne(c(V))}),Be=y(g,["ele","time"]),We=y(g,["name","cmt","desc","src","link","number","type","trkseg"]),He=y(g,{name:c(m),cmt:c(m),desc:c(m),src:c(m),link:c(J),number:c(M),type:c(m),trkseg:ne(c(nt))}),Je=_e("trkpt"),Ve=y(g,{trkpt:c(V)}),Qe=y(g,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),$e=y(g,{ele:c(P),time:c(Re),magvar:c(P),geoidheight:c(P),name:c(m),cmt:c(m),desc:c(m),src:c(m),link:c(J),sym:c(m),type:c(m),fix:c(m),sat:c(M),hdop:c(P),vdop:c(P),pdop:c(P),ageofdgpsdata:c(P),dgpsid:c(M)}),ze={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function qe(n,e,s){const t=n.getGeometry();if(t){const r=ze[t.getType()];if(r){const o=e[e.length-1].node;return se(o.namespaceURI,r)}}}function Z(n,e,s,t){return n.push(parseFloat(s.getAttribute("lon")),parseFloat(s.getAttribute("lat"))),"ele"in t?(n.push(t.ele),delete t.ele,e.hasZ=!0):n.push(0),"time"in t?(n.push(t.time),delete t.time,e.hasM=!0):n.push(0),n}function B(n,e,s){let t="XY",r=2;if(n.hasZ&&n.hasM?(t="XYZM",r=4):n.hasZ?(t="XYZ",r=3):n.hasM&&(t="XYM",r=3),r!==4){for(let o=0,i=e.length/4;o<i;o++)e[o*r]=e[o*4],e[o*r+1]=e[o*4+1],n.hasZ&&(e[o*r+2]=e[o*4+2]),n.hasM&&(e[o*r+2]=e[o*4+3]);if(e.length=e.length/4*r,s)for(let o=0,i=s.length;o<i;o++)s[o]=s[o]/4*r}return t}function W(n,e){const s=e[e.length-1],t=n.getAttribute("href");t!==null&&(s.link=t),re(Oe,n,e)}function H(n,e){const s=e[e.length-1];s.extensionsNode_=n}function be(n,e){const s=A({},Ge,n,e);if(s){const t=e[e.length-1],r=t.flatCoordinates,o=t.layoutOptions;Z(r,o,n,s)}}function je(n,e){const s=A({},Xe,n,e);if(s){const t=e[e.length-1],r=t.flatCoordinates,o=t.layoutOptions;Z(r,o,n,s)}}function et(n,e){const s=e[e.length-1];re(ve,n,e);const t=s.flatCoordinates;s.ends.push(t.length)}function oe(n,e){const s=e[0],t=A({flatCoordinates:[],layoutOptions:{}},De,n,e);if(!t)return;const r=t.flatCoordinates;delete t.flatCoordinates;const o=t.layoutOptions;delete t.layoutOptions;const i=B(o,r),a=new k(r,i);T(a,!1,s);const l=new w(a);return l.setProperties(t,!0),l}function ie(n,e){const s=e[0],t=A({flatCoordinates:[],ends:[],layoutOptions:{}},Ce,n,e);if(!t)return;const r=t.flatCoordinates;delete t.flatCoordinates;const o=t.ends;delete t.ends;const i=t.layoutOptions;delete t.layoutOptions;const a=B(i,r,o),l=new te(r,a,o);T(l,!1,s);const p=new w(l);return p.setProperties(t,!0),p}function ae(n,e){const s=e[0],t=A({},Ue,n,e);if(!t)return;const r={},o=Z([],r,n,t),i=B(r,o),a=new ee(o,i);T(a,!1,s);const l=new w(a);return l.setProperties(t,!0),l}function J(n,e,s){n.setAttribute("href",e);const r=s[s.length-1].properties,o=[r.linkText,r.linkType];x({node:n},Ke,G,o,s,ke)}function V(n,e,s){const t=s[s.length-1],o=t.node.namespaceURI,i=t.properties;switch(n.setAttributeNS(null,"lat",String(e[1])),n.setAttributeNS(null,"lon",String(e[0])),t.geometryLayout){case"XYZM":e[3]!==0&&(i.time=e[3]);case"XYZ":e[2]!==0&&(i.ele=e[2]);break;case"XYM":e[2]!==0&&(i.time=e[2]);break}const l=n.nodeName=="rtept"?Be[o]:Qe[o],p=Y(i,l);x({node:n,properties:i},$e,G,p,s,l)}function tt(n,e,s){const t=s[0],r=e.getProperties(),o={node:n};o.properties=r;const i=e.getGeometry();if(i.getType()=="LineString"){const f=T(i,!0,t);o.geometryLayout=f.getLayout(),r.rtept=f.getCoordinates()}const a=s[s.length-1].node,l=Ye[a.namespaceURI],p=Y(r,l);x(o,Ze,G,p,s,l)}function st(n,e,s){const t=s[0],r=e.getProperties(),o={node:n};o.properties=r;const i=e.getGeometry();if(i.getType()=="MultiLineString"){const f=T(i,!0,t);r.trkseg=f.getLineStrings()}const a=s[s.length-1].node,l=We[a.namespaceURI],p=Y(r,l);x(o,He,G,p,s,l)}function nt(n,e,s){const t={node:n};t.geometryLayout=e.getLayout(),t.properties={},x(t,Ve,Je,e.getCoordinates(),s)}function rt(n,e,s){const t=s[0],r=s[s.length-1];r.properties=e.getProperties();const o=e.getGeometry();if(o.getType()=="Point"){const i=T(o,!0,t);r.geometryLayout=i.getLayout(),V(n,i.getCoordinates(),s)}}const Ft=Me,ot=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,it=/^H.([A-Z]{3}).*?:(.*)/,at=/^HFDTE(\d{2})(\d{2})(\d{2})/,lt=/\r\n|\r|\n/;class ct extends Te{constructor(e){super(),e=e||{},this.dataProjection=D("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,s){const t=this.altitudeMode_,r=e.split(lt),o={},i=[];let a=2e3,l=0,p=1,f=-1,E,R;for(E=0,R=r.length;E<R;++E){const S=r[E];let d;if(S.charAt(0)=="B"){if(d=ot.exec(S),d){const z=parseInt(d[1],10),q=parseInt(d[2],10),b=parseInt(d[3],10);let v=parseInt(d[4],10)+parseInt(d[5],10)/6e4;d[6]=="S"&&(v=-v);let X=parseInt(d[7],10)+parseInt(d[8],10)/6e4;if(d[9]=="W"&&(X=-X),i.push(X,v),t!="none"){let I;t=="gps"?I=parseInt(d[11],10):t=="barometric"?I=parseInt(d[12],10):I=0,i.push(I)}let L=Date.UTC(a,l,p,z,q,b);L<f&&(L=Date.UTC(a,l,p+1,z,q,b)),i.push(L/1e3),f=L}}else S.charAt(0)=="H"&&(d=at.exec(S),d?(p=parseInt(d[1],10),l=parseInt(d[2],10)-1,a=2e3+parseInt(d[3],10)):(d=it.exec(S),d&&(o[d[1]]=d[2].trim())))}if(i.length===0)return null;const ce=t=="none"?"XYM":"XYZM",ue=new k(i,ce),$=new w(T(ue,!1,s));return $.setProperties(o,!0),$}readFeaturesFromText(e,s){const t=this.readFeatureFromText(e,s);return t?[t]:[]}}const Mt=ct;class ut extends Pe{constructor(e){super(),e=e||{},this.layerName_=e.layerName,this.layers_=e.layers?e.layers:null,this.dataProjection=D(e.dataProjection?e.dataProjection:"EPSG:4326")}readFeaturesFromObject(e,s){if(e.type=="Topology"){const t=e;let r,o=null,i=null;t.transform&&(r=t.transform,o=r.scale,i=r.translate);const a=t.arcs;r&&Rt(a,o,i);const l=[],p=t.objects,f=this.layerName_;let E;for(const R in p)this.layers_&&!this.layers_.includes(R)||(p[R].type==="GeometryCollection"?(E=p[R],l.push.apply(l,Et(E,a,o,i,f,R,s))):(E=p[R],l.push(le(E,a,o,i,f,R,s))));return l}return[]}readProjectionFromObject(e){return this.dataProjection}}const pt={Point:dt,LineString:gt,Polygon:mt,MultiPoint:ft,MultiLineString:ht,MultiPolygon:yt};function C(n,e){const s=[];let t;for(let r=0,o=n.length;r<o;++r)if(t=n[r],r>0&&s.pop(),t>=0){const i=e[t];for(let a=0,l=i.length;a<l;++a)s.push(i[a].slice(0))}else{const i=e[~t];for(let a=i.length-1;a>=0;--a)s.push(i[a].slice(0))}return s}function dt(n,e,s){const t=n.coordinates;return e&&s&&Q(t,e,s),new ee(t)}function ft(n,e,s){const t=n.coordinates;if(e&&s)for(let r=0,o=t.length;r<o;++r)Q(t[r],e,s);return new Ae(t)}function gt(n,e){const s=C(n.arcs,e);return new k(s)}function ht(n,e){const s=[];for(let t=0,r=n.arcs.length;t<r;++t)s[t]=C(n.arcs[t],e);return new te(s)}function mt(n,e){const s=[];for(let t=0,r=n.arcs.length;t<r;++t)s[t]=C(n.arcs[t],e);return new me(s)}function yt(n,e){const s=[];for(let t=0,r=n.arcs.length;t<r;++t){const o=n.arcs[t],i=[];for(let a=0,l=o.length;a<l;++a)i[a]=C(o[a],e);s[t]=i}return new ye(s)}function Et(n,e,s,t,r,o,i){const a=n.geometries,l=[];for(let p=0,f=a.length;p<f;++p)l[p]=le(a[p],e,s,t,r,o,i);return l}function le(n,e,s,t,r,o,i){let a=null;const l=n.type;if(l){const E=pt[l];l==="Point"||l==="MultiPoint"?a=E(n,s,t):a=E(n,e),a=T(a,!1,i)}const p=new w({geometry:a});n.id!==void 0&&p.setId(n.id);let f=n.properties;return r&&(f||(f={}),f[r]=o),f&&p.setProperties(f,!0),p}function Rt(n,e,s){for(let t=0,r=n.length;t<r;++t)_t(n[t],e,s)}function _t(n,e,s){let t=0,r=0;for(let o=0,i=n.length;o<i;++o){const a=n[o];t+=a[0],r+=a[1],a[0]=t,a[1]=r,Q(a,e,s)}}function Q(n,e,s){n[0]=n[0]*e[0]+s[0],n[1]=n[1]*e[1]+s[1]}const Dt=ut;export{Ot as D,Ft as G,Mt as I,Dt as T};
