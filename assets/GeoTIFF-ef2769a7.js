import{D as St}from"./WebGLTile-360166ba.js";import{T as Tt}from"./TileProperty-b49a7745.js";import{g as ze}from"./_commonjsHelpers-39b5b250.js";import{l as v}from"./index-87bb3bb9.js";import{F as Me,G as At,H as _t,J as Dt,g as Oe,K as Re,w as Ge,N as Et,O as Pt}from"./Layer-763025a3.js";function E(s){return(e,...t)=>Ft(s,e,t)}function j(s,e){return E(Ke(s,e).get)}const{apply:Ft,construct:Ts,defineProperty:As,get:_s,getOwnPropertyDescriptor:Ke,getPrototypeOf:pe,has:Ds,ownKeys:Ct,set:Es,setPrototypeOf:Ps}=Reflect,{iterator:Q,species:Fs,toStringTag:kt,for:Cs}=Symbol,Mt=Object,{create:ye,defineProperty:Ot,freeze:ks,is:Ms}=Mt,Rt=Array,Gt=Rt.prototype,je=Gt[Q],Bt=E(je),qe=ArrayBuffer,vt=qe.prototype;j(vt,"byteLength");const Be=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Be&&j(Be.prototype,"byteLength");const $e=pe(Uint8Array);$e.from;const P=$e.prototype;P[Q];E(P.keys);E(P.values);E(P.entries);E(P.set);E(P.reverse);E(P.fill);E(P.copyWithin);E(P.sort);E(P.slice);E(P.subarray);j(P,"buffer");j(P,"byteOffset");j(P,"length");j(P,kt);const Ut=Uint8Array,He=Uint16Array,me=Uint32Array,Lt=Float32Array,J=pe([][Q]()),Ye=E(J.next),Nt=E(function*(){}().next),Vt=pe(J),zt=DataView.prototype,Kt=E(zt.getUint16),we=WeakMap,Xe=we.prototype,Ze=E(Xe.get),jt=E(Xe.set),Je=new we,qt=ye(null,{next:{value:function(){const e=Ze(Je,this);return Ye(e)}},[Q]:{value:function(){return this}}});function $t(s){if(s[Q]===je&&J.next===Ye)return s;const e=ye(qt);return jt(Je,e,Bt(s)),e}const Ht=new we,Yt=ye(Vt,{next:{value:function(){const e=Ze(Ht,this);return Nt(e)},writable:!0,configurable:!0}});for(const s of Ct(J))s!=="next"&&Ot(Yt,s,Ke(J,s));const Qe=new qe(4),Xt=new Lt(Qe),Zt=new me(Qe),R=new He(512),G=new Ut(512);for(let s=0;s<256;++s){const e=s-127;e<-27?(R[s]=0,R[s|256]=32768,G[s]=24,G[s|256]=24):e<-14?(R[s]=1024>>-e-14,R[s|256]=1024>>-e-14|32768,G[s]=-e-1,G[s|256]=-e-1):e<=15?(R[s]=e+15<<10,R[s|256]=e+15<<10|32768,G[s]=13,G[s|256]=13):e<128?(R[s]=31744,R[s|256]=64512,G[s]=24,G[s|256]=24):(R[s]=31744,R[s|256]=64512,G[s]=13,G[s|256]=13)}const xe=new me(2048);for(let s=1;s<1024;++s){let e=s<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,xe[s]=e|t}for(let s=1024;s<2048;++s)xe[s]=939524096+(s-1024<<13);const q=new me(64);for(let s=1;s<31;++s)q[s]=s<<23;q[31]=1199570944;q[32]=2147483648;for(let s=33;s<63;++s)q[s]=2147483648+(s-32<<23);q[63]=3347054592;const We=new He(64);for(let s=1;s<64;++s)s!==32&&(We[s]=1024);function Jt(s){const e=s>>10;return Zt[0]=xe[We[e]+(s&1023)]+q[e],Xt[0]}function et(s,e,...t){return Jt(Kt(s,e,...$t(t)))}var be={exports:{}};function tt(s,e,t){const r=t&&t.debug||!1;r&&console.log("[xml-utils] getting "+e+" in "+s);const i=typeof s=="object"?s.outer:s,n=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const l=o[a],h=e+"\\="+l+"([^"+l+"]*)"+l;r&&console.log("[xml-utils] pattern:",h);const u=new RegExp(h).exec(n);if(r&&console.log("[xml-utils] match:",u),u)return u[1]}}be.exports=tt;be.exports.default=tt;var Qt=be.exports;const ne=ze(Qt);var Ie={exports:{}},Se={exports:{}},Te={exports:{}};function rt(s,e,t){const i=new RegExp(e).exec(s.slice(t));return i?t+i.index:-1}Te.exports=rt;Te.exports.default=rt;var Wt=Te.exports,Ae={exports:{}};function st(s,e,t){const i=new RegExp(e).exec(s.slice(t));return i?t+i.index+i[0].length-1:-1}Ae.exports=st;Ae.exports.default=st;var er=Ae.exports,_e={exports:{}};function it(s,e){const t=new RegExp(e,"g"),r=s.match(t);return r?r.length:0}_e.exports=it;_e.exports.default=it;var tr=_e.exports;const rr=Wt,oe=er,ve=tr;function nt(s,e,t){const r=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),n=t&&t.startIndex||0;r&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=rr(s,`<${e}[ 
>/]`,n);if(r&&console.log("[xml-utils] start:",o),o===-1)return;const a=s.slice(o+e.length);let l=oe(a,"^[^<]*[ /]>",0);const h=l!==-1&&a[l-1]==="/";if(r&&console.log("[xml-utils] selfClosing:",h),h===!1)if(i){let d=0,g=1,f=0;for(;(l=oe(a,"[ /]"+e+">",d))!==-1;){const y=a.substring(d,l+1);if(g+=ve(y,"<"+e+`[ 
	>]`),f+=ve(y,"</"+e+">"),f>=g)break;d=l}}else l=oe(a,"[ /]"+e+">",0);const c=o+e.length+l+1;if(r&&console.log("[xml-utils] end:",c),c===-1)return;const u=s.slice(o,c);let p;return h?p=null:p=u.slice(u.indexOf(">")+1,u.lastIndexOf("<")),{inner:p,outer:u,start:o,end:c}}Se.exports=nt;Se.exports.default=nt;var sr=Se.exports;const ir=sr;function ot(s,e,t){const r=[],i=t&&t.debug||!1,n=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=ir(s,e,{debug:i,startIndex:o});)n?o=a.start+1+e.length:o=a.end,r.push(a);return i&&console.log("findTagsByName found",r.length,"tags"),r}Ie.exports=ot;Ie.exports.default=ot;var nr=Ie.exports;const or=ze(nr),Z={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},B={};for(const s in Z)Z.hasOwnProperty(s)&&(B[Z[s]]=parseInt(s,10));const ar=[B.BitsPerSample,B.ExtraSamples,B.SampleFormat,B.StripByteCounts,B.StripOffsets,B.StripRowCounts,B.TileByteCounts,B.TileOffsets,B.SubIFDs],ae={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},x={};for(const s in ae)ae.hasOwnProperty(s)&&(x[ae[s]]=parseInt(s,10));const F={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},lr={Unspecified:0,Assocalpha:1,Unassalpha:2},Os={Version:0,AddCompression:1},Rs={None:0,Deflate:1,Zstandard:2},cr={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function hr(s,e){const{width:t,height:r}=s,i=new Uint8Array(t*r*3);let n;for(let o=0,a=0;o<s.length;++o,a+=3)n=256-s[o]/e*256,i[a]=n,i[a+1]=n,i[a+2]=n;return i}function fr(s,e){const{width:t,height:r}=s,i=new Uint8Array(t*r*3);let n;for(let o=0,a=0;o<s.length;++o,a+=3)n=s[o]/e*256,i[a]=n,i[a+1]=n,i[a+2]=n;return i}function ur(s,e){const{width:t,height:r}=s,i=new Uint8Array(t*r*3),n=e.length/3,o=e.length/3*2;for(let a=0,l=0;a<s.length;++a,l+=3){const h=s[a];i[l]=e[h]/65536*256,i[l+1]=e[h+n]/65536*256,i[l+2]=e[h+o]/65536*256}return i}function dr(s){const{width:e,height:t}=s,r=new Uint8Array(e*t*3);for(let i=0,n=0;i<s.length;i+=4,n+=3){const o=s[i],a=s[i+1],l=s[i+2],h=s[i+3];r[n]=255*((255-o)/256)*((255-h)/256),r[n+1]=255*((255-a)/256)*((255-h)/256),r[n+2]=255*((255-l)/256)*((255-h)/256)}return r}function gr(s){const{width:e,height:t}=s,r=new Uint8ClampedArray(e*t*3);for(let i=0,n=0;i<s.length;i+=3,n+=3){const o=s[i],a=s[i+1],l=s[i+2];r[n]=o+1.402*(l-128),r[n+1]=o-.34414*(a-128)-.71414*(l-128),r[n+2]=o+1.772*(a-128)}return r}const pr=.95047,yr=1,mr=1.08883;function wr(s){const{width:e,height:t}=s,r=new Uint8Array(e*t*3);for(let i=0,n=0;i<s.length;i+=3,n+=3){const o=s[i+0],a=s[i+1]<<24>>24,l=s[i+2]<<24>>24;let h=(o+16)/116,c=a/500+h,u=h-l/200,p,d,g;c=pr*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=yr*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=mr*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),p=c*3.2406+h*-1.5372+u*-.4986,d=c*-.9689+h*1.8758+u*.0415,g=c*.0557+h*-.204+u*1.057,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,r[n]=Math.max(0,Math.min(1,p))*255,r[n+1]=Math.max(0,Math.min(1,d))*255,r[n+2]=Math.max(0,Math.min(1,g))*255}return r}const at=new Map;function U(s,e){Array.isArray(s)||(s=[s]),s.forEach(t=>at.set(t,e))}async function lt(s){const e=at.get(s.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${s.Compression}`);const t=await e();return new t(s)}U([void 0,1],()=>v(()=>import("./raw-7a0fe838.js"),["./raw-7a0fe838.js","./basedecoder-3573ccae.js"],import.meta.url).then(s=>s.default));U(5,()=>v(()=>import("./lzw-901d9363.js"),["./lzw-901d9363.js","./basedecoder-3573ccae.js"],import.meta.url).then(s=>s.default));U(6,()=>{throw new Error("old style JPEG compression is not supported.")});U(7,()=>v(()=>import("./jpeg-2f15dd85.js"),["./jpeg-2f15dd85.js","./basedecoder-3573ccae.js"],import.meta.url).then(s=>s.default));U([8,32946],()=>v(()=>import("./deflate-29fb883b.js"),["./deflate-29fb883b.js","./pako.esm-bae9e474.js","./basedecoder-3573ccae.js"],import.meta.url).then(s=>s.default));U(32773,()=>v(()=>import("./packbits-90020365.js"),["./packbits-90020365.js","./basedecoder-3573ccae.js"],import.meta.url).then(s=>s.default));U(34887,()=>v(()=>import("./lerc-7ffa532a.js"),["./lerc-7ffa532a.js","./pako.esm-bae9e474.js","./_commonjsHelpers-39b5b250.js","./basedecoder-3573ccae.js","./WebGLTile-360166ba.js","./expressions-6baa81d4.js","./TileProperty-b49a7745.js","./Layer-763025a3.js","./BaseTile-115b346f.js","./index-87bb3bb9.js","./index-3002667b.css"],import.meta.url).then(async s=>(await s.zstd.init(),s)).then(s=>s.default));U(50001,()=>v(()=>import("./webimage-aa764004.js"),["./webimage-aa764004.js","./basedecoder-3573ccae.js"],import.meta.url).then(s=>s.default));function se(s,e,t,r=1){return new(Object.getPrototypeOf(s)).constructor(e*t*r)}function xr(s,e,t,r,i){const n=e/r,o=t/i;return s.map(a=>{const l=se(a,r,i);for(let h=0;h<i;++h){const c=Math.min(Math.round(o*h),t-1);for(let u=0;u<r;++u){const p=Math.min(Math.round(n*u),e-1),d=a[c*e+p];l[h*r+u]=d}}return l})}function z(s,e,t){return(1-t)*s+t*e}function br(s,e,t,r,i){const n=e/r,o=t/i;return s.map(a=>{const l=se(a,r,i);for(let h=0;h<i;++h){const c=o*h,u=Math.floor(c),p=Math.min(Math.ceil(c),t-1);for(let d=0;d<r;++d){const g=n*d,f=g%1,y=Math.floor(g),w=Math.min(Math.ceil(g),e-1),m=a[u*e+y],I=a[u*e+w],S=a[p*e+y],A=a[p*e+w],_=z(z(m,I,f),z(S,A,f),c%1);l[h*r+d]=_}}return l})}function Ir(s,e,t,r,i,n="nearest"){switch(n.toLowerCase()){case"nearest":return xr(s,e,t,r,i);case"bilinear":case"linear":return br(s,e,t,r,i);default:throw new Error(`Unsupported resampling method: '${n}'`)}}function Sr(s,e,t,r,i,n){const o=e/r,a=t/i,l=se(s,r,i,n);for(let h=0;h<i;++h){const c=Math.min(Math.round(a*h),t-1);for(let u=0;u<r;++u){const p=Math.min(Math.round(o*u),e-1);for(let d=0;d<n;++d){const g=s[c*e*n+p*n+d];l[h*r*n+u*n+d]=g}}}return l}function Tr(s,e,t,r,i,n){const o=e/r,a=t/i,l=se(s,r,i,n);for(let h=0;h<i;++h){const c=a*h,u=Math.floor(c),p=Math.min(Math.ceil(c),t-1);for(let d=0;d<r;++d){const g=o*d,f=g%1,y=Math.floor(g),w=Math.min(Math.ceil(g),e-1);for(let m=0;m<n;++m){const I=s[u*e*n+y*n+m],S=s[u*e*n+w*n+m],A=s[p*e*n+y*n+m],_=s[p*e*n+w*n+m],T=z(z(I,S,f),z(A,_,f),c%1);l[h*r*n+d*n+m]=T}}}return l}function Ar(s,e,t,r,i,n,o="nearest"){switch(o.toLowerCase()){case"nearest":return Sr(s,e,t,r,i,n);case"bilinear":case"linear":return Tr(s,e,t,r,i,n);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function _r(s,e,t){let r=0;for(let i=e;i<t;++i)r+=s[i];return r}function fe(s,e,t){switch(s){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function Dr(s,e){return(s===1||s===2)&&e<=32&&e%8===0?!1:!(s===3&&(e===16||e===32||e===64))}function Er(s,e,t,r,i,n,o){const a=new DataView(s),l=t===2?o*n:o*n*r,h=t===2?1:r,c=fe(e,i,l),u=parseInt("1".repeat(i),2);if(e===1){let p;t===1?p=r*i:p=i;let d=n*p;d&7&&(d=d+7&-8);for(let g=0;g<o;++g){const f=g*d;for(let y=0;y<n;++y){const w=f+y*h*i;for(let m=0;m<h;++m){const I=w+m*i,S=(g*n+y)*h+m,A=Math.floor(I/8),_=I%8;if(_+i<=8)c[S]=a.getUint8(A)>>8-i-_&u;else if(_+i<=16)c[S]=a.getUint16(A)>>16-i-_&u;else if(_+i<=24){const T=a.getUint16(A)<<8|a.getUint8(A+2);c[S]=T>>24-i-_&u}else c[S]=a.getUint32(A)>>32-i-_&u}}}}return c.buffer}class Pr{constructor(e,t,r,i,n,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=i,this.tiles=n?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(i,n){return et(this,i,n)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const r=this.getSampleFormat(e),i=this.getBitsPerSample(e);return fe(r,i,t)}async getTileOrStrip(e,t,r,i,n){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=t*o+e:this.planarConfiguration===2&&(l=r*o*a+t*o+e);let c,u;this.isTiled?(c=this.fileDirectory.TileOffsets[l],u=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],u=this.fileDirectory.StripByteCounts[l]);const p=(await this.source.fetch([{offset:c,length:u}],n))[0];let d;return h===null||!h[l]?(d=(async()=>{let g=await i.decode(this.fileDirectory,p);const f=this.getSampleFormat(),y=this.getBitsPerSample();return Dr(f,y)&&(g=Er(g,f,this.planarConfiguration,this.getSamplesPerPixel(),y,this.getTileWidth(),this.getBlockHeight(t))),g})(),h!==null&&(h[l]=d)):d=h[l],{x:e,y:t,sample:r,data:await d}}async _readRaster(e,t,r,i,n,o,a,l,h){const c=this.getTileWidth(),u=this.getTileHeight(),p=this.getWidth(),d=this.getHeight(),g=Math.max(Math.floor(e[0]/c),0),f=Math.min(Math.ceil(e[2]/c),Math.ceil(p/c)),y=Math.max(Math.floor(e[1]/u),0),w=Math.min(Math.ceil(e[3]/u),Math.ceil(d/u)),m=e[2]-e[0];let I=this.getBytesPerPixel();const S=[],A=[];for(let b=0;b<t.length;++b)this.planarConfiguration===1?S.push(_r(this.fileDirectory.BitsPerSample,0,t[b])/8):S.push(0),A.push(this.getReaderForSample(t[b]));const _=[],{littleEndian:T}=this;for(let b=y;b<w;++b)for(let D=g;D<f;++D){let C;this.planarConfiguration===1&&(C=this.getTileOrStrip(D,b,0,n,h));for(let k=0;k<t.length;++k){const M=k,N=t[k];this.planarConfiguration===2&&(I=this.getSampleByteSize(N),C=this.getTileOrStrip(D,b,N,n,h));const O=C.then(L=>{const gt=L.data,pt=new DataView(gt),ie=this.getBlockHeight(L.y),$=L.y*u,W=L.x*c,yt=$+ie,mt=(L.x+1)*c,wt=A[M],xt=Math.min(ie,ie-(yt-e[3]),d-$),bt=Math.min(c,c-(mt-e[2]),p-W);for(let H=Math.max(0,e[1]-$);H<xt;++H)for(let Y=Math.max(0,e[0]-W);Y<bt;++Y){const It=(H*c+Y)*I,ke=wt.call(pt,It+S[M],T);let ee;i?(ee=(H+$-e[1])*m*t.length+(Y+W-e[0])*t.length+M,r[ee]=ke):(ee=(H+$-e[1])*m+Y+W-e[0],r[M][ee]=ke)}});_.push(O)}}if(await Promise.all(_),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let b;return i?b=Ar(r,e[2]-e[0],e[3]-e[1],o,a,t.length,l):b=Ir(r,e[2]-e[0],e[3]-e[1],o,a,l),b.width=o,b.height=a,b}return r.width=o||e[2]-e[0],r.height=a||e[3]-e[1],r}async readRasters({window:e,samples:t=[],interleave:r,pool:i=null,width:n,height:o,resampleMethod:a,fillValue:l,signal:h}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=c[2]-c[0],p=c[3]-c[1],d=u*p,g=this.getSamplesPerPixel();if(!t||!t.length)for(let m=0;m<g;++m)t.push(m);else for(let m=0;m<t.length;++m)if(t[m]>=g)return Promise.reject(new RangeError(`Invalid sample index '${t[m]}'.`));let f;if(r){const m=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,I=Math.max.apply(null,this.fileDirectory.BitsPerSample);f=fe(m,I,d*t.length),l&&f.fill(l)}else{f=[];for(let m=0;m<t.length;++m){const I=this.getArrayForSample(t[m],d);Array.isArray(l)&&m<l.length?I.fill(l[m]):l&&!Array.isArray(l)&&I.fill(l),f.push(I)}}const y=i||await lt(this.fileDirectory);return await this._readRaster(c,t,f,r,y,n,o,a,h)}async readRGB({window:e,interleave:t=!0,pool:r=null,width:i,height:n,resampleMethod:o,enableAlpha:a=!1,signal:l}={}){const h=e||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===F.RGB){let w=[0,1,2];if(this.fileDirectory.ExtraSamples!==lr.Unspecified&&a){w=[];for(let m=0;m<this.fileDirectory.BitsPerSample.length;m+=1)w.push(m)}return this.readRasters({window:e,interleave:t,samples:w,pool:r,width:i,height:n,resampleMethod:o,signal:l})}let u;switch(c){case F.WhiteIsZero:case F.BlackIsZero:case F.Palette:u=[0];break;case F.CMYK:u=[0,1,2,3];break;case F.YCbCr:case F.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const p={window:h,interleave:!0,samples:u,pool:r,width:i,height:n,resampleMethod:o,signal:l},{fileDirectory:d}=this,g=await this.readRasters(p),f=2**this.fileDirectory.BitsPerSample[0];let y;switch(c){case F.WhiteIsZero:y=hr(g,f);break;case F.BlackIsZero:y=fr(g,f);break;case F.Palette:y=ur(g,d.ColorMap);break;case F.CMYK:y=dr(g);break;case F.YCbCr:y=gr(g);break;case F.CIELab:y=wr(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const w=new Uint8Array(y.length/3),m=new Uint8Array(y.length/3),I=new Uint8Array(y.length/3);for(let S=0,A=0;S<y.length;S+=3,++A)w[A]=y[S],m[A]=y[S+1],I[A]=y[S+2];y=[w,m,I]}return y.width=g.width,y.height=g.height,y}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const r=this.fileDirectory.GDAL_METADATA;let i=or(r,"Item");e===null?i=i.filter(n=>ne(n,"sample")===void 0):i=i.filter(n=>Number(ne(n,"sample"))===e);for(let n=0;n<i.length;++n){const o=i[n];t[ne(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(r)return[r[0],-r[5],r[10]];if(e){const[i,n,o]=e.getResolution();return[i*e.getWidth()/this.getWidth(),n*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const e=this.getHeight(),t=this.getWidth();if(this.fileDirectory.ModelTransformation){const[r,i,n,o,a,l,h,c]=this.fileDirectory.ModelTransformation,p=[[0,0],[0,e],[t,0],[t,e]].map(([f,y])=>[o+r*f+i*y,c+a*f+l*y]),d=p.map(f=>f[0]),g=p.map(f=>f[1]);return[Math.min(...d),Math.min(...g),Math.max(...d),Math.max(...g)]}else{const r=this.getOrigin(),i=this.getResolution(),n=r[0],o=r[1],a=n+i[0]*this.getWidth(),l=o+i[1]*this.getHeight();return[Math.min(n,a),Math.min(o,l),Math.max(n,a),Math.max(o,l)]}}}const ct=Pr;class Fr{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const r=this.getUint32(e,t),i=this.getUint32(e+4,t);let n;if(t){if(n=r+2**32*i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*r+i,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}getInt64(e,t){let r=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let n=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));i&&(n?a!==0&&(a=~(a-1)&255,n=!1):a=~a&255),r+=a*256**o}return i&&(r=-r),r}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return et(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class Cr{constructor(e,t,r,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=r,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),r=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+r,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const r=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let n=0;n<8;n++){let o=this._dataView.getUint8(e+(this._littleEndian?n:7-n));r&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),t+=o*256**n}return r&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const kr=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class Mr{constructor(e=kr,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(r=>{v(()=>import("./decoder-88d82e9b.js"),["./decoder-88d82e9b.js","./_commonjsHelpers-39b5b250.js"],import.meta.url).then(i=>{r(i.create)})}),this._awaitingDecoder.then(r=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:r(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?lt(e).then(r=>r.decode(e,t)):new Promise(r=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const n=this.messageId++,o=a=>{a.data.id===n&&(i.idle=!0,r(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:e,buffer:t,id:n},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const Or=Mr,Ue=`\r
\r
`;function ht(s){if(typeof Object.fromEntries<"u")return Object.fromEntries(s);const e={};for(const[t,r]of s)e[t.toLowerCase()]=r;return e}function Rr(s){const e=s.split(`\r
`).map(t=>{const r=t.split(":").map(i=>i.trim());return r[0]=r[0].toLowerCase(),r});return ht(e)}function Gr(s){const[e,...t]=s.split(";").map(i=>i.trim()),r=t.map(i=>i.split("="));return{type:e,params:ht(r)}}function ue(s){let e,t,r;return s&&([,e,t,r]=s.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),r=parseInt(r,10)),{start:e,end:t,total:r}}function Br(s,e){let t=null;const r=new TextDecoder("ascii"),i=[],n=`--${e}`,o=`${n}--`;for(let a=0;a<10;++a)r.decode(new Uint8Array(s,a,n.length))===n&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<s.byteLength;){const a=r.decode(new Uint8Array(s,t,Math.min(n.length+1024,s.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(n))throw new Error("Part does not start with boundary");const l=a.substr(n.length+2);if(l.length===0)break;const h=l.indexOf(Ue),c=Rr(l.substr(0,h)),{start:u,end:p,total:d}=ue(c["content-range"]),g=t+n.length+h+Ue.length,f=parseInt(p,10)+1-parseInt(u,10);i.push({headers:c,data:s.slice(g,g+f),offset:u,length:f,fileSize:d}),t=g+f+4}return i}class De{async fetch(e,t=void 0){return Promise.all(e.map(r=>this.fetchSlice(r,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class vr extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,r]of e)this.onEviction(t,r.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const r=t.get(e);return this._getItemValue(e,r)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||this._deleteIfExpired(t,r)===!1&&(yield e)}for(const e of this.cache){const[t,r]=e;this._deleteIfExpired(t,r)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:r=this.maxAge}={}){const i=typeof r=="number"&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],r=t.length-e;r<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(r>0&&this._emitEvictions(t.slice(0,r)),this.oldCache=new Map(t.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,r]=e;this._deleteIfExpired(t,r)===!1&&(yield[t,r.value])}for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||this._deleteIfExpired(t,r)===!1&&(yield[t,r.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,n]=r;this._deleteIfExpired(i,n)===!1&&(yield[i,n.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const r=e[t],[i,n]=r;this.cache.has(i)||this._deleteIfExpired(i,n)===!1&&(yield[i,n.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[r,i]of this.entriesAscending())e.call(t,i,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function Ur(s){return new Promise(e=>setTimeout(e,s))}function Lr(s,e){const t=Array.isArray(s)?s:Array.from(s),r=Array.isArray(e)?e:Array.from(e);return t.map((i,n)=>[i,r[n]])}class K extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,K),this.name="AbortError"}}class Nr extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const Vr=Nr;class zr{constructor(e,t,r=null){this.offset=e,this.length=t,this.data=r}get top(){return this.offset+this.length}}class Le{constructor(e,t,r){this.offset=e,this.length=t,this.blockIds=r}}class Kr extends De{constructor(e,{blockSize:t=65536,cacheSize:r=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new vr({maxSize:r,onEviction:(i,n)=>{this.evictedBlocks.set(i,n)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const r=[],i=[],n=[];this.evictedBlocks.clear();for(const{offset:p,length:d}of e){let g=p+d;const{fileSize:f}=this;f!==null&&(g=Math.min(g,f));const y=Math.floor(p/this.blockSize)*this.blockSize;for(let w=y;w<g;w+=this.blockSize){const m=Math.floor(w/this.blockSize);!this.blockCache.has(m)&&!this.blockRequests.has(m)&&(this.blockIdsToFetch.add(m),i.push(m)),this.blockRequests.has(m)&&r.push(this.blockRequests.get(m)),n.push(m)}}await Ur(),this.fetchBlocks(t);const o=[];for(const p of i)this.blockRequests.has(p)&&o.push(this.blockRequests.get(p));await Promise.allSettled(r),await Promise.allSettled(o);const a=[],l=n.filter(p=>this.abortedBlockIds.has(p)||!this.blockCache.has(p));if(l.forEach(p=>this.blockIdsToFetch.add(p)),l.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const p of l){const d=this.blockRequests.get(p);if(!d)throw new Error(`Block ${p} is not in the block requests`);a.push(d)}await Promise.allSettled(a)}if(t&&t.aborted)throw new K("Request was aborted");const h=n.map(p=>this.blockCache.get(p)||this.evictedBlocks.get(p)),c=h.filter(p=>!p);if(c.length)throw new Vr(c,"Request failed");const u=new Map(Lr(n,h));return this.readSliceData(e,u)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),r=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const n=t[i];for(const o of n.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await r)[i],l=o*this.blockSize,h=l-a.offset,c=Math.min(h+this.blockSize,a.data.byteLength),u=a.data.slice(h,c),p=new zr(l,u.byteLength,u,o);this.blockCache.set(o,p),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let r=[],i=null;const n=[];for(const o of t)i===null||i+1===o?(r.push(o),i=o):(n.push(new Le(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[o],i=o);return n.push(new Le(r[0]*this.blockSize,r.length*this.blockSize,r)),n}readSliceData(e,t){return e.map(r=>{let i=r.offset+r.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const n=Math.floor(r.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(r.length),l=new Uint8Array(a);for(let h=n;h<=o;++h){const c=t.get(h),u=c.offset-r.offset,p=c.top-i;let d=0,g=0,f;u<0?d=-u:u>0&&(g=u),p<0?f=c.length-d:f=i-c.offset-d;const y=new Uint8Array(c.data,d,f);l.set(y,g)}return a})}}class Ee{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Pe{constructor(e){this.url=e}async request({headers:e,credentials:t,signal:r}={}){throw new Error("request is not implemented")}}class jr extends Ee{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class qr extends Pe{constructor(e,t){super(e),this.credentials=t}async request({headers:e,credentials:t,signal:r}={}){const i=await fetch(this.url,{headers:e,credentials:t,signal:r});return new jr(i)}}class $r extends Ee{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class Hr extends Pe{constructRequest(e,t){return new Promise((r,i)=>{const n=new XMLHttpRequest;n.open("GET",this.url),n.responseType="arraybuffer";for(const[o,a]of Object.entries(e))n.setRequestHeader(o,a);n.onload=()=>{const o=n.response;r(new $r(n,o))},n.onerror=i,n.onabort=()=>i(new K("Request aborted")),n.send(),t&&(t.aborted&&n.abort(),t.addEventListener("abort",()=>n.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const le={};class Yr extends Ee{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class Xr extends Pe{constructor(e){super(e),this.parsedUrl=le.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",le)}constructRequest(e,t){return new Promise((r,i)=>{const n=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(l=>{const h=[];o.on("data",c=>{h.push(c)}),o.on("end",()=>{const c=Buffer.concat(h).buffer;l(c)}),o.on("error",i)});r(new Yr(o,a))});n.on("error",i),t&&(t.aborted&&n.destroy(new K("Request aborted")),t.addEventListener("abort",()=>n.destroy(new K("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Fe extends De{constructor(e,t,r,i){super(),this.client=e,this.headers=t,this.maxRanges=r,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(r=>this.fetchSlice(r,t))))}async fetchSlices(e,t){const r=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:n})=>`${i}-${i+n}`).join(",")}`},signal:t});if(r.ok)if(r.status===206){const{type:i,params:n}=Gr(r.getHeader("content-type"));if(i==="multipart/byteranges"){const u=Br(await r.getData(),n.boundary);return this._fileSize=u[0].fileSize||null,u}const o=await r.getData(),{start:a,end:l,total:h}=ue(r.getHeader("content-range"));this._fileSize=h||null;const c=[{data:o,offset:a,length:l-a}];if(e.length>1){const u=await Promise.all(e.slice(1).map(p=>this.fetchSlice(p,t)));return c.concat(u)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await r.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:r,length:i}=e,n=await this.client.request({headers:{...this.headers,Range:`bytes=${r}-${r+i}`},signal:t});if(n.ok)if(n.status===206){const o=await n.getData(),{total:a}=ue(n.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:r,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await n.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Ce(s,{blockSize:e,cacheSize:t}){return e===null?s:new Kr(s,{blockSize:e,cacheSize:t})}function Zr(s,{headers:e={},credentials:t,maxRanges:r=0,allowFullFile:i=!1,...n}={}){const o=new qr(s,t),a=new Fe(o,e,r,i);return Ce(a,n)}function Jr(s,{headers:e={},maxRanges:t=0,allowFullFile:r=!1,...i}={}){const n=new Hr(s),o=new Fe(n,e,t,r);return Ce(o,i)}function Qr(s,{headers:e={},maxRanges:t=0,allowFullFile:r=!1,...i}={}){const n=new Xr(s),o=new Fe(n,e,t,r);return Ce(o,i)}function de(s,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?Zr(s,t):typeof XMLHttpRequest<"u"?Jr(s,t):Qr(s,t)}class Wr extends De{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((r,i)=>{const n=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>r(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(n),t&&t.addEventListener("abort",()=>o.abort())})}}function es(s){return new Wr(s)}function ge(s){switch(s){case x.BYTE:case x.ASCII:case x.SBYTE:case x.UNDEFINED:return 1;case x.SHORT:case x.SSHORT:return 2;case x.LONG:case x.SLONG:case x.FLOAT:case x.IFD:return 4;case x.RATIONAL:case x.SRATIONAL:case x.DOUBLE:case x.LONG8:case x.SLONG8:case x.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${s}`)}}function ts(s){const e=s.GeoKeyDirectory;if(!e)return null;const t={};for(let r=4;r<=e[3]*4;r+=4){const i=cr[e[r]],n=e[r+1]?Z[e[r+1]]:null,o=e[r+2],a=e[r+3];let l=null;if(!n)l=a;else{if(l=s[n],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof l=="string"?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),o===1&&(l=l[0]))}t[i]=l}return t}function V(s,e,t,r){let i=null,n=null;const o=ge(e);switch(e){case x.BYTE:case x.ASCII:case x.UNDEFINED:i=new Uint8Array(t),n=s.readUint8;break;case x.SBYTE:i=new Int8Array(t),n=s.readInt8;break;case x.SHORT:i=new Uint16Array(t),n=s.readUint16;break;case x.SSHORT:i=new Int16Array(t),n=s.readInt16;break;case x.LONG:case x.IFD:i=new Uint32Array(t),n=s.readUint32;break;case x.SLONG:i=new Int32Array(t),n=s.readInt32;break;case x.LONG8:case x.IFD8:i=new Array(t),n=s.readUint64;break;case x.SLONG8:i=new Array(t),n=s.readInt64;break;case x.RATIONAL:i=new Uint32Array(t*2),n=s.readUint32;break;case x.SRATIONAL:i=new Int32Array(t*2),n=s.readInt32;break;case x.FLOAT:i=new Float32Array(t),n=s.readFloat32;break;case x.DOUBLE:i=new Float64Array(t),n=s.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===x.RATIONAL||e===x.SRATIONAL)for(let a=0;a<t;a+=2)i[a]=n.call(s,r+a*o),i[a+1]=n.call(s,r+(a*o+4));else for(let a=0;a<t;++a)i[a]=n.call(s,r+a*o);return e===x.ASCII?new TextDecoder("utf-8").decode(i):i}class rs{constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class te extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class ft{async readRasters(e={}){const{window:t,width:r,height:i}=e;let{resX:n,resY:o,bbox:a}=e;const l=await this.getImage();let h=l;const c=await this.getImageCount(),u=l.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(r||i){if(t){const[g,f]=l.getOrigin(),[y,w]=l.getResolution();a=[g+t[0]*y,f+t[1]*w,g+t[2]*y,f+t[3]*w]}const d=a||u;if(r){if(n)throw new Error("Both width and resX passed");n=(d[2]-d[0])/r}if(i){if(o)throw new Error("Both width and resY passed");o=(d[3]-d[1])/i}}if(n||o){const d=[];for(let g=0;g<c;++g){const f=await this.getImage(g),{SubfileType:y,NewSubfileType:w}=f.fileDirectory;(g===0||y===2||w&1)&&d.push(f)}d.sort((g,f)=>g.getWidth()-f.getWidth());for(let g=0;g<d.length;++g){const f=d[g],y=(u[2]-u[0])/f.getWidth(),w=(u[3]-u[1])/f.getHeight();if(h=f,n&&n>y||o&&o>w)break}}let p=t;if(a){const[d,g]=l.getOrigin(),[f,y]=h.getResolution(l);p=[Math.round((a[0]-d)/f),Math.round((a[1]-g)/y),Math.round((a[2]-d)/f),Math.round((a[3]-g)/y)],p=[Math.min(p[0],p[2]),Math.min(p[1],p[3]),Math.max(p[0],p[2]),Math.max(p[1],p[3])]}return h.readRasters({...e,window:p})}}let re=class ut extends ft{constructor(e,t,r,i,n={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=i,this.cache=n.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const r=this.bigTiff?4048:1024;return new Cr((await this.source.fetch([{offset:e,length:typeof t<"u"?t:r}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,r=this.bigTiff?8:2;let i=await this.getSlice(e);const n=this.bigTiff?i.readUint64(e):i.readUint16(e),o=n*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const a={};let l=e+(this.bigTiff?8:2);for(let u=0;u<n;l+=t,++u){const p=i.readUint16(l),d=i.readUint16(l+2),g=this.bigTiff?i.readUint64(l+4):i.readUint32(l+4);let f,y;const w=ge(d),m=l+(this.bigTiff?12:8);if(w*g<=(this.bigTiff?8:4))f=V(i,d,g,m);else{const I=i.readOffset(m),S=ge(d)*g;if(i.covers(I,S))f=V(i,d,g,I);else{const A=await this.getSlice(I,S);f=V(A,d,g,I)}}g===1&&ar.indexOf(p)===-1&&!(d===x.RATIONAL||d===x.SRATIONAL)?y=f[0]:y=f,a[Z[p]]=y}const h=ts(a),c=i.readOffset(e+r+t*n);return new rs(a,h,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof te?new te(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new te(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new ct(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(r){if(r instanceof te)t=!1;else throw r}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",r=t.length+100;let i=await this.getSlice(e,r);if(t===V(i,x.ASCII,t.length,e)){const o=V(i,x.ASCII,r,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>r&&(i=await this.getSlice(e,a));const l=V(i,x.ASCII,a,e);this.ghostValues={},l.split(`
`).filter(h=>h.length>0).map(h=>h.split("=")).forEach(([h,c])=>{this.ghostValues[h]=c})}return this.ghostValues}static async fromSource(e,t,r){const i=(await e.fetch([{offset:0,length:1024}],r))[0],n=new Fr(i),o=n.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const l=n.getUint16(2,a);let h;if(l===42)h=!1;else if(l===43){if(h=!0,n.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=h?n.getUint64(8,a):n.getUint32(4,a);return new ut(e,a,h,c,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}};class ss extends ft{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,r=0;for(let i=0;i<this.imageFiles.length;i++){const n=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(e===t){const a=await n.requestIFD(r);return new ct(a.fileDirectory,a.geoKeyDirectory,n.dataView,n.littleEndian,n.cache,n.source)}t++,r++}r=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,r)=>t+r,0),this.imageCount}}async function is(s,e={},t){return re.fromSource(de(s,e),t)}async function ns(s,e){return re.fromSource(es(s),e)}async function os(s,e=[],t={},r){const i=await re.fromSource(de(s,t),r),n=await Promise.all(e.map(o=>re.fromSource(de(o,t))));return new ss(i,n)}function as(s){return((s.fileDirectory.NewSubfileType||0)&4)===4}function ls(s,e){if(!s)return!1;if(s===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,r=F;return t===r.CMYK||t===r.YCbCr||t===r.CIELab||t===r.ICCLab}const Ne="STATISTICS_MAXIMUM",Ve="STATISTICS_MINIMUM",ce=256;let he;function cs(){return he||(he=new Or),he}function hs(s){try{return s.getBoundingBox()}catch{return[0,0,s.getWidth(),s.getHeight()]}}function fs(s){try{return s.getOrigin().slice(0,2)}catch{return[0,s.getHeight()]}}function us(s,e){try{return s.getResolution(e)}catch{return[e.getWidth()/s.getWidth(),e.getHeight()/s.getHeight()]}}function ds(s){const e=s.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let r=Oe(t);if(!r){const i=Re(e.ProjLinearUnitsGeoKey);i&&(r=new Ge({code:t,units:i}))}return r}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let r=Oe(t);if(!r){const i=Re(e.GeogAngularUnitsGeoKey);i&&(r=new Ge({code:t,units:i}))}return r}return null}function gs(s){return s.getImageCount().then(function(e){const t=new Array(e);for(let r=0;r<e;++r)t[r]=s.getImage(r);return Promise.all(t)})}function ps(s,e){let t;return s.blob?t=ns(s.blob):s.overviews?t=os(s.url,s.overviews,e):t=is(s.url,e),t.then(gs)}function X(s,e,t,r,i){if(Array.isArray(s)){const n=s.length;if(!Array.isArray(e)||n!=e.length){const o=new Error(r);throw i(o),o}for(let o=0;o<n;++o)X(s[o],e[o],t,r,i);return}if(e=e,Math.abs(s-e)>t*s)throw new Error(r)}function ys(s){return s instanceof Int8Array?-128:s instanceof Int16Array?-32768:s instanceof Int32Array?-2147483648:s instanceof Float32Array?12e-39:0}function ms(s){return s instanceof Int8Array?127:s instanceof Uint8Array||s instanceof Uint8ClampedArray?255:s instanceof Int16Array?32767:s instanceof Uint16Array?65535:s instanceof Int32Array?2147483647:s instanceof Uint32Array?4294967295:s instanceof Float32Array?34e37:255}class dt extends St{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,opaque:e.opaque,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(n=>n.url).join(","));const r=this,i=new Array(t);for(let n=0;n<t;++n)i[n]=ps(this.sourceInfo_[n],this.sourceOptions_);Promise.all(i).then(function(n){r.configure_(n)}).catch(function(n){Me(n),r.error_=n,r.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const i=t[r],n=ds(i);if(n){this.projection=n;break}}}configure_(e){let t,r,i,n,o;const a=new Array(e.length),l=new Array(e.length),h=new Array(e.length);let c=0;const u=e.length;for(let f=0;f<u;++f){const y=[],w=[];e[f].forEach(b=>{as(b)?w.push(b):y.push(b)});const m=y.length;if(w.length>0&&w.length!==m)throw new Error(`Expected one mask per image found ${w.length} masks and ${m} images`);let I,S;const A=new Array(m),_=new Array(m),T=new Array(m);l[f]=new Array(m),h[f]=new Array(m);for(let b=0;b<m;++b){const D=y[b],C=D.getGDALNoData();h[f][b]=D.getGDALMetadata(0),l[f][b]=C;const k=this.sourceInfo_[f].bands;a[f]=k?k.length:D.getSamplesPerPixel();const M=m-(b+1);I||(I=hs(D)),S||(S=fs(D));const N=us(D,y[0]);T[M]=N[0];const O=[D.getTileWidth(),D.getTileHeight()];O[0]!==O[1]&&O[1]<ce&&(O[0]=ce,O[1]=ce),A[M]=O;const L=N[0]/Math.abs(N[1]);_[M]=[O[0],O[1]/L]}if(t?Et(t,I,t):t=I,!r)r=S;else{const b=`Origin mismatch for source ${f}, got [${S}] but expected [${r}]`;X(r,S,0,b,this.viewRejector)}if(!o)o=T,this.resolutionFactors_[f]=1;else{o.length-c>T.length&&(c=o.length-T.length);const b=o[o.length-1]/T[T.length-1];this.resolutionFactors_[f]=b;const D=T.map(k=>k*=b),C=`Resolution mismatch for source ${f}, got [${D}] but expected [${o}]`;X(o.slice(c,o.length),D,.02,C,this.viewRejector)}i?X(i.slice(c,i.length),_,.01,`Tile size mismatch for source ${f}`,this.viewRejector):i=_,n?X(n.slice(c,n.length),A,0,`Tile size mismatch for source ${f}`,this.viewRejector):n=A,this.sourceImagery_[f]=y.reverse(),this.sourceMasks_[f]=w.reverse()}for(let f=0,y=this.sourceImagery_.length;f<y;++f){const w=this.sourceImagery_[f];for(;w.length<o.length;)w.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.samplesPerPixel_=a,this.nodataValues_=l,this.metadata_=h;e:for(let f=0;f<u;++f){if(this.sourceInfo_[f].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[f].length){this.addAlpha_=!0;break}const y=l[f],w=this.sourceInfo_[f].bands;if(w){for(let m=0;m<w.length;++m)if(y[w[m]-1]!==null){this.addAlpha_=!0;break e}continue}for(let m=0;m<y.length;++m)if(y[m]!==null){this.addAlpha_=!0;break e}}let p=this.addAlpha_?1:0;for(let f=0;f<u;++f)p+=a[f];this.bandCount=p;const d=new Tt({extent:t,minZoom:c,origin:r,resolutions:o,tileSizes:i});this.tileGrid=d,this.setTileSizes(n),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const g=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]),this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:At(_t(t),this.projection),extent:Dt(t,this.projection),zoom:g})}loadTile_(e,t,r){const i=this.getTileSize(e),n=this.sourceImagery_.length,o=new Array(n*2),a=this.nodataValues_,l=this.sourceInfo_,h=cs();for(let c=0;c<n;++c){const u=l[c],p=this.resolutionFactors_[c],d=[Math.round(t*(i[0]*p)),Math.round(r*(i[1]*p)),Math.round((t+1)*(i[0]*p)),Math.round((r+1)*(i[1]*p))],g=this.sourceImagery_[c][e];let f;u.bands&&(f=u.bands.map(function(S){return S-1}));let y;"nodata"in u&&u.nodata!==null?y=u.nodata:f?y=f.map(function(S){return a[c][S]}):y=a[c];const w={window:d,width:i[0],height:i[1],samples:f,fillValue:y,pool:h,interleave:!1};ls(this.convertToRGB_,g)?o[c]=g.readRGB(w):o[c]=g.readRasters(w);const m=n+c,I=this.sourceMasks_[c][e];if(!I){o[m]=Promise.resolve(null);continue}o[m]=I.readRasters({window:d,width:i[0],height:i[1],samples:[0],pool:h,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,i)).catch(function(c){throw Me(c),c})}composeTile_(e,t){const r=this.metadata_,i=this.sourceInfo_,n=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,c=this.addAlpha_,u=e[0]*e[1],p=u*o;let d;h?d=new Uint8Array(p):d=new Float32Array(p);let g=0;for(let f=0;f<u;++f){let y=c;for(let w=0;w<n;++w){const m=i[w];let I=m.min,S=m.max,A,_;if(h){const T=r[w][0];I===void 0&&(T&&Ve in T?I=parseFloat(T[Ve]):I=ys(t[w][0])),S===void 0&&(T&&Ne in T?S=parseFloat(T[Ne]):S=ms(t[w][0])),A=255/(S-I),_=-I*A}for(let T=0;T<a[w];++T){const b=t[w][T][f];let D;if(h?D=Pt(A*b+_,0,255):D=b,!c)d[g]=D;else{let C=m.nodata;if(C===void 0){let M;m.bands?M=m.bands[T]-1:M=T,C=l[w][M]}const k=isNaN(C);(!k&&b!==C||k&&!isNaN(b))&&(y=!1,d[g]=D)}g++}if(!y){const T=n+w,b=t[T];b&&!b[0][f]&&(y=!0)}}c&&(y||(d[g]=255),g++)}return d}}dt.prototype.getView;const Gs=dt;export{Gs as G,Os as L,Rs as a};
