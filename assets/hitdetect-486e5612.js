import{$ as vt,bD as Pe,bE as Be,b6 as Ct,be as ne,bm as oe,bF as Ye,bG as Et,bH as z,bI as ge,bJ as _e,bK as rt,bL as ht,bM as pe,bN as xe,bO as Se,aJ as me,bP as ve,aP as ye,bQ as Ge,bv as V,i as Ht,bR as ot,bS as Gt,bT as Nt,bU as Ne,bV as Xe,a3 as le,bW as Ke,aI as Xt,bX as Ze,a4 as Ie,_ as _t,av as re,bY as He,bz as Ce,bZ as Je,b_ as he,Y as ke,Q as Kt,al as ze,a7 as Zt,aX as Ve,b as Ue,b$ as je,I as qe,x as ae,u as $e}from"./Layer-3b715193.js";import{Z as Qe}from"./Layer-37ea9c2e.js";import{V as ti,C as ei}from"./vector-4e067f94.js";import{l as ii}from"./length-c6ba5b73.js";const xt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},kt=[xt.FILL],st=[xt.STROKE],lt=[xt.BEGIN_PATH],ce=[xt.CLOSE_PATH],C=xt;class si extends ti{constructor(t,s,i,e){super(),this.tolerance=t,this.maxExtent=s,this.pixelRatio=e,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const s=this.pixelRatio;return s==1?t:t.map(function(i){return i*s})}appendFlatPointCoordinates(t,s){const i=this.getBufferedMaxExtent(),e=this.tmpCoordinate_,n=this.coordinates;let o=n.length;for(let l=0,r=t.length;l<r;l+=s)e[0]=t[l],e[1]=t[l+1],vt(i,e)&&(n[o++]=e[0],n[o++]=e[1]);return o}appendFlatLineCoordinates(t,s,i,e,n,o){const l=this.coordinates;let r=l.length;const c=this.getBufferedMaxExtent();o&&(s+=e);let h=t[s],a=t[s+1];const u=this.tmpCoordinate_;let d=!0,g,S,_;for(g=s+e;g<i;g+=e)u[0]=t[g],u[1]=t[g+1],_=Pe(c,u),_!==S?(d&&(l[r++]=h,l[r++]=a,d=!1),l[r++]=u[0],l[r++]=u[1]):_===Be.INTERSECTING?(l[r++]=u[0],l[r++]=u[1],d=!1):d=!0,h=u[0],a=u[1],S=_;return(n&&d||g===s+e)&&(l[r++]=h,l[r++]=a),r}drawCustomCoordinates_(t,s,i,e,n){for(let o=0,l=i.length;o<l;++o){const r=i[o],c=this.appendFlatLineCoordinates(t,s,r,e,!1,!1);n.push(c),s=r}return s}drawCustom(t,s,i,e,n){this.beginGeometry(t,s,n);const o=t.getType(),l=t.getStride(),r=this.coordinates.length;let c,h,a,u,d;switch(o){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),u=[];const g=t.getEndss();d=0;for(let S=0,_=g.length;S<_;++S){const p=[];d=this.drawCustomCoordinates_(c,d,g[S],l,p),u.push(p)}this.instructions.push([C.CUSTOM,r,u,t,i,oe,n]),this.hitDetectionInstructions.push([C.CUSTOM,r,u,t,e||i,oe,n]);break;case"Polygon":case"MultiLineString":a=[],c=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),d=this.drawCustomCoordinates_(c,0,t.getEnds(),l,a),this.instructions.push([C.CUSTOM,r,a,t,i,ne,n]),this.hitDetectionInstructions.push([C.CUSTOM,r,a,t,e||i,ne,n]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(c,0,c.length,l,!1,!1),this.instructions.push([C.CUSTOM,r,h,t,i,Ct,n]),this.hitDetectionInstructions.push([C.CUSTOM,r,h,t,e||i,Ct,n]);break;case"MultiPoint":c=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(c,l),h>r&&(this.instructions.push([C.CUSTOM,r,h,t,i,Ct,n]),this.hitDetectionInstructions.push([C.CUSTOM,r,h,t,e||i,Ct,n]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),h=this.coordinates.length,this.instructions.push([C.CUSTOM,r,h,t,i,void 0,n]),this.hitDetectionInstructions.push([C.CUSTOM,r,h,t,e||i,void 0,n]);break}this.endGeometry(s)}beginGeometry(t,s,i){this.beginGeometryInstruction1_=[C.BEGIN_GEOMETRY,s,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[C.BEGIN_GEOMETRY,s,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let s;const i=t.length;let e,n,o=-1;for(s=0;s<i;++s)e=t[s],n=e[0],n==C.END_GEOMETRY?o=s:n==C.BEGIN_GEOMETRY&&(e[2]=s,Ye(this.hitDetectionInstructions,o,s),o=-1)}setFillStrokeStyle(t,s){const i=this.state;if(t){const e=t.getColor();i.fillPatternScale=e&&typeof e=="object"&&"src"in e?this.pixelRatio:1,i.fillStyle=Et(e||z)}else i.fillStyle=void 0;if(s){const e=s.getColor();i.strokeStyle=Et(e||ge);const n=s.getLineCap();i.lineCap=n!==void 0?n:_e;const o=s.getLineDash();i.lineDash=o?o.slice():rt;const l=s.getLineDashOffset();i.lineDashOffset=l||ht;const r=s.getLineJoin();i.lineJoin=r!==void 0?r:pe;const c=s.getWidth();i.lineWidth=c!==void 0?c:xe;const h=s.getMiterLimit();i.miterLimit=h!==void 0?h:Se,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const s=t.fillStyle,i=[C.SET_FILL_STYLE,s];return typeof s!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[C.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,s){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(s.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,s){const i=t.strokeStyle,e=t.lineCap,n=t.lineDash,o=t.lineDashOffset,l=t.lineJoin,r=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=e||n!=t.currentLineDash&&!me(t.currentLineDash,n)||t.currentLineDashOffset!=o||t.currentLineJoin!=l||t.currentLineWidth!=r||t.currentMiterLimit!=c)&&(i!==void 0&&s.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=e,t.currentLineDash=n,t.currentLineDashOffset=o,t.currentLineJoin=l,t.currentLineWidth=r,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const s=[C.END_GEOMETRY,t];this.instructions.push(s),this.hitDetectionInstructions.push(s)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=ve(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ye(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const St=si;class ni extends St{constructor(t,s,i,e){super(t,s,i,e),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,s,i){if(!this.image_||this.maxExtent&&!vt(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,s,i);const e=t.getFlatCoordinates(),n=t.getStride(),o=this.coordinates.length,l=this.appendFlatPointCoordinates(e,n);this.instructions.push([C.DRAW_IMAGE,o,l,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([C.DRAW_IMAGE,o,l,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(s)}drawMultiPoint(t,s,i){if(!this.image_)return;this.beginGeometry(t,s,i);const e=t.getFlatCoordinates(),n=[];for(let r=0,c=e.length;r<c;r+=t.getStride())(!this.maxExtent||vt(this.maxExtent,e.slice(r,r+2)))&&n.push(e[r],e[r+1]);const o=this.coordinates.length,l=this.appendFlatPointCoordinates(n,2);this.instructions.push([C.DRAW_IMAGE,o,l,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([C.DRAW_IMAGE,o,l,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(s)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,s){const i=t.getAnchor(),e=t.getSize(),n=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=e[1],this.opacity_=t.getOpacity(),this.originX_=n[0],this.originY_=n[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=e[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=s}}const oi=ni;class li extends St{constructor(t,s,i,e){super(t,s,i,e)}drawFlatCoordinates_(t,s,i,e){const n=this.coordinates.length,o=this.appendFlatLineCoordinates(t,s,i,e,!1,!1),l=[C.MOVE_TO_LINE_TO,n,o];return this.instructions.push(l),this.hitDetectionInstructions.push(l),i}drawLineString(t,s,i){const e=this.state,n=e.strokeStyle,o=e.lineWidth;if(n===void 0||o===void 0)return;this.updateStrokeStyle(e,this.applyStroke),this.beginGeometry(t,s,i),this.hitDetectionInstructions.push([C.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,rt,ht],lt);const l=t.getFlatCoordinates(),r=t.getStride();this.drawFlatCoordinates_(l,0,l.length,r),this.hitDetectionInstructions.push(st),this.endGeometry(s)}drawMultiLineString(t,s,i){const e=this.state,n=e.strokeStyle,o=e.lineWidth;if(n===void 0||o===void 0)return;this.updateStrokeStyle(e,this.applyStroke),this.beginGeometry(t,s,i),this.hitDetectionInstructions.push([C.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,rt,ht],lt);const l=t.getEnds(),r=t.getFlatCoordinates(),c=t.getStride();let h=0;for(let a=0,u=l.length;a<u;++a)h=this.drawFlatCoordinates_(r,h,l[a],c);this.hitDetectionInstructions.push(st),this.endGeometry(s)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(st),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(st),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(lt)}}const ri=li;class hi extends St{constructor(t,s,i,e){super(t,s,i,e)}drawFlatCoordinatess_(t,s,i,e){const n=this.state,o=n.fillStyle!==void 0,l=n.strokeStyle!==void 0,r=i.length;this.instructions.push(lt),this.hitDetectionInstructions.push(lt);for(let c=0;c<r;++c){const h=i[c],a=this.coordinates.length,u=this.appendFlatLineCoordinates(t,s,h,e,!0,!l),d=[C.MOVE_TO_LINE_TO,a,u];this.instructions.push(d),this.hitDetectionInstructions.push(d),l&&(this.instructions.push(ce),this.hitDetectionInstructions.push(ce)),s=h}return o&&(this.instructions.push(kt),this.hitDetectionInstructions.push(kt)),l&&(this.instructions.push(st),this.hitDetectionInstructions.push(st)),s}drawCircle(t,s,i){const e=this.state,n=e.fillStyle,o=e.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,s,i),e.fillStyle!==void 0&&this.hitDetectionInstructions.push([C.SET_FILL_STYLE,z]),e.strokeStyle!==void 0&&this.hitDetectionInstructions.push([C.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,rt,ht]);const l=t.getFlatCoordinates(),r=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(l,0,l.length,r,!1,!1);const h=[C.CIRCLE,c];this.instructions.push(lt,h),this.hitDetectionInstructions.push(lt,h),e.fillStyle!==void 0&&(this.instructions.push(kt),this.hitDetectionInstructions.push(kt)),e.strokeStyle!==void 0&&(this.instructions.push(st),this.hitDetectionInstructions.push(st)),this.endGeometry(s)}drawPolygon(t,s,i){const e=this.state,n=e.fillStyle,o=e.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,s,i),e.fillStyle!==void 0&&this.hitDetectionInstructions.push([C.SET_FILL_STYLE,z]),e.strokeStyle!==void 0&&this.hitDetectionInstructions.push([C.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,rt,ht]);const l=t.getEnds(),r=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(r,0,l,c),this.endGeometry(s)}drawMultiPolygon(t,s,i){const e=this.state,n=e.fillStyle,o=e.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,s,i),e.fillStyle!==void 0&&this.hitDetectionInstructions.push([C.SET_FILL_STYLE,z]),e.strokeStyle!==void 0&&this.hitDetectionInstructions.push([C.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth,e.lineCap,e.lineJoin,e.miterLimit,rt,ht]);const l=t.getEndss(),r=t.getOrientedFlatCoordinates(),c=t.getStride();let h=0;for(let a=0,u=l.length;a<u;++a)h=this.drawFlatCoordinatess_(r,h,l[a],c);this.endGeometry(s)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const s=this.coordinates;for(let i=0,e=s.length;i<e;++i)s[i]=Ge(s[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const de=hi;function ai(x,t,s,i,e){const n=[];let o=s,l=0,r=t.slice(s,2);for(;l<x&&o+e<i;){const[c,h]=r.slice(-2),a=t[o+e],u=t[o+e+1],d=Math.sqrt((a-c)*(a-c)+(u-h)*(u-h));if(l+=d,l>=x){const g=(x-l+d)/d,S=V(c,a,g),_=V(h,u,g);r.push(S,_),n.push(r),r=[S,_],l==x&&(o+=e),l=0}else if(l<x)r.push(t[o+e],t[o+e+1]),o+=e;else{const g=d-l,S=V(c,a,g/d),_=V(h,u,g/d);r.push(S,_),n.push(r),r=[S,_],l=0,o+=e}}return l>0&&n.push(r),n}function ci(x,t,s,i,e){let n=s,o=s,l=0,r=0,c=s,h,a,u,d,g,S,_,p,m,y;for(a=s;a<i;a+=e){const k=t[a],I=t[a+1];g!==void 0&&(m=k-g,y=I-S,d=Math.sqrt(m*m+y*y),_!==void 0&&(r+=u,h=Math.acos((_*m+p*y)/(u*d)),h>x&&(r>l&&(l=r,n=c,o=a),r=0,c=a-e)),u=d,_=m,p=y),g=k,S=I}return r+=d,r>l?[c,a]:[n,o]}const Lt={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class di extends St{constructor(t,s,i,e){super(t,s,i,e),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[z]={fillStyle:z},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,s,i){const e=this.textFillState_,n=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!e&&!n)return;const l=this.coordinates;let r=l.length;const c=t.getType();let h=null,a=t.getStride();if(o.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!Ht(this.maxExtent,t.getExtent()))return;let u;if(h=t.getFlatCoordinates(),c=="LineString")u=[h.length];else if(c=="MultiLineString")u=t.getEnds();else if(c=="Polygon")u=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){const _=t.getEndss();u=[];for(let p=0,m=_.length;p<m;++p)u.push(_[p][0])}this.beginGeometry(t,s,i);const d=o.repeat,g=d?void 0:o.textAlign;let S=0;for(let _=0,p=u.length;_<p;++_){let m;d?m=ai(d*this.resolution,h,S,u[_],a):m=[h.slice(S,u[_])];for(let y=0,k=m.length;y<k;++y){const I=m[y];let L=0,R=I.length;if(g==null){const E=ci(o.maxAngle,I,0,I.length,2);L=E[0],R=E[1]}for(let E=L;E<R;E+=a)l.push(I[E],I[E+1]);const b=l.length;S=u[_],this.drawChars_(r,b),r=b}}this.endGeometry(s)}else{let u=o.overflow?null:[];switch(c){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),a=2;break;case"Polygon":h=t.getFlatInteriorPoint(),o.overflow||u.push(h[2]/this.resolution),a=3;break;case"MultiPolygon":const m=t.getFlatInteriorPoints();h=[];for(let y=0,k=m.length;y<k;y+=3)o.overflow||u.push(m[y+2]/this.resolution),h.push(m[y],m[y+1]);if(h.length===0)return;a=2;break}const d=this.appendFlatPointCoordinates(h,a);if(d===r)return;if(u&&(d-r)/2!==h.length/a){let m=r/2;u=u.filter((y,k)=>{const I=l[(m+k)*2]===h[k*a]&&l[(m+k)*2+1]===h[k*a+1];return I||--m,I})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,s,i);let g=o.padding;if(g!=ot&&(o.scale[0]<0||o.scale[1]<0)){let m=o.padding[0],y=o.padding[1],k=o.padding[2],I=o.padding[3];o.scale[0]<0&&(y=-y,I=-I),o.scale[1]<0&&(m=-m,k=-k),g=[m,y,k,I]}const S=this.pixelRatio;this.instructions.push([C.DRAW_IMAGE,r,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==ot?ot:g.map(function(m){return m*S}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);const _=1/S,p=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=z,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([C.DRAW_IMAGE,r,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[_,_],NaN,this.declutterMode_,this.declutterImageWithText_,g,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?z:this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),o.backgroundFill&&(this.state.fillStyle=p,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(s)}}saveTextStates_(){const t=this.textStrokeState_,s=this.textState_,i=this.textFillState_,e=this.strokeKey_;t&&(e in this.strokeStates||(this.strokeStates[e]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const n=this.textKey_;n in this.textStates||(this.textStates[n]={font:s.font,textAlign:s.textAlign||Gt,justify:s.justify,textBaseline:s.textBaseline||Nt,scale:s.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,s){const i=this.textStrokeState_,e=this.textState_,n=this.strokeKey_,o=this.textKey_,l=this.fillKey_;this.saveTextStates_();const r=this.pixelRatio,c=Lt[e.textBaseline],h=this.textOffsetY_*r,a=this.text_,u=i?i.lineWidth*Math.abs(e.scale[0])/2:0;this.instructions.push([C.DRAW_CHARS,t,s,c,e.overflow,l,e.maxAngle,r,h,n,u*r,a,o,1,this.declutterMode_]),this.hitDetectionInstructions.push([C.DRAW_CHARS,t,s,c,e.overflow,l&&z,e.maxAngle,r,h,n,u*r,a,o,1/r,this.declutterMode_])}setTextStyle(t,s){let i,e,n;if(!t)this.text_="";else{const o=t.getFill();o?(e=this.textFillState_,e||(e={},this.textFillState_=e),e.fillStyle=Et(o.getColor()||z)):(e=null,this.textFillState_=e);const l=t.getStroke();if(!l)n=null,this.textStrokeState_=n;else{n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);const g=l.getLineDash(),S=l.getLineDashOffset(),_=l.getWidth(),p=l.getMiterLimit();n.lineCap=l.getLineCap()||_e,n.lineDash=g?g.slice():rt,n.lineDashOffset=S===void 0?ht:S,n.lineJoin=l.getLineJoin()||pe,n.lineWidth=_===void 0?xe:_,n.miterLimit=p===void 0?Se:p,n.strokeStyle=Et(l.getColor()||ge)}i=this.textState_;const r=t.getFont()||Ne;Xe(r);const c=t.getScaleArray();i.overflow=t.getOverflow(),i.font=r,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Nt,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||ot,i.scale=c===void 0?[1,1]:c;const h=t.getOffsetX(),a=t.getOffsetY(),u=t.getRotateWithView(),d=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=h===void 0?0:h,this.textOffsetY_=a===void 0?0:a,this.textRotateWithView_=u===void 0?!1:u,this.textRotation_=d===void 0?0:d,this.strokeKey_=n?(typeof n.strokeStyle=="string"?n.strokeStyle:le(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=e&&e.fillStyle?typeof e.fillStyle=="string"?e.fillStyle:"|"+le(e.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=s}}const ui={Circle:de,Default:St,Image:oi,LineString:ri,Polygon:de,Text:di};class fi{constructor(t,s,i,e){this.tolerance_=t,this.maxExtent_=s,this.pixelRatio_=e,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const s in this.buildersByZIndex_){t[s]=t[s]||{};const i=this.buildersByZIndex_[s];for(const e in i){const n=i[e].finish();t[s][e]=n}}return t}getBuilder(t,s){const i=t!==void 0?t.toString():"0";let e=this.buildersByZIndex_[i];e===void 0&&(e={},this.buildersByZIndex_[i]=e);let n=e[s];if(n===void 0){const o=ui[s];n=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),e[s]=n}return n}}const Ei=fi;function gi(x,t,s,i,e,n,o,l,r,c,h,a){let u=x[t],d=x[t+1],g=0,S=0,_=0,p=0;function m(){g=u,S=d,t+=i,u=x[t],d=x[t+1],p+=_,_=Math.sqrt((u-g)*(u-g)+(d-S)*(d-S))}do m();while(t<s-i&&p+_<n);let y=_===0?0:(n-p)/_;const k=V(g,u,y),I=V(S,d,y),L=t-i,R=p,b=n+l*r(c,e,h);for(;t<s-i&&p+_<b;)m();y=_===0?0:(b-p)/_;const E=V(g,u,y),A=V(S,d,y);let M;if(a){const T=[k,I,E,A];Ke(T,0,4,2,a,T,T),M=T[0]>T[2]}else M=k>E;const D=Math.PI,w=[],H=L+i===t;t=L,_=0,p=R,u=x[t],d=x[t+1];let P;if(H){m(),P=Math.atan2(d-S,u-g),M&&(P+=P>0?-D:D);const T=(E+k)/2,Y=(A+I)/2;return w[0]=[T,Y,(b-n)/2,P,e],w}e=e.replace(/\n/g," ");for(let T=0,Y=e.length;T<Y;){m();let O=Math.atan2(d-S,u-g);if(M&&(O+=O>0?-D:D),P!==void 0){let f=O-P;if(f+=f>D?-2*D:f<-D?2*D:0,Math.abs(f)>o)return null}P=O;const N=T;let F=0;for(;T<Y;++T){const f=M?Y-T-1:T,Tt=l*r(c,e[f],h);if(t+i<s&&p+_<n+F+Tt/2)break;F+=Tt}if(T===N)continue;const B=M?e.substring(Y-N,Y-T):e.substring(N,T);y=_===0?0:(n+F/2-p)/_;const v=V(g,u,y),tt=V(S,d,y);w.push([v,tt,F/2,O,B]),n+=F}return w}const at=ke(),et=[],$=[],Q=[],it=[];function ue(x){return x[3].declutterBox}const fe=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Bt(x,t){return t==="start"?t=fe.test(x)?"right":"left":t==="end"&&(t=fe.test(x)?"left":"right"),Lt[t]}function _i(x,t,s){return s>0&&x.push(`
`,""),x.push(t,""),x}class pi{constructor(t,s,i,e,n){this.overlaps=i,this.pixelRatio=s,this.resolution=t,this.alignAndScaleFill_,this.instructions=e.instructions,this.coordinates=e.coordinates,this.coordinateCache_={},this.renderedTransform_=Xt(),this.hitDetectionInstructions=e.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=e.fillStates||{},this.strokeStates=e.strokeStates||{},this.textStates=e.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=n?new Qe:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,s,i,e){const n=t+s+i+e;if(this.labels_[n])return this.labels_[n];const o=e?this.strokeStates[e]:null,l=i?this.fillStates[i]:null,r=this.textStates[s],c=this.pixelRatio,h=[r.scale[0]*c,r.scale[1]*c],a=Array.isArray(t),u=r.justify?Lt[r.justify]:Bt(Array.isArray(t)?t[0]:t,r.textAlign||Gt),d=e&&o.lineWidth?o.lineWidth:0,g=a?t:t.split(`
`).reduce(_i,[]),{width:S,height:_,widths:p,heights:m,lineWidths:y}=Ze(r,g),k=S+d,I=[],L=(k+2)*h[0],R=(_+d)*h[1],b={width:L<0?Math.floor(L):Math.ceil(L),height:R<0?Math.floor(R):Math.ceil(R),contextInstructions:I};(h[0]!=1||h[1]!=1)&&I.push("scale",h),e&&(I.push("strokeStyle",o.strokeStyle),I.push("lineWidth",d),I.push("lineCap",o.lineCap),I.push("lineJoin",o.lineJoin),I.push("miterLimit",o.miterLimit),I.push("setLineDash",[o.lineDash]),I.push("lineDashOffset",o.lineDashOffset)),i&&I.push("fillStyle",l.fillStyle),I.push("textBaseline","middle"),I.push("textAlign","center");const E=.5-u;let A=u*k+E*d;const M=[],D=[];let w=0,H=0,P=0,T=0,Y;for(let O=0,N=g.length;O<N;O+=2){const F=g[O];if(F===`
`){H+=w,w=0,A=u*k+E*d,++T;continue}const B=g[O+1]||r.font;B!==Y&&(e&&M.push("font",B),i&&D.push("font",B),Y=B),w=Math.max(w,m[P]);const v=[F,A+E*p[P]+u*(p[P]-y[T]),.5*(d+w)+H];A+=p[P],e&&M.push("strokeText",v),i&&D.push("fillText",v),++P}return Array.prototype.push.apply(I,M),Array.prototype.push.apply(I,D),this.labels_[n]=b,b}replayTextBackground_(t,s,i,e,n,o,l){t.beginPath(),t.moveTo.apply(t,s),t.lineTo.apply(t,i),t.lineTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,s),o&&(this.alignAndScaleFill_=o[2],this.fill_(t)),l&&(this.setStrokeStyle_(t,l),t.stroke())}calculateImageOrLabelDimensions_(t,s,i,e,n,o,l,r,c,h,a,u,d,g,S,_){l*=u[0],r*=u[1];let p=i-l,m=e-r;const y=n+c>t?t-c:n,k=o+h>s?s-h:o,I=g[3]+y*u[0]+g[1],L=g[0]+k*u[1]+g[2],R=p-g[3],b=m-g[0];(S||a!==0)&&(et[0]=R,it[0]=R,et[1]=b,$[1]=b,$[0]=R+I,Q[0]=$[0],Q[1]=b+L,it[1]=Q[1]);let E;return a!==0?(E=Ie(Xt(),i,e,1,1,a,-i,-e),_t(E,et),_t(E,$),_t(E,Q),_t(E,it),re(Math.min(et[0],$[0],Q[0],it[0]),Math.min(et[1],$[1],Q[1],it[1]),Math.max(et[0],$[0],Q[0],it[0]),Math.max(et[1],$[1],Q[1],it[1]),at)):re(Math.min(R,R+I),Math.min(b,b+L),Math.max(R,R+I),Math.max(b,b+L),at),d&&(p=Math.round(p),m=Math.round(m)),{drawImageX:p,drawImageY:m,drawImageW:y,drawImageH:k,originX:c,originY:h,declutterBox:{minX:at[0],minY:at[1],maxX:at[2],maxY:at[3],value:_},canvasTransform:E,scale:u}}replayImageOrLabel_(t,s,i,e,n,o,l){const r=!!(o||l),c=e.declutterBox,h=l?l[2]*e.scale[0]/2:0;return c.minX-h<=s[0]&&c.maxX+h>=0&&c.minY-h<=s[1]&&c.maxY+h>=0&&(r&&this.replayTextBackground_(t,et,$,Q,it,o,l),He(t,e.canvasTransform,n,i,e.originX,e.originY,e.drawImageW,e.drawImageH,e.drawImageX,e.drawImageY,e.scale)),!0}fill_(t){const s=this.alignAndScaleFill_;if(s){const i=_t(this.renderedTransform_,[0,0]),e=512*this.pixelRatio;t.save(),t.translate(i[0]%e,i[1]%e),s!==1&&t.scale(s,s),t.rotate(this.viewRotation_)}t.fill(),s&&t.restore()}setStrokeStyle_(t,s){t.strokeStyle=s[1],t.lineWidth=s[2],t.lineCap=s[3],t.lineJoin=s[4],t.miterLimit=s[5],t.lineDashOffset=s[7],t.setLineDash(s[6])}drawLabelWithPointPlacement_(t,s,i,e){const n=this.textStates[s],o=this.createLabel(t,s,e,i),l=this.strokeStates[i],r=this.pixelRatio,c=Bt(Array.isArray(t)?t[0]:t,n.textAlign||Gt),h=Lt[n.textBaseline||Nt],a=l&&l.lineWidth?l.lineWidth:0,u=o.width/r-2*n.scale[0],d=c*u+2*(.5-c)*a,g=h*o.height/r+2*(.5-h)*a;return{label:o,anchorX:d,anchorY:g}}execute_(t,s,i,e,n,o,l,r){const c=this.zIndexContext_;let h;this.pixelCoordinates_&&me(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Ce(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Je(this.renderedTransform_,i));let a=0;const u=e.length;let d=0,g,S,_,p,m,y,k,I,L,R,b,E,A,M=0,D=0,w=null,H=null;const P=this.coordinateCache_,T=this.viewRotation_,Y=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,O={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:T},N=this.instructions!=e||this.overlaps?0:200;let F,B,v,tt;for(;a<u;){const f=e[a];switch(f[0]){case C.BEGIN_GEOMETRY:F=f[1],tt=f[3],F.getGeometry()?l!==void 0&&!Ht(l,tt.getExtent())?a=f[2]+1:++a:a=f[2],c&&(c.zIndex=f[4]);break;case C.BEGIN_PATH:M>N&&(this.fill_(t),M=0),D>N&&(t.stroke(),D=0),!M&&!D&&(t.beginPath(),m=NaN,y=NaN),++a;break;case C.CIRCLE:d=f[1];const Dt=h[d],Rt=h[d+1],be=h[d+2],Ee=h[d+3],Jt=be-Dt,zt=Ee-Rt,Vt=Math.sqrt(Jt*Jt+zt*zt);t.moveTo(Dt+Vt,Rt),t.arc(Dt,Rt,Vt,0,2*Math.PI,!0),++a;break;case C.CLOSE_PATH:t.closePath(),++a;break;case C.CUSTOM:d=f[1],g=f[2];const Le=f[3],Te=f[4],Ut=f[5];O.geometry=Le,O.feature=F,a in P||(P[a]=[]);const ct=P[a];Ut?Ut(h,d,g,2,ct):(ct[0]=h[d],ct[1]=h[d+1],ct.length=2),c&&(c.zIndex=f[6]),Te(ct,O),++a;break;case C.DRAW_IMAGE:d=f[1],g=f[2],L=f[3],S=f[4],_=f[5];let Mt=f[6];const De=f[7],Re=f[8],Me=f[9],jt=f[10];let wt=f[11];const we=f[12];let mt=f[13];p=f[14]||"declutter";const dt=f[15];if(!L&&f.length>=20){R=f[19],b=f[20],E=f[21],A=f[22];const X=this.drawLabelWithPointPlacement_(R,b,E,A);L=X.label,f[3]=L;const nt=f[23];S=(X.anchorX-nt)*this.pixelRatio,f[4]=S;const K=f[24];_=(X.anchorY-K)*this.pixelRatio,f[5]=_,Mt=L.height,f[6]=Mt,mt=L.width,f[13]=mt}let Ot;f.length>25&&(Ot=f[25]);let Ft,yt,It;f.length>17?(Ft=f[16],yt=f[17],It=f[18]):(Ft=ot,yt=!1,It=!1),jt&&Y?wt+=T:!jt&&!Y&&(wt-=T);let Oe=0;for(;d<g;d+=2){if(Ot&&Ot[Oe++]<mt/this.pixelRatio)continue;const X=this.calculateImageOrLabelDimensions_(L.width,L.height,h[d],h[d+1],mt,Mt,S,_,Re,Me,wt,we,n,Ft,yt||It,F),nt=[t,s,L,X,De,yt?w:null,It?H:null];if(r){let K,J,Z;if(dt){const W=g-d;if(!dt[W]){dt[W]={args:nt,declutterMode:p};continue}const G=dt[W];K=G.args,J=G.declutterMode,delete dt[W],Z=ue(K)}let U,j;if(K&&(J!=="declutter"||!r.collides(Z))&&(U=!0),(p!=="declutter"||!r.collides(X.declutterBox))&&(j=!0),J==="declutter"&&p==="declutter"){const W=U&&j;U=W,j=W}U&&(J!=="none"&&r.insert(Z),this.replayImageOrLabel_.apply(this,K)),j&&(p!=="none"&&r.insert(X.declutterBox),this.replayImageOrLabel_.apply(this,nt))}else this.replayImageOrLabel_.apply(this,nt)}++a;break;case C.DRAW_CHARS:const qt=f[1],$t=f[2],Wt=f[3],Fe=f[4];A=f[5];const We=f[6],Qt=f[7],te=f[8];E=f[9];const At=f[10];R=f[11],b=f[12];const ee=[f[13],f[13]];p=f[14]||"declutter";const Pt=this.textStates[b],ut=Pt.font,ft=[Pt.scale[0]*Qt,Pt.scale[1]*Qt];let gt;ut in this.widths_?gt=this.widths_[ut]:(gt={},this.widths_[ut]=gt);const ie=ii(h,qt,$t,2),se=Math.abs(ft[0])*he(ut,R,gt);if(Fe||se<=ie){const X=this.textStates[b].textAlign,nt=(ie-se)*Bt(R,X),K=gi(h,qt,$t,2,R,nt,We,Math.abs(ft[0]),he,ut,gt,Y?0:this.viewRotation_);t:if(K){const J=[];let Z,U,j,W,G;if(E)for(Z=0,U=K.length;Z<U;++Z){G=K[Z],j=G[4],W=this.createLabel(j,b,"",E),S=G[2]+(ft[0]<0?-At:At),_=Wt*W.height+(.5-Wt)*2*At*ft[1]/ft[0]-te;const q=this.calculateImageOrLabelDimensions_(W.width,W.height,G[0],G[1],W.width,W.height,S,_,0,0,G[3],ee,!1,ot,!1,F);if(r&&p==="declutter"&&r.collides(q.declutterBox))break t;J.push([t,s,W,q,1,null,null])}if(A)for(Z=0,U=K.length;Z<U;++Z){G=K[Z],j=G[4],W=this.createLabel(j,b,A,""),S=G[2],_=Wt*W.height-te;const q=this.calculateImageOrLabelDimensions_(W.width,W.height,G[0],G[1],W.width,W.height,S,_,0,0,G[3],ee,!1,ot,!1,F);if(r&&p==="declutter"&&r.collides(q.declutterBox))break t;J.push([t,s,W,q,1,null,null])}r&&p!=="none"&&r.load(J.map(ue));for(let q=0,Ae=J.length;q<Ae;++q)this.replayImageOrLabel_.apply(this,J[q])}}++a;break;case C.END_GEOMETRY:if(o!==void 0){F=f[1];const X=o(F,tt);if(X)return X}++a;break;case C.FILL:N?M++:this.fill_(t),++a;break;case C.MOVE_TO_LINE_TO:for(d=f[1],g=f[2],B=h[d],v=h[d+1],k=B+.5|0,I=v+.5|0,(k!==m||I!==y)&&(t.moveTo(B,v),m=k,y=I),d+=2;d<g;d+=2)B=h[d],v=h[d+1],k=B+.5|0,I=v+.5|0,(d==g-2||k!==m||I!==y)&&(t.lineTo(B,v),m=k,y=I);++a;break;case C.SET_FILL_STYLE:w=f,this.alignAndScaleFill_=f[2],M&&(this.fill_(t),M=0,D&&(t.stroke(),D=0)),t.fillStyle=f[1],++a;break;case C.SET_STROKE_STYLE:H=f,D&&(t.stroke(),D=0),this.setStrokeStyle_(t,f),++a;break;case C.STROKE:N?D++:t.stroke(),++a;break;default:++a;break}}M&&this.fill_(t),D&&t.stroke()}execute(t,s,i,e,n,o){this.viewRotation_=e,this.execute_(t,s,i,this.instructions,n,void 0,void 0,o)}executeHitDetection(t,s,i,e,n){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],s,this.hitDetectionInstructions,!0,e,n)}}const xi=pi,bt=["Polygon","Circle","LineString","Image","Text","Default"],Si=["Image","Text"],Li=bt.filter(x=>!Si.includes(x));class mi{constructor(t,s,i,e,n,o,l){this.maxExtent_=t,this.overlaps_=e,this.pixelRatio_=i,this.resolution_=s,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Xt(),this.renderedContext_=null,this.deferredZIndexContexts_=[],this.createExecutors_(n,l)}clip(t,s){const i=this.getClipCoords(s);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,s){for(const i in t){let e=this.executorsByZIndex_[i];e===void 0&&(e={},this.executorsByZIndex_[i]=e);const n=t[i];for(const o in n){const l=n[o];e[o]=new xi(this.resolution_,this.pixelRatio_,this.overlaps_,l,s)}}}hasExecutors(t){for(const s in this.executorsByZIndex_){const i=this.executorsByZIndex_[s];for(let e=0,n=t.length;e<n;++e)if(t[e]in i)return!0}return!1}forEachFeatureAtCoordinate(t,s,i,e,n,o){e=Math.round(e);const l=e*2+1,r=Ie(this.hitDetectionTransform_,e+.5,e+.5,1/s,-1/s,-i,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=Kt(l,l,void 0,{willReadFrequently:!0}));const h=this.hitDetectionContext_;h.canvas.width!==l||h.canvas.height!==l?(h.canvas.width=l,h.canvas.height=l):c||h.clearRect(0,0,l,l);let a;this.renderBuffer_!==void 0&&(a=ke(),ze(a,t),ye(a,s*(this.renderBuffer_+e),a));const u=yi(e);let d;function g(I,L){const R=h.getImageData(0,0,l,l).data;for(let b=0,E=u.length;b<E;b++)if(R[u[b]]>0){if(!o||d!=="Image"&&d!=="Text"||o.includes(I)){const A=(u[b]-3)/4,M=e-A%l,D=e-(A/l|0),w=n(I,L,M*M+D*D);if(w)return w}h.clearRect(0,0,l,l);break}}const S=Object.keys(this.executorsByZIndex_).map(Number);S.sort(Zt);let _,p,m,y,k;for(_=S.length-1;_>=0;--_){const I=S[_].toString();for(m=this.executorsByZIndex_[I],p=bt.length-1;p>=0;--p)if(d=bt[p],y=m[d],y!==void 0&&(k=y.executeHitDetection(h,r,i,g,a),k))return k}}getClipCoords(t){const s=this.maxExtent_;if(!s)return null;const i=s[0],e=s[1],n=s[2],o=s[3],l=[i,e,i,o,n,o,n,e];return Ce(l,0,8,2,t,l),l}isEmpty(){return Ve(this.executorsByZIndex_)}execute(t,s,i,e,n,o,l){const r=Object.keys(this.executorsByZIndex_).map(Number);r.sort(Zt),o=o||bt;let c,h,a,u,d,g;for(l&&r.reverse(),c=0,h=r.length;c<h;++c){const S=r[c].toString();for(d=this.executorsByZIndex_[S],a=0,u=o.length;a<u;++a){const _=o[a];if(g=d[_],g!==void 0){const p=l===null?void 0:g.getZIndexContext(),m=p?p.getContext():t,y=this.maxExtent_&&_!=="Image"&&_!=="Text";if(y&&(m.save(),this.clip(m,i)),g.execute(m,s,i,e,n,l),y&&m.restore(),p){p.offset();const k=r[c];this.deferredZIndexContexts_[k]||(this.deferredZIndexContexts_[k]=[]),this.deferredZIndexContexts_[k].push(p)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){this.deferredZIndexContexts_.forEach(t=>{t.forEach(s=>{s.draw(this.renderedContext_),s.clear()})})}}const Yt={};function yi(x){if(Yt[x]!==void 0)return Yt[x];const t=x*2+1,s=x*x,i=new Array(s+1);for(let n=0;n<=x;++n)for(let o=0;o<=x;++o){const l=n*n+o*o;if(l>s)break;let r=i[l];r||(r=[],i[l]=r),r.push(((x+n)*t+(x+o))*4+3),n>0&&r.push(((x-n)*t+(x+o))*4+3),o>0&&(r.push(((x+n)*t+(x-o))*4+3),n>0&&r.push(((x-n)*t+(x-o))*4+3))}const e=[];for(let n=0,o=i.length;n<o;++n)i[n]&&e.push(...i[n]);return Yt[x]=e,e}const Ti=mi,pt=.5;function Di(x,t,s,i,e,n,o,l,r){const c=r?$e(e):e,h=x[0]*pt,a=x[1]*pt,u=Kt(h,a);u.imageSmoothingEnabled=!1;const d=u.canvas,g=new ei(u,pt,e,null,o,l,r?Ue(je(),r):null),S=s.length,_=Math.floor((256*256*256-1)/S),p={};for(let y=1;y<=S;++y){const k=s[y-1],I=k.getStyleFunction()||i;if(!I)continue;let L=I(k,n);if(!L)continue;Array.isArray(L)||(L=[L]);const b=(y*_).toString(16).padStart(7,"#00000");for(let E=0,A=L.length;E<A;++E){const M=L[E],D=M.getGeometryFunction()(k);if(!D||!Ht(c,D.getExtent()))continue;const w=M.clone(),H=w.getFill();H&&H.setColor(b);const P=w.getStroke();P&&(P.setColor(b),P.setLineDash(null)),w.setText(void 0);const T=M.getImage();if(T){const F=T.getImageSize();if(!F)continue;const B=Kt(F[0],F[1],void 0,{alpha:!1}),v=B.canvas;B.fillStyle=b,B.fillRect(0,0,v.width,v.height),w.setImage(new qe({img:v,anchor:T.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:T.getOrigin(),opacity:1,size:T.getSize(),scale:T.getScale(),rotation:T.getRotation(),rotateWithView:T.getRotateWithView()}))}const Y=w.getZIndex()||0;let O=p[Y];O||(O={},p[Y]=O,O.Polygon=[],O.Circle=[],O.LineString=[],O.Point=[]);const N=D.getType();if(N==="GeometryCollection"){const F=D.getGeometriesArrayRecursive();for(let B=0,v=F.length;B<v;++B){const tt=F[B];O[tt.getType().replace("Multi","")].push(tt,w)}}else O[N.replace("Multi","")].push(D,w)}}const m=Object.keys(p).map(Number).sort(Zt);for(let y=0,k=m.length;y<k;++y){const I=p[m[y]];for(const L in I){const R=I[L];for(let b=0,E=R.length;b<E;b+=2){g.setStyle(R[b+1]);for(let A=0,M=t.length;A<M;++A)g.setTransform(t[A]),g.drawGeometry(R[b])}}}return u.getImageData(0,0,d.width,d.height)}function Ri(x,t,s){const i=[];if(s){const e=Math.floor(Math.round(x[0])*pt),n=Math.floor(Math.round(x[1])*pt),o=(ae(e,0,s.width-1)+ae(n,0,s.height-1)*s.width)*4,l=s.data[o],r=s.data[o+1],h=s.data[o+2]+256*(r+256*l),a=Math.floor((256*256*256-1)/t.length);h&&h%a===0&&i.push(t[h/a-1])}return i}export{bt as A,Ei as C,Si as D,Ti as E,pt as H,Li as N,Di as c,Ri as h};
