import{cB as de,ca as pe,g as G,b$ as fe,K as D,G as N,L as me,aF as ge,P as ee,U as he}from"./Layer-3b715193.js";import{F as L}from"./featureloader-a90a5108.js";import{L as Z}from"./LineString-eed53b5a.js";import{a as te,M as ye}from"./MultiPolygon-d7736349.js";import{m as h,X as Ee,p as Re,i as _e,a as A,c as ne,b as j,d as x,e as Y,f as l,r as f,g as C,h as w,j as c,k as _,w as y,l as O,n as re,o as P,q as Ae,s as se,O as v,t as B,u as Te}from"./KML-c43cd689.js";import{t as T}from"./Feature-627996e0.js";import{T as Pe}from"./TextFeature-d99bec1a.js";import{J as xe}from"./JSONFeature-5a5c1876.js";import{M as Se}from"./MultiPoint-74fca651.js";const Ne={ADD_FEATURES:"addfeatures"};class we extends ge{constructor(e,n,t,s){super(e),this.features=t,this.file=n,this.projection=s}}class Le extends de{constructor(e){e=e||{},super({handleEvent:pe}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const n=e.formatConstructors?e.formatConstructors:[];for(let t=0,s=n.length;t<s;++t){let o=n[t];typeof o=="function"&&(o=new o),this.formats_.push(o),this.readAsBuffer_=this.readAsBuffer_||o.getType()==="arraybuffer"}this.projection_=e.projection?G(e.projection):null,this.dropListenKeys_=null,this.source_=e.source||null,this.target=e.target?e.target:null}handleResult_(e,n){const t=n.target.result,s=this.getMap();let o=this.projection_;o||(o=fe(),o||(o=s.getView().getProjection()));let i;const a=this.formats_;for(let u=0,d=a.length;u<d;++u){const g=a[u];let E=t;this.readAsBuffer_&&g.getType()!=="arraybuffer"&&(i===void 0&&(i=new TextDecoder().decode(t)),E=i);const R=this.tryReadFeatures_(g,E,{featureProjection:o});if(R&&R.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(R)),this.dispatchEvent(new we(Ne.ADD_FEATURES,e,R,o));break}}}registerListeners_(){const e=this.getMap();if(e){const n=this.target?this.target:e.getViewport();this.dropListenKeys_=[D(n,N.DROP,this.handleDrop,this),D(n,N.DRAGENTER,this.handleStop,this),D(n,N.DRAGOVER,this.handleStop,this),D(n,N.DROP,this.handleStop,this)]}}setActive(e){!this.getActive()&&e&&this.registerListeners_(),this.getActive()&&!e&&this.unregisterListeners_(),super.setActive(e)}setMap(e){this.unregisterListeners_(),super.setMap(e),this.getActive()&&this.registerListeners_()}tryReadFeatures_(e,n,t){try{return e.readFeatures(n,t)}catch{return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(me),this.dropListenKeys_=null)}handleDrop(e){const n=e.dataTransfer.files;for(let t=0,s=n.length;t<s;++t){const o=n.item(t),i=new FileReader;i.addEventListener(N.LOAD,this.handleResult_.bind(this,o)),this.readAsBuffer_?i.readAsArrayBuffer(o):i.readAsText(o)}}handleStop(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}}const kt=Le,p=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Fe="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Me={rte:oe,trk:ie,wpt:ae},Ie=h(p,{rte:Y(oe),trk:Y(ie),wpt:Y(ae)}),De=h(p,{text:l(f,"linkText"),type:l(f,"linkType")}),Oe=h(p,{name:l(f),email:it,link:F}),Ge=h(p,{name:l(f),desc:l(f),author:l(rt),copyright:l(st),link:F,time:l(C),keywords:l(f),bounds:ot,extensions:U}),Ce=h(p,{year:l(w),license:l(f)}),ve=h(p,{rte:c(ct),trk:c(dt),wpt:c(ft)});class Ue extends Ee{constructor(e){super(),e=e||{},this.dataProjection=G("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let n=0,t=e.length;n<t;++n){const s=e[n];if(this.readExtensions_){const o=s.get("extensionsNode_")||null;this.readExtensions_(s,o)}s.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(Re(e)):_e(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let n=e.firstChild;n;n=n.nextSibling)if(n.nodeType===Node.ELEMENT_NODE){const t=this.readMetadataFromNode(n);if(t)return t}return null}readMetadataFromNode(e){if(!p.includes(e.namespaceURI))return null;for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(p.includes(n.namespaceURI)&&n.localName==="metadata")return A({},Ge,n,[]);return null}readFeatureFromNode(e,n){if(!p.includes(e.namespaceURI))return null;const t=Me[e.localName];if(!t)return null;const s=t(e,[this.getReadOptions(e,n)]);return s?(this.handleReadExtensions_([s]),s):null}readFeaturesFromNode(e,n){if(!p.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const t=A([],Ie,e,[this.getReadOptions(e,n)]);return t?(this.handleReadExtensions_(t),t):[]}return[]}writeFeaturesNode(e,n){n=this.adaptOptions(n);const t=ne("http://www.topografix.com/GPX/1/1","gpx"),s="http://www.w3.org/2000/xmlns/";return t.setAttributeNS(s,"xmlns:xsi",j),t.setAttributeNS(j,"xsi:schemaLocation",Fe),t.setAttribute("version","1.1"),t.setAttribute("creator","OpenLayers"),x({node:t},ve,nt,e,[n]),t}}const Xe=h(p,{name:l(f),cmt:l(f),desc:l(f),src:l(f),link:F,number:l(w),extensions:U,type:l(f),rtept:at}),ke=h(p,{ele:l(_),time:l(C)}),Ke=h(p,{name:l(f),cmt:l(f),desc:l(f),src:l(f),link:F,number:l(w),type:l(f),extensions:U,trkseg:ut}),Ye=h(p,{trkpt:lt}),Ze=h(p,{ele:l(_),time:l(C)}),Be=h(p,{ele:l(_),time:l(C),magvar:l(_),geoidheight:l(_),name:l(f),cmt:l(f),desc:l(f),src:l(f),link:F,sym:l(f),type:l(f),fix:l(f),sat:l(w),hdop:l(_),vdop:l(_),pdop:l(_),ageofdgpsdata:l(_),dgpsid:l(w),extensions:U}),We=["text","type"],He=h(p,{text:c(y),type:c(y)}),Je=h(p,["name","cmt","desc","src","link","number","type","rtept"]),Ve=h(p,{name:c(y),cmt:c(y),desc:c(y),src:c(y),link:c(J),number:c(O),type:c(y),rtept:re(c(V))}),$e=h(p,["ele","time"]),be=h(p,["name","cmt","desc","src","link","number","type","trkseg"]),Qe=h(p,{name:c(y),cmt:c(y),desc:c(y),src:c(y),link:c(J),number:c(O),type:c(y),trkseg:re(c(pt))}),ze=Te("trkpt"),qe=h(p,{trkpt:c(V)}),je=h(p,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),et=h(p,{ele:c(P),time:c(Ae),magvar:c(P),geoidheight:c(P),name:c(y),cmt:c(y),desc:c(y),src:c(y),link:c(J),sym:c(y),type:c(y),fix:c(y),sat:c(O),hdop:c(P),vdop:c(P),pdop:c(P),ageofdgpsdata:c(P),dgpsid:c(O)}),tt={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function nt(r,e,n){const t=r.getGeometry();if(t){const s=tt[t.getType()];if(s){const o=e[e.length-1].node;return ne(o.namespaceURI,s)}}}function W(r,e,n,t){return r.push(parseFloat(n.getAttribute("lon")),parseFloat(n.getAttribute("lat"))),"ele"in t?(r.push(t.ele),delete t.ele,e.hasZ=!0):r.push(0),"time"in t?(r.push(t.time),delete t.time,e.hasM=!0):r.push(0),r}function H(r,e,n){let t="XY",s=2;if(r.hasZ&&r.hasM?(t="XYZM",s=4):r.hasZ?(t="XYZ",s=3):r.hasM&&(t="XYM",s=3),s!==4){for(let o=0,i=e.length/4;o<i;o++)e[o*s]=e[o*4],e[o*s+1]=e[o*4+1],r.hasZ&&(e[o*s+2]=e[o*4+2]),r.hasM&&(e[o*s+2]=e[o*4+3]);if(e.length=e.length/4*s,n)for(let o=0,i=n.length;o<i;o++)n[o]=n[o]/4*s}return t}function rt(r,e){const n=A({},Oe,r,e);if(n)return n}function st(r,e){const n=A({},Ce,r,e);if(n){const t=r.getAttribute("author");return t!==null&&(n.author=t),n}}function ot(r,e){const n=e[e.length-1],t=r.getAttribute("minlat"),s=r.getAttribute("minlon"),o=r.getAttribute("maxlat"),i=r.getAttribute("maxlon");s!==null&&t!==null&&i!==null&&o!==null&&(n.bounds=[[parseFloat(s),parseFloat(t)],[parseFloat(i),parseFloat(o)]])}function it(r,e){const n=e[e.length-1],t=r.getAttribute("id"),s=r.getAttribute("domain");t!==null&&s!==null&&(n.email=`${t}@${s}`)}function F(r,e){const n=e[e.length-1],t=r.getAttribute("href");t!==null&&(n.link=t),se(De,r,e)}function U(r,e){const n=e[e.length-1];n.extensionsNode_=r}function at(r,e){const n=A({},ke,r,e);if(n){const t=e[e.length-1],s=t.flatCoordinates,o=t.layoutOptions;W(s,o,r,n)}}function lt(r,e){const n=A({},Ze,r,e);if(n){const t=e[e.length-1],s=t.flatCoordinates,o=t.layoutOptions;W(s,o,r,n)}}function ut(r,e){const n=e[e.length-1];se(Ye,r,e);const t=n.flatCoordinates;n.ends.push(t.length)}function oe(r,e){const n=e[0],t=A({flatCoordinates:[],layoutOptions:{}},Xe,r,e);if(!t)return;const s=t.flatCoordinates;delete t.flatCoordinates;const o=t.layoutOptions;delete t.layoutOptions;const i=H(o,s),a=new Z(s,i);T(a,!1,n);const u=new L(a);return u.setProperties(t,!0),u}function ie(r,e){const n=e[0],t=A({flatCoordinates:[],ends:[],layoutOptions:{}},Ke,r,e);if(!t)return;const s=t.flatCoordinates;delete t.flatCoordinates;const o=t.ends;delete t.ends;const i=t.layoutOptions;delete t.layoutOptions;const a=H(i,s,o),u=new te(s,a,o);T(u,!1,n);const d=new L(u);return d.setProperties(t,!0),d}function ae(r,e){const n=e[0],t=A({},Be,r,e);if(!t)return;const s={},o=W([],s,r,t),i=H(s,o),a=new ee(o,i);T(a,!1,n);const u=new L(a);return u.setProperties(t,!0),u}function J(r,e,n){r.setAttribute("href",e);const s=n[n.length-1].properties,o=[s.linkText,s.linkType];x({node:r},He,v,o,n,We)}function V(r,e,n){const t=n[n.length-1],o=t.node.namespaceURI,i=t.properties;switch(r.setAttributeNS(null,"lat",String(e[1])),r.setAttributeNS(null,"lon",String(e[0])),t.geometryLayout){case"XYZM":e[3]!==0&&(i.time=e[3]);case"XYZ":e[2]!==0&&(i.ele=e[2]);break;case"XYM":e[2]!==0&&(i.time=e[2]);break}const u=r.nodeName=="rtept"?$e[o]:je[o],d=B(i,u);x({node:r,properties:i},et,v,d,n,u)}function ct(r,e,n){const t=n[0],s=e.getProperties(),o={node:r};o.properties=s;const i=e.getGeometry();if(i.getType()=="LineString"){const g=T(i,!0,t);o.geometryLayout=g.getLayout(),s.rtept=g.getCoordinates()}const a=n[n.length-1].node,u=Je[a.namespaceURI],d=B(s,u);x(o,Ve,v,d,n,u)}function dt(r,e,n){const t=n[0],s=e.getProperties(),o={node:r};o.properties=s;const i=e.getGeometry();if(i.getType()=="MultiLineString"){const g=T(i,!0,t);s.trkseg=g.getLineStrings()}const a=n[n.length-1].node,u=be[a.namespaceURI],d=B(s,u);x(o,Qe,v,d,n,u)}function pt(r,e,n){const t={node:r};t.geometryLayout=e.getLayout(),t.properties={},x(t,qe,ze,e.getCoordinates(),n)}function ft(r,e,n){const t=n[0],s=n[n.length-1];s.properties=e.getProperties();const o=e.getGeometry();if(o.getType()=="Point"){const i=T(o,!0,t);s.geometryLayout=i.getLayout(),V(r,i.getCoordinates(),n)}}const Kt=Ue,mt=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,gt=/^H.([A-Z]{3}).*?:(.*)/,ht=/^HFDTE(\d{2})(\d{2})(\d{2})/,yt=/\r\n|\r|\n/;class Et extends Pe{constructor(e){super(),e=e||{},this.dataProjection=G("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,n){const t=this.altitudeMode_,s=e.split(yt),o={},i=[];let a=2e3,u=0,d=1,g=-1,E,R;for(E=0,R=s.length;E<R;++E){const S=s[E];let m;if(S.charAt(0)=="B"){if(m=mt.exec(S),m){const Q=parseInt(m[1],10),z=parseInt(m[2],10),q=parseInt(m[3],10);let k=parseInt(m[4],10)+parseInt(m[5],10)/6e4;m[6]=="S"&&(k=-k);let K=parseInt(m[7],10)+parseInt(m[8],10)/6e4;if(m[9]=="W"&&(K=-K),i.push(K,k),t!="none"){let I;t=="gps"?I=parseInt(m[11],10):t=="barometric"?I=parseInt(m[12],10):I=0,i.push(I)}let M=Date.UTC(a,u,d,Q,z,q);M<g&&(M=Date.UTC(a,u,d+1,Q,z,q)),i.push(M/1e3),g=M}}else S.charAt(0)=="H"&&(m=ht.exec(S),m?(d=parseInt(m[1],10),u=parseInt(m[2],10)-1,a=2e3+parseInt(m[3],10)):(m=gt.exec(S),m&&(o[m[1]]=m[2].trim())))}if(i.length===0)return null;const ue=t=="none"?"XYM":"XYZM",ce=new Z(i,ue),b=new L(T(ce,!1,n));return b.setProperties(o,!0),b}readFeaturesFromText(e,n){const t=this.readFeatureFromText(e,n);return t?[t]:[]}}const Yt=Et;class Rt extends xe{constructor(e){super(),e=e||{},this.layerName_=e.layerName,this.layers_=e.layers?e.layers:null,this.dataProjection=G(e.dataProjection?e.dataProjection:"EPSG:4326")}readFeaturesFromObject(e,n){if(e.type=="Topology"){const t=e;let s,o=null,i=null;t.transform&&(s=t.transform,o=s.scale,i=s.translate);const a=t.arcs;s&&Lt(a,o,i);const u=[],d=t.objects,g=this.layerName_;let E;for(const R in d)this.layers_&&!this.layers_.includes(R)||(d[R].type==="GeometryCollection"?(E=d[R],u.push.apply(u,wt(E,a,o,i,g,R,n))):(E=d[R],u.push(le(E,a,o,i,g,R,n))));return u}return[]}readProjectionFromObject(e){return this.dataProjection}}const _t={Point:At,LineString:Pt,Polygon:St,MultiPoint:Tt,MultiLineString:xt,MultiPolygon:Nt};function X(r,e){const n=[];let t;for(let s=0,o=r.length;s<o;++s)if(t=r[s],s>0&&n.pop(),t>=0){const i=e[t];for(let a=0,u=i.length;a<u;++a)n.push(i[a].slice(0))}else{const i=e[~t];for(let a=i.length-1;a>=0;--a)n.push(i[a].slice(0))}return n}function At(r,e,n){const t=r.coordinates;return e&&n&&$(t,e,n),new ee(t)}function Tt(r,e,n){const t=r.coordinates;if(e&&n)for(let s=0,o=t.length;s<o;++s)$(t[s],e,n);return new Se(t)}function Pt(r,e){const n=X(r.arcs,e);return new Z(n)}function xt(r,e){const n=[];for(let t=0,s=r.arcs.length;t<s;++t)n[t]=X(r.arcs[t],e);return new te(n)}function St(r,e){const n=[];for(let t=0,s=r.arcs.length;t<s;++t)n[t]=X(r.arcs[t],e);return new he(n)}function Nt(r,e){const n=[];for(let t=0,s=r.arcs.length;t<s;++t){const o=r.arcs[t],i=[];for(let a=0,u=o.length;a<u;++a)i[a]=X(o[a],e);n[t]=i}return new ye(n)}function wt(r,e,n,t,s,o,i){const a=r.geometries,u=[];for(let d=0,g=a.length;d<g;++d)u[d]=le(a[d],e,n,t,s,o,i);return u}function le(r,e,n,t,s,o,i){let a=null;const u=r.type;if(u){const E=_t[u];u==="Point"||u==="MultiPoint"?a=E(r,n,t):a=E(r,e),a=T(a,!1,i)}const d=new L({geometry:a});r.id!==void 0&&d.setId(r.id);let g=r.properties;return s&&(g||(g={}),g[s]=o),g&&d.setProperties(g,!0),d}function Lt(r,e,n){for(let t=0,s=r.length;t<s;++t)Ft(r[t],e,n)}function Ft(r,e,n){let t=0,s=0;for(let o=0,i=r.length;o<i;++o){const a=r[o];t+=a[0],s+=a[1],a[0]=t,a[1]=s,$(a,e,n)}}function $(r,e,n){r[0]=r[0]*e[0]+n[0],r[1]=r[1]*e[1]+n[1]}const Zt=Rt;export{kt as D,Kt as G,Yt as I,Zt as T};
