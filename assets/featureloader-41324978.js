import{aY as ge,a9 as Xe,aZ as b,R as me,H as oe,a_ as Ye,a$ as Se,aq as re,a1 as Le,aH as Ce,Q as ce,a5 as Fe,U as ze,b0 as $e}from"./Layer-227d2e40.js";import{I as Ne,F as Ie,a as K,S as qe,R as We,C as Ue,t as Ve,c as Pe}from"./Style-f78957a3.js";function zt(n,e,t,i){let s=n[e],r=n[e+1],a=0;for(let o=e+i;o<t;o+=i){const u=n[o],l=n[o+1];a+=Math.sqrt((u-s)*(u-s)+(l-r)*(l-r)),s=u,r=l}return a}function Ge(n,e,t,i,s){be(n,e,t||0,i||n.length-1,s||He)}function be(n,e,t,i,s){for(;i>t;){if(i-t>600){var r=i-t+1,a=e-t+1,o=Math.log(r),u=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*u*(r-u)/r)*(a-r/2<0?-1:1),h=Math.max(t,Math.floor(e-a*u/r+l)),f=Math.min(i,Math.floor(e+(r-a)*u/r+l));be(n,e,h,f,s)}var d=n[e],A=t,v=i;for(F(n,t,e),s(n[i],d)>0&&F(n,t,i);A<v;){for(F(n,A,v),A++,v--;s(n[A],d)<0;)A++;for(;s(n[v],d)>0;)v--}s(n[t],d)===0?F(n,t,v):(v++,F(n,v,i)),v<=e&&(t=v+1),e<=v&&(i=v-1)}}function F(n,e,t){var i=n[e];n[e]=n[t],n[t]=i}function He(n,e){return n<e?-1:n>e?1:0}let Je=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!Q(e,t))return i;const s=this.toBBox,r=[];for(;t;){for(let a=0;a<t.children.length;a++){const o=t.children[a],u=t.leaf?s(o):o;Q(e,u)&&(t.leaf?i.push(o):ae(e,u)?this._all(o,i):r.push(o))}t=r.pop()}return i}collides(e){let t=this.data;if(!Q(e,t))return!1;const i=[];for(;t;){for(let s=0;s<t.children.length;s++){const r=t.children[s],a=t.leaf?this.toBBox(r):r;if(Q(e,a)){if(t.leaf||ae(e,a))return!0;i.push(r)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Y([]),this}remove(e,t){if(!e)return this;let i=this.data;const s=this.toBBox(e),r=[],a=[];let o,u,l;for(;i||r.length;){if(i||(i=r.pop(),u=r[r.length-1],o=a.pop(),l=!0),i.leaf){const h=je(e,i.children,t);if(h!==-1)return i.children.splice(h,1),r.push(i),this._condense(r),this}!l&&!i.leaf&&ae(i,s)?(r.push(i),a.push(o),o=0,u=i,i=i.children[0]):u?(o++,i=u.children[o],l=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,s){const r=i-t+1;let a=this._maxEntries,o;if(r<=a)return o=Y(e.slice(t,i+1)),X(o,this.toBBox),o;s||(s=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,s-1))),o=Y([]),o.leaf=!1,o.height=s;const u=Math.ceil(r/a),l=u*Math.ceil(Math.sqrt(a));_e(e,t,i,l,this.compareMinX);for(let h=t;h<=i;h+=l){const f=Math.min(h+l-1,i);_e(e,h,f,u,this.compareMinY);for(let d=h;d<=f;d+=u){const A=Math.min(d+u-1,f);o.children.push(this._build(e,d,A,s-1))}}return X(o,this.toBBox),o}_chooseSubtree(e,t,i,s){for(;s.push(t),!(t.leaf||s.length-1===i);){let r=1/0,a=1/0,o;for(let u=0;u<t.children.length;u++){const l=t.children[u],h=se(l),f=Ke(e,l)-h;f<a?(a=f,r=h<r?h:r,o=l):f===a&&h<r&&(r=h,o=l)}t=o||t.children[0]}return t}_insert(e,t,i){const s=i?e:this.toBBox(e),r=[],a=this._chooseSubtree(s,this.data,t,r);for(a.children.push(e),N(a,s);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(s,r,t)}_split(e,t){const i=e[t],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);const a=this._chooseSplitIndex(i,r,s),o=Y(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,X(i,this.toBBox),X(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)}_splitRoot(e,t){this.data=Y([e,t]),this.data.height=e.height+1,this.data.leaf=!1,X(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let s,r=1/0,a=1/0;for(let o=t;o<=i-t;o++){const u=$(e,0,o,this.toBBox),l=$(e,o,i,this.toBBox),h=et(u,l),f=se(u)+se(l);h<r?(r=h,s=o,a=f<a?f:a):h===r&&f<a&&(a=f,s=o)}return s||i-t}_chooseSplitAxis(e,t,i){const s=e.leaf?this.compareMinX:Ze,r=e.leaf?this.compareMinY:Qe,a=this._allDistMargin(e,t,i,s),o=this._allDistMargin(e,t,i,r);a<o&&e.children.sort(s)}_allDistMargin(e,t,i,s){e.children.sort(s);const r=this.toBBox,a=$(e,0,t,r),o=$(e,i-t,i,r);let u=Z(a)+Z(o);for(let l=t;l<i-t;l++){const h=e.children[l];N(a,e.leaf?r(h):h),u+=Z(a)}for(let l=i-t-1;l>=t;l--){const h=e.children[l];N(o,e.leaf?r(h):h),u+=Z(o)}return u}_adjustParentBBoxes(e,t,i){for(let s=i;s>=0;s--)N(t[s],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():X(e[t],this.toBBox)}};function je(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function X(n,e){$(n,0,n.children.length,e,n)}function $(n,e,t,i,s){s||(s=Y(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=e;r<t;r++){const a=n.children[r];N(s,n.leaf?i(a):a)}return s}function N(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function Ze(n,e){return n.minX-e.minX}function Qe(n,e){return n.minY-e.minY}function se(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function Z(n){return n.maxX-n.minX+(n.maxY-n.minY)}function Ke(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function et(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),s=Math.min(n.maxX,e.maxX),r=Math.min(n.maxY,e.maxY);return Math.max(0,s-t)*Math.max(0,r-i)}function ae(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function Q(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function Y(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _e(n,e,t,i,s){const r=[e,t];for(;r.length;){if(t=r.pop(),e=r.pop(),t-e<=i)continue;const a=e+Math.ceil((t-e)/i/2)*i;Ge(n,a,e,t,s),r.push(e,a,a,t)}}let z=null;class tt extends Xe{constructor(e,t,i,s,r){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=s===void 0?b.IDLE:s,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===b.LOADED){z||(z=me(1,1,void 0,{willReadFrequently:!0})),z.drawImage(this.image_,0,0);try{z.getImageData(0,0,1,1),this.tainted_=!1}catch{z=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(oe.CHANGE)}handleImageError_(){this.imageState_=b.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=b.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=me(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===b.IDLE){this.image_||this.initializeImage_(),this.imageState_=b.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Ye(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==b.LOADED)return;const t=this.image_,i=document.createElement("canvas");i.width=Math.ceil(t.width*e),i.height=Math.ceil(t.height*e);const s=i.getContext("2d");s.scale(e,e),s.drawImage(t,0,0),s.globalCompositeOperation="multiply",s.fillStyle=Se(this.color_),s.fillRect(0,0,i.width/e,i.height/e),s.globalCompositeOperation="destination-in",s.drawImage(t,0,0),this.canvas_[e]=i}}function nt(n,e,t,i,s){let r=e===void 0?void 0:ge.get(e,t,s);return r||(r=new tt(n,n instanceof HTMLImageElement?n.src||void 0:e,t,i,s),ge.set(e,t,s,r)),r}function pe(n,e,t,i){return t!==void 0&&i!==void 0?[t/n,i/e]:t!==void 0?t/n:i!==void 0?i/e:1}class he extends Ne{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,s=e.scale!==void 0?e.scale:1,r=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:s,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:r,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const a=e.img!==void 0?e.img:null;let o=e.src;re(!(o!==void 0&&a),"`image` and `src` cannot be provided at the same time"),(o===void 0||o.length===0)&&a&&(o=a.src||Le(a)),re(o!==void 0&&o.length>0,"A defined and non-empty `src` or `image` must be provided"),re(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let u;if(e.src!==void 0?u=b.IDLE:a!==void 0&&(a instanceof HTMLImageElement?a.complete?u=a.src?b.LOADED:b.IDLE:u=b.LOADING:u=b.LOADED),this.color_=e.color!==void 0?Ce(e.color):null,this.iconImage_=nt(a,o,this.crossOrigin_,u,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,e.width!==void 0||e.height!==void 0){let l,h;if(e.size)[l,h]=e.size;else{const f=this.getImage(1);if(f.width&&f.height)l=f.width,h=f.height;else if(f instanceof HTMLImageElement){this.initialOptions_=e;const d=()=>{if(this.unlistenImageChange(d),!this.initialOptions_)return;const A=this.iconImage_.getSize();this.setScale(pe(A[0],A[1],e.width,e.height))};this.listenImageChange(d);return}}l!==void 0&&this.setScale(pe(l,h,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new he({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=s[0]),this.anchorYUnits_=="fraction"&&(e[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+s[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==b.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==b.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(oe.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(oe.CHANGE,e)}}const it=he,rt="#333";class le{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=ce(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new Ie({color:rt}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding}clone(){const e=this.getScale();return new le({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=ce(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}const st=le;let C=0;const I=1<<C++,g=1<<C++,L=1<<C++,fe=1<<C++,V=1<<C++,M=Math.pow(2,C)-1,ye={[I]:"boolean",[g]:"number",[L]:"string",[fe]:"color",[V]:"number[]"},at=Object.keys(ye).map(Number).sort(Fe);function ee(n){const e=[];for(const t of at)ot(n,t)&&e.push(ye[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function ot(n,e){return(n&e)===e}function Oe(n,e){return!!(n&e)}class T{constructor(e,t){this.type=e,this.value=t}}class ct{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function xe(){return{variables:new Set,properties:new Set}}function ne(n,e){switch(typeof n){case"boolean":return new T(I,n);case"number":return new T(g,n);case"string":return new T(L,n)}if(!Array.isArray(n))throw new Error("Expression must be an array or a primitive value");if(n.length===0)throw new Error("Empty expression");if(typeof n[0]=="string")return dt(n,e);for(const i of n)if(typeof i!="number")throw new Error("Expected an array of numbers");let t=V;return(n.length===3||n.length===4)&&(t|=fe),new T(t,n)}const c={Number:"number",String:"string",Get:"get",Var:"var",Any:"any",All:"all",Not:"!",Resolution:"resolution",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match"},ut={[c.Number]:m(p(1,1/0,M),g),[c.String]:m(p(1,1/0,M),L),[c.Get]:m(ht,M),[c.Var]:m(lt,M),[c.Resolution]:m(ft,g),[c.Any]:m(p(2,1/0,I),I),[c.All]:m(p(2,1/0,I),I),[c.Not]:m(p(1,1,I),I),[c.Equal]:m(p(2,2,M),I),[c.NotEqual]:m(p(2,2,M),I),[c.GreaterThan]:m(p(2,2,M),I),[c.GreaterThanOrEqualTo]:m(p(2,2,M),I),[c.LessThan]:m(p(2,2,M),I),[c.LessThanOrEqualTo]:m(p(2,2,M),I),[c.Multiply]:m(p(2,1/0,g),g),[c.Divide]:m(p(2,2,g),g),[c.Add]:m(p(2,1/0,g),g),[c.Subtract]:m(p(2,2,g),g),[c.Clamp]:m(p(3,3,g),g),[c.Mod]:m(p(2,2,g),g),[c.Pow]:m(p(2,2,g),g),[c.Abs]:m(p(1,1,g),g),[c.Floor]:m(p(1,1,g),g),[c.Ceil]:m(p(1,1,g),g),[c.Round]:m(p(1,1,g),g),[c.Sin]:m(p(1,1,g),g),[c.Cos]:m(p(1,1,g),g),[c.Atan]:m(p(1,2,g),g),[c.Sqrt]:m(p(1,1,g),g),[c.Match]:m(p(4,1/0,L|g),M)};function ht(n,e){if(n.length!==2)throw new Error("Expected 1 argument for get operation");const t=ne(n[1],e);if(!(t instanceof T))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");return e.properties.add(t.value),[t]}function lt(n,e){if(n.length!==2)throw new Error("Expected 1 argument for var operation");const t=ne(n[1],e);if(!(t instanceof T))throw new Error("Expected a literal argument for var operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");return e.variables.add(t.value),[t]}function ft(n,e){const t=n[0];if(n.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function p(n,e,t){return function(i,s){const r=i[0],a=i.length-1;if(n===e){if(a!==n){const u=n===1?"":"s";throw new Error(`Expected ${n} argument${u} for operation ${r}, got ${a}`)}}else if(a<n||a>e)throw new Error(`Expected ${n} to ${e} arguments for operation ${r}, got ${a}`);const o=new Array(a);for(let u=0;u<a;++u){const l=ne(i[u+1],s);if(!Oe(t,l.type)){const h=ee(t),f=ee(l.type);throw new Error(`Unexpected type for argument ${u} of ${r} operation : got ${h} but expected ${f}`)}o[u]=l}return o}}function m(n,e){return function(t,i){const s=t[0],r=n(t,i);return new ct(e,s,...r)}}function dt(n,e){const t=n[0],i=ut[t];if(!i)throw new Error(`Unknown operator: ${t}`);return i(n,e)}function Me(){return{variables:{},properties:{},resolution:NaN}}function k(n,e,t){const i=ne(n,t);if(!Oe(e,i.type)){const s=ee(e),r=ee(i.type);throw new Error(`Expected expression to be of type ${s}, got ${r}`)}return R(i)}function R(n,e){if(n instanceof T)return function(){return n.value};const t=n.operator;switch(t){case c.Number:case c.String:return gt(n);case c.Get:case c.Var:return mt(n);case c.Resolution:return i=>i.resolution;case c.Any:case c.All:case c.Not:return pt(n);case c.Equal:case c.NotEqual:case c.LessThan:case c.LessThanOrEqualTo:case c.GreaterThan:case c.GreaterThanOrEqualTo:return _t(n);case c.Multiply:case c.Divide:case c.Add:case c.Subtract:case c.Clamp:case c.Mod:case c.Pow:case c.Abs:case c.Floor:case c.Ceil:case c.Round:case c.Sin:case c.Cos:case c.Atan:case c.Sqrt:return wt(n);case c.Match:return Et(n);default:throw new Error(`Unsupported operator ${t}`)}}function gt(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=R(n.args[r]);switch(t){case c.Number:case c.String:return r=>{for(let a=0;a<i;++a){const o=s[a](r);if(typeof o===t)return o}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function mt(n,e){const t=n.args[0];if(!(t instanceof T))throw new Error("Expected literal name");const i=t.value;if(typeof i!="string")throw new Error("Expected string name");switch(n.operator){case c.Get:return s=>s.properties[i];case c.Var:return s=>s.variables[i];default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function _t(n,e){const t=n.operator,i=R(n.args[0]),s=R(n.args[1]);switch(t){case c.Equal:return r=>i(r)===s(r);case c.NotEqual:return r=>i(r)!==s(r);case c.LessThan:return r=>i(r)<s(r);case c.LessThanOrEqualTo:return r=>i(r)<=s(r);case c.GreaterThan:return r=>i(r)>s(r);case c.GreaterThanOrEqualTo:return r=>i(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${t}`)}}function pt(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=R(n.args[r]);switch(t){case c.Any:return r=>{for(let a=0;a<i;++a)if(s[a](r))return!0;return!1};case c.All:return r=>{for(let a=0;a<i;++a)if(!s[a](r))return!1;return!0};case c.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${t}`)}}function wt(n,e){const t=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=R(n.args[r]);switch(t){case c.Multiply:return r=>{let a=1;for(let o=0;o<i;++o)a*=s[o](r);return a};case c.Divide:return r=>s[0](r)/s[1](r);case c.Add:return r=>{let a=0;for(let o=0;o<i;++o)a+=s[o](r);return a};case c.Subtract:return r=>s[0](r)-s[1](r);case c.Clamp:return r=>{const a=s[0](r),o=s[1](r);if(a<o)return o;const u=s[2](r);return a>u?u:a};case c.Mod:return r=>s[0](r)%s[1](r);case c.Pow:return r=>Math.pow(s[0](r),s[1](r));case c.Abs:return r=>Math.abs(s[0](r));case c.Floor:return r=>Math.floor(s[0](r));case c.Ceil:return r=>Math.ceil(s[0](r));case c.Round:return r=>Math.round(s[0](r));case c.Sin:return r=>Math.sin(s[0](r));case c.Cos:return r=>Math.cos(s[0](r));case c.Atan:return i===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case c.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${t}`)}}function Et(n,e){const t=n.args.length,i=new Array(t);for(let s=0;s<t;++s)i[s]=R(n.args[s]);return s=>{const r=i[0](s);for(let a=1;a<t;a+=2)if(r===i[a](s))return i[a+1](s);return i[t-1](s)}}function vt(n){return!0}function At(n){const e=xe(),t=It(n,e),i=Me();return function(s,r){return i.properties=s.getPropertiesInternal(),i.resolution=r,t(i)}}function we(n){const e=xe(),t=n.length,i=new Array(t);for(let a=0;a<t;++a)i[a]=ue(n[a],e);const s=Me(),r=new Array(t);return function(a,o){s.properties=a.getPropertiesInternal(),s.resolution=o;for(let u=0;u<t;++u)r[u]=i[u](s);return r}}function It(n,e){const t=n.length,i=new Array(t);for(let s=0;s<t;++s){const r=n[s],a="filter"in r?k(r.filter,I,e):vt;let o;if(Array.isArray(r.style)){const u=r.style.length;o=new Array(u);for(let l=0;l<u;++l)o[l]=ue(r.style[l],e)}else o=[ue(r.style,e)];i[s]={filter:a,styles:o}}return function(s){const r=[];let a=!1;for(let o=0;o<t;++o){const u=i[o].filter;if(u(s)&&!(n[o].else&&a)){a=!0;for(const l of i[o].styles){const h=l(s);h&&r.push(h)}}}return r}}function ue(n,e){const t=q(n,"",e),i=W(n,"",e),s=bt(n,e),r=yt(n,e),a=y(n,"z-index",e),o=new K;return function(u){let l=!0;if(t){const h=t(u);h&&(l=!1),o.setFill(h)}if(i){const h=i(u);h&&(l=!1),o.setStroke(h)}if(s){const h=s(u);h&&(l=!1),o.setText(h)}if(r){const h=r(u);h&&(l=!1),o.setImage(h)}return a&&o.setZIndex(a(u)),l?null:o}}function q(n,e,t){const i=Be(n,e+"fill-color",t);if(!i)return null;const s=new Ie;return function(r){const a=i(r);return a==="none"?null:(s.setColor(a),s)}}function W(n,e,t){const i=y(n,e+"stroke-width",t),s=Be(n,e+"stroke-color",t);if(!i&&!s)return null;const r=B(n,e+"stroke-line-cap",t),a=B(n,e+"stroke-line-join",t),o=Te(n,e+"stroke-line-dash",t),u=y(n,e+"stroke-line-dash-offset",t),l=y(n,e+"stroke-miter-limit",t),h=new qe;return function(f){if(s){const d=s(f);if(d==="none")return null;h.setColor(d)}if(i&&h.setWidth(i(f)),r){const d=r(f);if(d!=="butt"&&d!=="round"&&d!=="square")throw new Error("Expected butt, round, or square line cap");h.setLineCap(d)}if(a){const d=a(f);if(d!=="bevel"&&d!=="round"&&d!=="miter")throw new Error("Expected bevel, round, or miter line join");h.setLineJoin(d)}return o&&h.setLineDash(o(f)),u&&h.setLineDashOffset(u(f)),l&&h.setMiterLimit(l(f)),h}}function bt(n,e){const t="text-",i=B(n,t+"value",e);if(!i)return null;const s=q(n,t,e),r=q(n,t+"background-",e),a=W(n,t,e),o=W(n,t+"background-",e),u=B(n,t+"font",e),l=y(n,t+"max-angle",e),h=y(n,t+"offset-x",e),f=y(n,t+"offset-y",e),d=U(n,t+"overflow",e),A=B(n,t+"placement",e),v=y(n,t+"repeat",e),D=ie(n,t+"scale",e),O=U(n,t+"rotate-with-view",e),x=y(n,t+"rotation",e),G=B(n,t+"align",e),H=B(n,t+"justify",e),J=B(n,t+"baseline",e),j=Te(n,t+"padding",e),_=new st({});return function(w){if(_.setText(i(w)),s&&_.setFill(s(w)),r&&_.setBackgroundFill(r(w)),a&&_.setStroke(a(w)),o&&_.setBackgroundStroke(o(w)),u&&_.setFont(u(w)),l&&_.setMaxAngle(l(w)),h&&_.setOffsetX(h(w)),f&&_.setOffsetY(f(w)),d&&_.setOverflow(d(w)),A){const E=A(w);if(E!=="point"&&E!=="line")throw new Error("Expected point or line for text-placement");_.setPlacement(E)}if(v&&_.setRepeat(v(w)),D&&_.setScale(D(w)),O&&_.setRotateWithView(O(w)),x&&_.setRotation(x(w)),G){const E=G(w);if(E!=="left"&&E!=="center"&&E!=="right"&&E!=="end"&&E!=="start")throw new Error("Expected left, right, center, start, or end for text-align");_.setTextAlign(E)}if(H){const E=H(w);if(E!=="left"&&E!=="right"&&E!=="center")throw new Error("Expected left, right, or center for text-justify");_.setJustify(E)}if(J){const E=J(w);if(E!=="bottom"&&E!=="top"&&E!=="middle"&&E!=="alphabetic"&&E!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");_.setTextBaseline(E)}return j&&_.setPadding(j(w)),_}}function yt(n,e){return"icon-src"in n?Ot(n,e):"shape-points"in n?xt(n,e):"circle-radius"in n?Mt(n,e):null}function Ot(n,e){const t="icon-",i=t+"src",s=ke(n[i],i),r=te(n,t+"anchor",e),a=ie(n,t+"scale",e),o=y(n,t+"opacity",e),u=te(n,t+"displacement",e),l=y(n,t+"rotation",e),h=U(n,t+"rotate-with-view",e),f=Ee(n,t+"anchor-origin"),d=ve(n,t+"anchor-x-units"),A=ve(n,t+"anchor-y-units"),v=Rt(n,t+"color"),D=Tt(n,t+"cross-origin"),O=kt(n,t+"offset"),x=Ee(n,t+"offset-origin"),G=S(n,t+"width"),H=S(n,t+"height"),J=Bt(n,t+"size"),j=de(n,t+"declutter"),_=new it({src:s,anchorOrigin:f,anchorXUnits:d,anchorYUnits:A,color:v,crossOrigin:D,offset:O,offsetOrigin:x,height:H,width:G,size:J,declutterMode:j});return function(w){return o&&_.setOpacity(o(w)),u&&_.setDisplacement(u(w)),l&&_.setRotation(l(w)),h&&_.setRotateWithView(h(w)),a&&_.setScale(a(w)),r&&_.setAnchor(r(w)),_}}function xt(n,e){const t="shape-",i=t+"points",s=Re(n[i],i),r=q(n,t,e),a=W(n,t,e),o=ie(n,t+"scale",e),u=te(n,t+"displacement",e),l=y(n,t+"rotation",e),h=U(n,t+"rotate-with-view",e),f=S(n,t+"radius"),d=S(n,t+"radius1"),A=S(n,t+"radius2"),v=S(n,t+"angle"),D=de(n,t+"declutter-mode"),O=new We({points:s,radius:f,radius1:d,radius2:A,angle:v,declutterMode:D});return function(x){return r&&O.setFill(r(x)),a&&O.setStroke(a(x)),u&&O.setDisplacement(u(x)),l&&O.setRotation(l(x)),h&&O.setRotateWithView(h(x)),o&&O.setScale(o(x)),O}}function Mt(n,e){const t="circle-",i=q(n,t,e),s=W(n,t,e),r=y(n,t+"radius",e),a=ie(n,t+"scale",e),o=te(n,t+"displacement",e),u=y(n,t+"rotation",e),l=U(n,t+"rotate-with-view",e),h=de(n,t+"declutter-mode"),f=new Ue({radius:5,declutterMode:h});return function(d){return r&&f.setRadius(r(d)),i&&f.setFill(i(d)),s&&f.setStroke(s(d)),o&&f.setDisplacement(o(d)),u&&f.setRotation(u(d)),l&&f.setRotateWithView(l(d)),a&&f.setScale(a(d)),f}}function y(n,e,t){if(!(e in n))return;const i=k(n[e],g,t);return function(s){return Re(i(s),e)}}function B(n,e,t){if(!(e in n))return null;const i=k(n[e],L,t);return function(s){return ke(i(s),e)}}function U(n,e,t){if(!(e in n))return null;const i=k(n[e],I,t);return function(s){const r=i(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${e}`);return r}}function Be(n,e,t){if(!(e in n))return null;const i=k(n[e],fe|L,t);return function(s){return De(i(s),e)}}function Te(n,e,t){if(!(e in n))return null;const i=k(n[e],V,t);return function(s){return P(i(s),e)}}function te(n,e,t){if(!(e in n))return null;const i=k(n[e],V,t);return function(s){const r=P(i(s),e);if(r.length!==2)throw new Error(`Expected two numbers for ${e}`);return r}}function ie(n,e,t){if(!(e in n))return null;const i=k(n[e],V|g,t);return function(s){return Dt(i(s),e)}}function S(n,e){const t=n[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function Bt(n,e){const t=n[e];if(t!==void 0){if(typeof t=="number")return ce(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function Tt(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function Ee(n,e){const t=n[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function ve(n,e){const t=n[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function kt(n,e){const t=n[e];if(t!==void 0)return P(t,e)}function de(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function Rt(n,e){const t=n[e];if(t!==void 0)return De(t,e)}function P(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);const t=n.length;for(let i=0;i<t;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function ke(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function Re(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function De(n,e){if(typeof n=="string")return n;const t=P(n,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function Dt(n,e){if(typeof n=="number")return n;const t=P(n,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}const Ae={RENDER_ORDER:"renderOrder"};class Xt extends ze{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter!==void 0?e.declutter:!1,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Ae.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e){e.declutterTree||(e.declutterTree=new Je(9)),this.getRenderer().renderDeclutter(e)}setRenderOrder(e){this.set(Ae.RENDER_ORDER,e)}setStyle(e){this.style_=Yt(e),this.styleFunction_=e===null?void 0:Ve(this.style_),this.changed()}}function Yt(n){if(n===void 0)return Pe;if(!n)return null;if(typeof n=="function"||n instanceof K)return n;if(!Array.isArray(n))return we([n]);if(n.length===0)return[];const e=n.length,t=n[0];if(t instanceof K){const s=new Array(e);for(let r=0;r<e;++r){const a=n[r];if(!(a instanceof K))throw new Error("Expected a list of style instances");s[r]=a}return s}if("style"in t){const s=new Array(e);for(let r=0;r<e;++r){const a=n[r];if(!("style"in a))throw new Error("Expected a list of rules with a style property");s[r]=a}return At(s)}return we(n)}const Nt=Xt;let St=!1;function Lt(n,e,t,i,s,r,a){const o=new XMLHttpRequest;o.open("GET",typeof n=="function"?n(t,i,s):n,!0),e.getType()=="arraybuffer"&&(o.responseType="arraybuffer"),o.withCredentials=St,o.onload=function(u){if(!o.status||o.status>=200&&o.status<300){const l=e.getType();let h;l=="json"||l=="text"?h=o.responseText:l=="xml"?(h=o.responseXML,h||(h=new DOMParser().parseFromString(o.responseText,"application/xml"))):l=="arraybuffer"&&(h=o.response),h?r(e.readFeatures(h,{extent:t,featureProjection:s}),e.readProjection(h)):a()}else a()},o.onerror=a,o.send()}function qt(n,e){return function(t,i,s,r,a){const o=this;Lt(n,e,t,i,s,function(u,l){o.addFeatures(u),r!==void 0&&r(u)},a||$e)}}export{Nt as B,it as I,Je as R,st as T,zt as a,Lt as l,qt as x};
