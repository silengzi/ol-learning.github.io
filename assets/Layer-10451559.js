import{aE as v,aF as d,aG as T,aH as u,R as m,a6 as x,ae as C,af as E,ag as L,Y as l,aI as P,aJ as f,a2 as M}from"./Layer-227d2e40.js";const w=[];let c=null;function b(){c=m(1,1,void 0,{willReadFrequently:!0})}class I extends v{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=d(),this.pixelTransform=d(),this.inversePixelTransform=d(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,n,t){c||b(),c.clearRect(0,0,1,1);let a;try{c.drawImage(e,n,t,1,1,0,0,1,1),a=c.getImageData(0,0,1,1).data}catch{return c=null,null}return a}getBackground(e){let t=this.getLayer().getBackground();return typeof t=="function"&&(t=t(e.viewState.resolution)),t||void 0}useContainer(e,n,t){const a=this.getLayer().getClassName();let o,r;if(e&&e.className===a&&(!t||e&&e.style.backgroundColor&&T(u(e.style.backgroundColor),u(t)))){const s=e.firstElementChild;s instanceof HTMLCanvasElement&&(r=s.getContext("2d"))}if(r&&r.canvas.style.transform===n?(this.container=e,this.context=r,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=document.createElement("div"),o.className=a;let s=o.style;s.position="absolute",s.width="100%",s.height="100%",r=m();const i=r.canvas;o.appendChild(i),s=i.style,s.position="absolute",s.left="0",s.transformOrigin="top left",this.container=o,this.context=r}!this.containerReused&&t&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=t)}clipUnrotated(e,n,t){const a=x(t),o=C(t),r=E(t),s=L(t);l(n.coordinateToPixelTransform,a),l(n.coordinateToPixelTransform,o),l(n.coordinateToPixelTransform,r),l(n.coordinateToPixelTransform,s);const i=this.inversePixelTransform;l(i,a),l(i,o),l(i,r),l(i,s),e.save(),e.beginPath(),e.moveTo(Math.round(a[0]),Math.round(a[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.clip()}dispatchRenderEvent_(e,n,t){const a=this.getLayer();if(a.hasListener(e)){const o=new P(e,this.inversePixelTransform,t,n);a.dispatchEvent(o)}}preRender(e,n){this.frameState=n,this.dispatchRenderEvent_(f.PRERENDER,e,n)}postRender(e,n){this.dispatchRenderEvent_(f.POSTRENDER,e,n)}getRenderTransform(e,n,t,a,o,r,s){const i=o/2,p=r/2,h=a/n,R=-h,y=-e[0]+s,g=-e[1];return M(this.tempTransform,i,p,h,R,-t,y,g)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const D=I;export{D as C,w as c};
