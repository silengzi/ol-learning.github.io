import{ci as U,aW as d,u as Y,W as b,aM as N,c7 as $,R as z,S as F,c as O,U as W,Z as j,$ as S,_ as X,i as B,aO as V}from"./Layer-3211d6ef.js";import{C as Z}from"./Layer-8f64fa5e.js";function tt(m){return Array.isArray(m)?Math.min(...m):m}class q extends U{constructor(t,l,c,s,i){const n=i!==void 0?d.IDLE:d.LOADED;super(t,l,c,n),this.loader_=i!==void 0?i:null,this.canvas_=s,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=d.ERROR):this.state=d.LOADED,this.changed()}load(){this.state==d.IDLE&&(this.state=d.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const et=q;class J extends Z{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const l=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,s=t.viewState,i=s.resolution,n=this.getLayer().getSource(),o=t.viewHints;let a=t.extent;if(l.extent!==void 0&&(a=Y(a,b(l.extent,s.projection))),!o[N.ANIMATING]&&!o[N.INTERACTING]&&!$(a))if(n){const h=s.projection,e=n.getImage(a,i,c,h);e&&(this.loadImage(e)?this.image_=e:e.getState()===d.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const l=this.frameState;if(!l)return null;const c=this.getLayer(),s=z(l.pixelToCoordinateTransform,t.slice()),i=c.getExtent();if(i&&!F(i,s))return null;const n=this.image_.getExtent(),o=this.image_.getImage(),a=O(n),h=Math.floor(o.width*((s[0]-n[0])/a));if(h<0||h>=o.width)return null;const e=W(n),g=Math.floor(o.height*((n[3]-s[1])/e));return g<0||g>=o.height?null:this.getImageData(o,h,g)}renderFrame(t,l){const c=this.image_,s=c.getExtent(),i=c.getResolution(),[n,o]=Array.isArray(i)?i:[i,i],a=c.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],e=t.pixelRatio,g=t.viewState,w=g.center,A=g.resolution,H=e*n/(A*a),P=e*o/(A*a),L=t.extent,C=g.resolution,k=g.rotation,p=Math.round(O(L)/C*e),x=Math.round(W(L)/C*e);j(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/e,1/e,k,-p/2,-x/2),S(this.inversePixelTransform,this.pixelTransform);const R=X(this.pixelTransform);this.useContainer(l,R,this.getBackground(t));const r=this.context,u=r.canvas;u.width!=p||u.height!=x?(u.width=p,u.height=x):this.containerReused||r.clearRect(0,0,p,x);let v=!1,E=!0;if(h.extent){const y=b(h.extent,g.projection);E=B(y,t.extent),v=E&&!V(y,t.extent),v&&this.clipUnrotated(r,t,y)}const f=c.getImage(),I=j(this.tempTransform,p/2,x/2,H,P,0,a*(s[0]-w[0])/n,a*(w[1]-s[3])/o);this.renderedResolution=o*e/a;const T=f.width*I[0],M=f.height*I[3];if(this.getLayer().getSource().getInterpolate()||(r.imageSmoothingEnabled=!1),this.preRender(r,t),E&&T>=.5&&M>=.5){const y=I[4],G=I[5],_=h.opacity;let D;_!==1&&(D=r.globalAlpha,r.globalAlpha=_),r.drawImage(f,0,0,+f.width,+f.height,y,G,T,M),_!==1&&(r.globalAlpha=D)}return this.postRender(r,t),v&&r.restore(),r.imageSmoothingEnabled=!0,R!==u.style.transform&&(u.style.transform=R),this.container}}const it=J;export{it as C,et as I,tt as f};
