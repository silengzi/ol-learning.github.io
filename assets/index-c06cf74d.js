import{K as re}from"./KML-c4ac6c3a.js";import{aB as ne,Q as se,aA as B,$ as ie,F as M,Y as S,c as ae,aM as V,a2 as oe,aN as ue,R as O,al as he,aT as le,aQ as ce,G as fe,v as de,J as pe,M as _e,V as xe}from"./Layer-3211d6ef.js";import{S as ge}from"./StadiaMaps-c230dd67.js";import{a as D,V as ve}from"./Vector-163f0152.js";import{_ as me,i as ye,o as be,c as Ee,b as v,t as F,g as T,F as we,j as Re,p as Fe,k as Te}from"./index-8e73cb60.js";import{B as X}from"./featureloader-4f961e27.js";import{h as Ae,k as Le,c as K,d as Ce,f as $,E as Ie,b as A}from"./expressions-a7c2bfa9.js";import{c as Be,W as J,S as Me}from"./ShaderBuilder-1887eb2e.js";import{T as Se}from"./Tile-d932c51d.js";import"./Style-22e788f3.js";import"./GeometryCollection-03015b2a.js";import"./LineString-d3d6f49c.js";import"./MultiPolygon-f290964a.js";import"./MultiPoint-e6eff345.js";import"./Feature-5a984f38.js";import"./string-30bf5402.js";import"./XYZ-2a4e8198.js";import"./TileImage-a70beb77.js";import"./TileProperty-f0a52f17.js";import"./UrlTile-7d5bd7ce.js";import"./OSM-39b8e613.js";import"./BaseTile-47530170.js";import"./TileLayer-d6ace1df.js";import"./Layer-8f64fa5e.js";const y=new Uint8Array(4);class De{constructor(t,e){this.helper_=t;const n=t.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){ne(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return y[0]=0,y[1]=0,y[2]=0,y[3]=0,y;this.readAll();const n=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return y[0]=this.data_[n*4],y[1]=this.data_[n*4+1],y[2]=this.data_[n*4+2],y[3]=this.data_[n*4+3],y}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),e.bindRenderbuffer(e.RENDERBUFFER,this.depthbuffer_),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t[0],t[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(t[0]*t[1]*4)}}const ze=De;var Y={exports:{}};Y.exports=P;Y.exports.default=P;function P(r,t,e){e=e||2;var n=t&&t.length,s=n?t[0]*e:r.length,a=q(r,0,s,e,!0),i=[];if(!a||a.next===a.prev)return i;var o,u,h,l,f,c,_;if(n&&(a=Ne(r,t,a,e)),r.length>80*e){o=h=r[0],u=l=r[1];for(var x=e;x<s;x+=e)f=r[x],c=r[x+1],f<o&&(o=f),c<u&&(u=c),f>h&&(h=f),c>l&&(l=c);_=Math.max(h-o,l-u),_=_!==0?32767/_:0}return L(a,i,e,o,u,_,0),i}function q(r,t,e,n,s){var a,i;if(s===W(r,t,e,n)>0)for(a=t;a<e;a+=n)i=Q(a,r[a],r[a+1],i);else for(a=e-n;a>=t;a-=n)i=Q(a,r[a],r[a+1],i);return i&&G(i,i.next)&&(I(i),i=i.next),i}function b(r,t){if(!r)return r;t||(t=r);var e=r,n;do if(n=!1,!e.steiner&&(G(e,e.next)||g(e.prev,e,e.next)===0)){if(I(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function L(r,t,e,n,s,a,i){if(r){!i&&a&&Ve(r,n,s,a);for(var o=r,u,h;r.prev!==r.next;){if(u=r.prev,h=r.next,a?Pe(r,n,s,a):Ue(r)){t.push(u.i/e|0),t.push(r.i/e|0),t.push(h.i/e|0),I(r),r=h.next,o=h.next;continue}if(r=h,r===o){i?i===1?(r=Ge(b(r),t,e),L(r,t,e,n,s,a,2)):i===2&&ke(r,t,e,n,s,a):L(b(r),t,e,n,s,a,1);break}}}}function Ue(r){var t=r.prev,e=r,n=r.next;if(g(t,e,n)>=0)return!1;for(var s=t.x,a=e.x,i=n.x,o=t.y,u=e.y,h=n.y,l=s<a?s<i?s:i:a<i?a:i,f=o<u?o<h?o:h:u<h?u:h,c=s>a?s>i?s:i:a>i?a:i,_=o>u?o>h?o:h:u>h?u:h,x=n.next;x!==t;){if(x.x>=l&&x.x<=c&&x.y>=f&&x.y<=_&&E(s,o,a,u,i,h,x.x,x.y)&&g(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function Pe(r,t,e,n){var s=r.prev,a=r,i=r.next;if(g(s,a,i)>=0)return!1;for(var o=s.x,u=a.x,h=i.x,l=s.y,f=a.y,c=i.y,_=o<u?o<h?o:h:u<h?u:h,x=l<f?l<c?l:c:f<c?f:c,w=o>u?o>h?o:h:u>h?u:h,R=l>f?l>c?l:c:f>c?f:c,j=k(_,x,t,e,n),H=k(w,R,t,e,n),d=r.prevZ,p=r.nextZ;d&&d.z>=j&&p&&p.z<=H;){if(d.x>=_&&d.x<=w&&d.y>=x&&d.y<=R&&d!==s&&d!==i&&E(o,l,u,f,h,c,d.x,d.y)&&g(d.prev,d,d.next)>=0||(d=d.prevZ,p.x>=_&&p.x<=w&&p.y>=x&&p.y<=R&&p!==s&&p!==i&&E(o,l,u,f,h,c,p.x,p.y)&&g(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;d&&d.z>=j;){if(d.x>=_&&d.x<=w&&d.y>=x&&d.y<=R&&d!==s&&d!==i&&E(o,l,u,f,h,c,d.x,d.y)&&g(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=H;){if(p.x>=_&&p.x<=w&&p.y>=x&&p.y<=R&&p!==s&&p!==i&&E(o,l,u,f,h,c,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Ge(r,t,e){var n=r;do{var s=n.prev,a=n.next.next;!G(s,a)&&ee(s,n,n.next,a)&&C(s,a)&&C(a,s)&&(t.push(s.i/e|0),t.push(n.i/e|0),t.push(a.i/e|0),I(n),I(n.next),n=r=a),n=n.next}while(n!==r);return b(n)}function ke(r,t,e,n,s,a){var i=r;do{for(var o=i.next.next;o!==i.prev;){if(i.i!==o.i&&$e(i,o)){var u=te(i,o);i=b(i,i.next),u=b(u,u.next),L(i,t,e,n,s,a,0),L(u,t,e,n,s,a,0);return}o=o.next}i=i.next}while(i!==r)}function Ne(r,t,e,n){var s=[],a,i,o,u,h;for(a=0,i=t.length;a<i;a++)o=t[a]*n,u=a<i-1?t[a+1]*n:r.length,h=q(r,o,u,n,!1),h===h.next&&(h.steiner=!0),s.push(Ke(h));for(s.sort(We),a=0;a<s.length;a++)e=Ze(s[a],e);return e}function We(r,t){return r.x-t.x}function Ze(r,t){var e=je(r,t);if(!e)return t;var n=te(e,r);return b(n,n.next),b(e,e.next)}function je(r,t){var e=t,n=r.x,s=r.y,a=-1/0,i;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){var o=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(o<=n&&o>a&&(a=o,i=e.x<e.next.x?e:e.next,o===n))return i}e=e.next}while(e!==t);if(!i)return null;var u=i,h=i.x,l=i.y,f=1/0,c;e=i;do n>=e.x&&e.x>=h&&n!==e.x&&E(s<l?n:a,s,h,l,s<l?a:n,s,e.x,e.y)&&(c=Math.abs(s-e.y)/(n-e.x),C(e,r)&&(c<f||c===f&&(e.x>i.x||e.x===i.x&&He(i,e)))&&(i=e,f=c)),e=e.next;while(e!==u);return i}function He(r,t){return g(r.prev,r,t.prev)<0&&g(t.next,r,r.next)<0}function Ve(r,t,e,n){var s=r;do s.z===0&&(s.z=k(s.x,s.y,t,e,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,Oe(s)}function Oe(r){var t,e,n,s,a,i,o,u,h=1;do{for(e=r,r=null,a=null,i=0;e;){for(i++,n=e,o=0,t=0;t<h&&(o++,n=n.nextZ,!!n);t++);for(u=h;o>0||u>0&&n;)o!==0&&(u===0||!n||e.z<=n.z)?(s=e,e=e.nextZ,o--):(s=n,n=n.nextZ,u--),a?a.nextZ=s:r=s,s.prevZ=a,a=s;e=n}a.nextZ=null,h*=2}while(i>1);return r}function k(r,t,e,n,s){return r=(r-e)*s|0,t=(t-n)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function Ke(r){var t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function E(r,t,e,n,s,a,i,o){return(s-i)*(t-o)>=(r-i)*(a-o)&&(r-i)*(n-o)>=(e-i)*(t-o)&&(e-i)*(a-o)>=(s-i)*(n-o)}function $e(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!Je(r,t)&&(C(r,t)&&C(t,r)&&Qe(r,t)&&(g(r.prev,r,t.prev)||g(r,t.prev,t))||G(r,t)&&g(r.prev,r,r.next)>0&&g(t.prev,t,t.next)>0)}function g(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function G(r,t){return r.x===t.x&&r.y===t.y}function ee(r,t,e,n){var s=U(g(r,t,e)),a=U(g(r,t,n)),i=U(g(e,n,r)),o=U(g(e,n,t));return!!(s!==a&&i!==o||s===0&&z(r,e,t)||a===0&&z(r,n,t)||i===0&&z(e,r,n)||o===0&&z(e,t,n))}function z(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function U(r){return r>0?1:r<0?-1:0}function Je(r,t){var e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&ee(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function C(r,t){return g(r.prev,r,r.next)<0?g(r,t,r.next)>=0&&g(r,r.prev,t)>=0:g(r,t,r.prev)<0||g(r,r.next,t)<0}function Qe(r,t){var e=r,n=!1,s=(r.x+t.x)/2,a=(r.y+t.y)/2;do e.y>a!=e.next.y>a&&e.next.y!==e.y&&s<(e.next.x-e.x)*(a-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==r);return n}function te(r,t){var e=new N(r.i,r.x,r.y),n=new N(t.i,t.x,t.y),s=r.next,a=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,n.next=e,e.prev=n,a.next=n,n.prev=a,n}function Q(r,t,e,n){var s=new N(r,t,e);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function I(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function N(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}P.deviation=function(r,t,e,n){var s=t&&t.length,a=s?t[0]*e:r.length,i=Math.abs(W(r,0,a,e));if(s)for(var o=0,u=t.length;o<u;o++){var h=t[o]*e,l=o<u-1?t[o+1]*e:r.length;i-=Math.abs(W(r,h,l,e))}var f=0;for(o=0;o<n.length;o+=3){var c=n[o]*e,_=n[o+1]*e,x=n[o+2]*e;f+=Math.abs((r[c]-r[x])*(r[_+1]-r[c+1])-(r[c]-r[_])*(r[x+1]-r[c+1]))}return i===0&&f===0?0:Math.abs((f-i)/i)};function W(r,t,e,n){for(var s=0,a=t,i=e-n;a<e;a+=n)s+=(r[i]-r[a])*(r[a+1]+r[i+1]),i=a;return s}P.flatten=function(r){for(var t=r[0][0].length,e={vertices:[],holes:[],dimensions:t},n=0,s=0;s<r.length;s++){for(var a=0;a<r[s].length;a++)for(var i=0;i<t;i++)e.vertices.push(r[s][a][i]);s>0&&(n+=r[s-1].length,e.holes.push(n))}return e};function Xe(r,t){t=t||[];const e=256,n=e-1;return t[0]=Math.floor(r/e/e/e)/n,t[1]=Math.floor(r/e/e)%e/n,t[2]=Math.floor(r/e)%e/n,t[3]=r%e/n,t}function Ye(r){let t=0;const e=256,n=e-1;return t+=Math.round(r[0]*e*e*e*n),t+=Math.round(r[1]*e*e*n),t+=Math.round(r[2]*e*n),t+=Math.round(r[3]*n),t}class qe extends Ae{constructor(t,e){const n=e.uniforms||{},s=B();n[Le.PROJECTION_MATRIX]=s,super(t,{uniforms:n,postProcesses:e.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new K(Ce,$),this.indicesBuffer_=new K(Ie,$),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.program_,this.hitDetectionEnabled_=e.hitDetectionEnabled??!0;const a=e.attributes?e.attributes.map(function(o){return{name:"a_"+o.name,size:1,type:A.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:A.FLOAT},{name:"a_index",size:1,type:A.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_hitColor",size:4,type:A.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:A.FLOAT})),this.attributes.push(...a),this.customAttributes=e.attributes?e.attributes:[],this.previousExtent_=se(),this.currentTransform_=s,this.renderTransform_=B(),this.invertRenderTransform_=B(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=Be(),this.worker_.addEventListener("message",o=>{const u=o.data;if(u.type===J.GENERATE_POINT_BUFFERS){const h=u.projectionTransform;this.verticesBuffer_.fromArrayBuffer(u.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(u.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=h,ie(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(o.data.renderInstructions),u.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const i=this.getLayer().getSource();this.sourceListenKeys_=[M(i,D.ADDFEATURE,this.handleSourceFeatureAdded_,this),M(i,D.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),M(i,D.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),M(i,D.CLEAR,this.handleSourceFeatureClear_,this)],i.forEachFeature(o=>{this.featureCache_[S(o)]={feature:o,properties:o.getProperties(),geometry:o.getGeometry()},this.featureCount_++})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new ze(this.helper))}handleSourceFeatureAdded_(t){const e=t.feature;this.featureCache_[S(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(t){const e=t.feature;this.featureCache_[S(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}}handleSourceFeatureDelete_(t){const e=t.feature;delete this.featureCache_[S(e)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(t){const e=this.helper.getGL();this.preRender(e,t);const[n,s,a]=this.getWorldParameters_(t);this.renderWorlds(t,!1,n,s,a),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const i=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(t,!0,n,s,a),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),i}getWorldParameters_(t){const e=t.viewState.projection,a=this.getLayer().getSource().getWrapX()&&e.canWrapX(),i=e.getExtent(),o=t.extent,u=a?ae(i):null,h=a?Math.ceil((o[2]-i[2])/u)+1:1;return[a?Math.floor((o[0]-i[0])/u):0,h,u]}prepareFrameInternal(t){const e=this.getLayer(),n=e.getSource(),s=t.viewState,a=!t.viewHints[V.ANIMATING]&&!t.viewHints[V.INTERACTING],i=!oe(this.previousExtent_,t.extent),o=this.sourceRevision_<n.getRevision();if(o&&(this.sourceRevision_=n.getRevision()),a&&(i||o)){const u=s.projection,h=s.resolution,l=e instanceof X?e.getRenderBuffer():0,f=ue(t.extent,l*h);n.loadFeatures(f,h,u),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.useProgram(this.program_,t),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(t){const e=B();this.helper.makeProjectionTransform(t,e);const s=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,a=s*this.featureCount_;(!this.renderInstructions_||this.renderInstructions_.length!==a)&&(this.renderInstructions_=new Float32Array(a));let i,o;const u=[],h=[];let l=-1;for(const c in this.featureCache_)if(i=this.featureCache_[c],o=i.geometry,!(!o||o.getType()!=="Point")){if(u[0]=o.getFlatCoordinates()[0],u[1]=o.getFlatCoordinates()[1],O(e,u),this.renderInstructions_[++l]=u[0],this.renderInstructions_[++l]=u[1],this.hitDetectionEnabled_){const _=Xe(l+5,h);this.renderInstructions_[++l]=_[0],this.renderInstructions_[++l]=_[1],this.renderInstructions_[++l]=_[2],this.renderInstructions_[++l]=_[3],this.renderInstructions_[++l]=Number(c)}for(let _=0;_<this.customAttributes.length;_++){const x=this.customAttributes[_].callback(i.feature,i.properties);this.renderInstructions_[++l]=x}}const f={id:++this.lastSentId,type:J.GENERATE_POINT_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesSize:s-2};f.projectionTransform=e,this.ready=!1,this.worker_.postMessage(f,[this.renderInstructions_.buffer]),this.renderInstructions_=null}forEachFeatureAtCoordinate(t,e,n,s,a){if(he(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`"),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const i=O(e.coordinateToPixelTransform,t.slice()),o=this.hitRenderTarget_.readPixel(i[0]/2,i[1]/2),u=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],h=Ye(u),l=this.renderInstructions_[h],f=Math.floor(l).toString(),_=this.getLayer().getSource().getFeatureByUid(f);if(_)return s(_,this.getLayer(),null)}renderWorlds(t,e,n,s,a){let i=n;this.helper.useProgram(this.program_,t),e&&(this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(t,this.currentTransform_),le(this.currentTransform_,i*a,0),ce(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t),this.helper.applyHitDetectionUniform(e);const o=this.indicesBuffer_.getSize();this.helper.drawElements(0,o)}while(++i<s)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){fe(t)}),this.sourceListenKeys_=null,super.disposeInternal()}}const et=qe,m={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},tt=["#00f","#0ff","#0f0","#ff0","#f00"];class rt extends X{constructor(t){t=t||{};const e=Object.assign({},t);delete e.gradient,delete e.radius,delete e.blur,delete e.weight,super(e),this.gradient_=null,this.addChangeListener(m.GRADIENT,this.handleGradientChanged_),this.setGradient(t.gradient?t.gradient:tt),this.setBlur(t.blur!==void 0?t.blur:15),this.setRadius(t.radius!==void 0?t.radius:8);const n=t.weight?t.weight:"weight";typeof n=="string"?this.weightFunction_=function(s){return s.get(n)}:this.weightFunction_=n,this.setRenderOrder(null)}getBlur(){return this.get(m.BLUR)}getGradient(){return this.get(m.GRADIENT)}getRadius(){return this.get(m.RADIUS)}handleGradientChanged_(){this.gradient_=nt(this.getGradient())}setBlur(t){this.set(m.BLUR,t)}setGradient(t){this.set(m.GRADIENT,t)}setRadius(t){this.set(m.RADIUS,t)}createRenderer(){const t=new Me().addAttribute("float a_weight").addVarying("v_weight","float","a_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_weight)");return new et(this,{className:this.getClassName(),attributes:[{name:"weight",callback:e=>{const n=this.weightFunction_(e);return n!==void 0?de(n,0,1):1}}],uniforms:{u_size:()=>(this.get(m.RADIUS)+this.get(m.BLUR))*2,u_blurSlope:()=>this.get(m.RADIUS)/Math.max(1,this.get(m.BLUR))},hitDetectionEnabled:!0,vertexShader:t.getSymbolVertexShader(),fragmentShader:t.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function nt(r){const n=pe(1,256),s=n.createLinearGradient(0,0,1,256),a=1/(r.length-1);for(let i=0,o=r.length;i<o;++i)s.addColorStop(i*a,r[i]);return n.fillStyle=s,n.fillRect(0,0,1,256),n.canvas}const st=rt,it="Earthquakes Heatmap",at=`
  <div id="map" class="map"></div>
  <form>
    <label for="radius">radius size</label>
    <input id="radius" type="range" min="1" max="50" step="1" value="5"/>
    <label for="blur">blur size</label>
    <input id="blur" type="range" min="1" max="50" step="1" value="15"/>
  </form>
`,ot=`
  .map {
    width: 100%;
    height: 400px;
  }
`,ut=`
  import KML from 'ol/format/KML.js';
  import Map from 'ol/Map.js';
  import StadiaMaps from 'ol/source/StadiaMaps.js';
  import VectorSource from 'ol/source/Vector.js';
  import View from 'ol/View.js';
  import {Heatmap as HeatmapLayer, Tile as TileLayer} from 'ol/layer.js';

  const blur = document.getElementById('blur');
  const radius = document.getElementById('radius');

  const vector = new HeatmapLayer({
    source: new VectorSource({
      url: 'data/kml/2012_Earthquakes_Mag5.kml',
      format: new KML({
        extractStyles: false,
      }),
    }),
    blur: parseInt(blur.value, 10),
    radius: parseInt(radius.value, 10),
    weight: function (feature) {
      // 2012_Earthquakes_Mag5.kml stores the magnitude of each earthquake in a
      // standards-violating <magnitude> tag in each Placemark.  We extract it from
      // the Placemark's name instead.
      const name = feature.get('name');
      const magnitude = parseFloat(name.substr(2));
      return magnitude - 5;
    },
  });

  const raster = new TileLayer({
    source: new StadiaMaps({
      layer: 'stamen_toner',
    }),
  });

  new Map({
    layers: [raster, vector],
    target: 'map',
    view: new View({
      center: [0, 0],
      zoom: 2,
    }),
  });

  blur.addEventListener('input', function () {
    vector.setBlur(parseInt(blur.value, 10));
  });

  radius.addEventListener('input', function () {
    vector.setRadius(parseInt(radius.value, 10));
  });
`,ht=`
  {
    "name": "heatmap-earthquakes",
    "dependencies": {
      "ol": "8.2.0"
    },
    "devDependencies": {
      "vite": "^3.2.3"
    },
    "scripts": {
      "start": "vite",
      "build": "vite build"
    }
  }
`;const Z=r=>(Fe("data-v-13a08611"),r=r(),Te(),r),lt={id:"title"},ct=Re('<div id="map" class="map" data-v-13a08611></div><form data-v-13a08611><label for="radius" data-v-13a08611>radius size</label><input id="radius" type="range" min="1" max="50" step="1" value="5" data-v-13a08611><label for="blur" data-v-13a08611>blur size</label><input id="blur" type="range" min="1" max="50" step="1" value="15" data-v-13a08611></form><p data-v-13a08611>This example parses a KML file and renders the features as a ol/layer/Heatmap layer.</p><h5 class="source-heading" data-v-13a08611>html</h5>',4),ft={class:"language-html"},dt=Z(()=>v("h5",{class:"source-heading"},"css",-1)),pt={class:"language-css"},_t=Z(()=>v("h5",{class:"source-heading"},"js",-1)),xt={class:"language-js"},gt=Z(()=>v("h5",{class:"source-heading"},"package.json",-1)),vt={class:"language-json"},mt={__name:"index",setup(r){return ye(()=>{const t=document.getElementById("blur"),e=document.getElementById("radius"),n=new st({source:new ve({url:"data/kml/2012_Earthquakes_Mag5.kml",format:new re({extractStyles:!1})}),blur:parseInt(t.value,10),radius:parseInt(e.value,10),weight:function(a){const i=a.get("name");return parseFloat(i.substr(2))-5}}),s=new Se({source:new ge({layer:"stamen_toner"})});new _e({layers:[s,n],target:"map",view:new xe({center:[0,0],zoom:2})}),t.addEventListener("input",function(){n.setBlur(parseInt(t.value,10))}),e.addEventListener("input",function(){n.setRadius(parseInt(e.value,10))}),Prism.highlightAll()}),(t,e)=>(be(),Ee(we,null,[v("h4",lt,F(T(it)),1),ct,v("pre",null,[v("code",ft,F("  "+T(at).trim()),1)]),dt,v("pre",null,[v("code",pt,F("  "+T(ot).trim()),1)]),_t,v("pre",null,[v("code",xt,F("  "+T(ut).trim()),1)]),gt,v("pre",null,[v("code",vt,F("  "+T(ht).trim()),1)])],64))}},Ht=me(mt,[["__scopeId","data-v-13a08611"]]);export{Ht as default};
