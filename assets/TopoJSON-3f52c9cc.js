import{cc as fe,bZ as he,g as C,cn as me,K as I,H as S,N as ge,aD as ye,P as re,aa as P,a as Ee}from"./Layer-227d2e40.js";import{F as N}from"./Vector-dc05cca5.js";import{L as Y}from"./LineString-72752817.js";import{M as se,a as Te}from"./MultiPolygon-4cf6e085.js";import{m as y,X as Re,p as A,c as ne,a as te,b as w,d as k,e as l,r as m,f as c,g as D,h as R,i as Z,w as g,j as M,k as oe,l as x,n as _e,o as ie,O as v,q as B,s as xe}from"./KML-9d76c4ba.js";import{t as _,F as Pe}from"./Feature-315822cb.js";import{J as Ae}from"./JSONFeature-4dcaaca7.js";import{M as we}from"./MultiPoint-97d710ff.js";const Fe={ADD_FEATURES:"addfeatures"};class Se extends ye{constructor(e,r,t,n){super(e),this.features=t,this.file=r,this.projection=n}}class Ne extends fe{constructor(e){e=e||{},super({handleEvent:he}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const r=e.formatConstructors?e.formatConstructors:[];for(let t=0,n=r.length;t<n;++t){let o=r[t];typeof o=="function"&&(o=new o),this.formats_.push(o),this.readAsBuffer_=this.readAsBuffer_||o.getType()==="arraybuffer"}this.projection_=e.projection?C(e.projection):null,this.dropListenKeys_=null,this.source_=e.source||null,this.target=e.target?e.target:null}handleResult_(e,r){const t=r.target.result,n=this.getMap();let o=this.projection_;o||(o=me(),o||(o=n.getView().getProjection()));let i;const a=this.formats_;for(let u=0,p=a.length;u<p;++u){const f=a[u];let E=t;this.readAsBuffer_&&f.getType()!=="arraybuffer"&&(i===void 0&&(i=new TextDecoder().decode(t)),E=i);const T=this.tryReadFeatures_(f,E,{featureProjection:o});if(T&&T.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(T)),this.dispatchEvent(new Se(Fe.ADD_FEATURES,e,T,o));break}}}registerListeners_(){const e=this.getMap();if(e){const r=this.target?this.target:e.getViewport();this.dropListenKeys_=[I(r,S.DROP,this.handleDrop,this),I(r,S.DRAGENTER,this.handleStop,this),I(r,S.DRAGOVER,this.handleStop,this),I(r,S.DROP,this.handleStop,this)]}}setActive(e){!this.getActive()&&e&&this.registerListeners_(),this.getActive()&&!e&&this.unregisterListeners_(),super.setActive(e)}setMap(e){this.unregisterListeners_(),super.setMap(e),this.getActive()&&this.registerListeners_()}tryReadFeatures_(e,r,t){try{return e.readFeatures(r,t)}catch{return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(ge),this.dropListenKeys_=null)}handleDrop(e){const r=e.dataTransfer.files;for(let t=0,n=r.length;t<n;++t){const o=r.item(t),i=new FileReader;i.addEventListener(S.LOAD,this.handleResult_.bind(this,o)),this.readAsBuffer_?i.readAsArrayBuffer(o):i.readAsText(o)}}handleStop(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}}const Dt=Ne,h=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Le="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Oe={rte:ae,trk:ue,wpt:ce},Ie=y(h,{rte:k(ae),trk:k(ue),wpt:k(ce)}),Ge=y(h,{text:l(m,"linkText"),type:l(m,"linkType")}),De=y(h,{rte:c(st),trk:c(nt),wpt:c(it)});class Me extends Re{constructor(e){super(),e=e||{},this.dataProjection=C("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let r=0,t=e.length;r<t;++r){const n=e[r];if(this.readExtensions_){const o=n.get("extensionsNode_")||null;this.readExtensions_(n,o)}n.set("extensionsNode_",void 0)}}readFeatureFromNode(e,r){if(!h.includes(e.namespaceURI))return null;const t=Oe[e.localName];if(!t)return null;const n=t(e,[this.getReadOptions(e,r)]);return n?(this.handleReadExtensions_([n]),n):null}readFeaturesFromNode(e,r){if(!h.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const t=A([],Ie,e,[this.getReadOptions(e,r)]);return t?(this.handleReadExtensions_(t),t):[]}return[]}writeFeaturesNode(e,r){r=this.adaptOptions(r);const t=ne("http://www.topografix.com/GPX/1/1","gpx"),n="http://www.w3.org/2000/xmlns/";return t.setAttributeNS(n,"xmlns:xsi",te),t.setAttributeNS(te,"xsi:schemaLocation",Le),t.setAttribute("version","1.1"),t.setAttribute("creator","OpenLayers"),w({node:t},De,be,e,[r]),t}}const Ce=y(h,{name:l(m),cmt:l(m),desc:l(m),src:l(m),link:J,number:l(D),extensions:V,type:l(m),rtept:et}),ve=y(h,{ele:l(R),time:l(Z)}),Ue=y(h,{name:l(m),cmt:l(m),desc:l(m),src:l(m),link:J,number:l(D),type:l(m),extensions:V,trkseg:rt}),Xe=y(h,{trkpt:tt}),Ke=y(h,{ele:l(R),time:l(Z)}),ke=y(h,{ele:l(R),time:l(Z),magvar:l(R),geoidheight:l(R),name:l(m),cmt:l(m),desc:l(m),src:l(m),link:J,sym:l(m),type:l(m),fix:l(m),sat:l(D),hdop:l(R),vdop:l(R),pdop:l(R),ageofdgpsdata:l(R),dgpsid:l(D),extensions:V}),Ye=["text","type"],Ze=y(h,{text:c(g),type:c(g)}),Be=y(h,["name","cmt","desc","src","link","number","type","rtept"]),We=y(h,{name:c(g),cmt:c(g),desc:c(g),src:c(g),link:c(Q),number:c(M),type:c(g),rtept:oe(c($))}),He=y(h,["ele","time"]),Je=y(h,["name","cmt","desc","src","link","number","type","trkseg"]),Ve=y(h,{name:c(g),cmt:c(g),desc:c(g),src:c(g),link:c(Q),number:c(M),type:c(g),trkseg:oe(c(ot))}),Qe=xe("trkpt"),$e=y(h,{trkpt:c($)}),ze=y(h,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),qe=y(h,{ele:c(x),time:c(_e),magvar:c(x),geoidheight:c(x),name:c(g),cmt:c(g),desc:c(g),src:c(g),link:c(Q),sym:c(g),type:c(g),fix:c(g),sat:c(M),hdop:c(x),vdop:c(x),pdop:c(x),ageofdgpsdata:c(x),dgpsid:c(M)}),je={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function be(s,e,r){const t=s.getGeometry();if(t){const n=je[t.getType()];if(n){const o=e[e.length-1].node;return ne(o.namespaceURI,n)}}}function W(s,e,r,t){return s.push(parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat"))),"ele"in t?(s.push(t.ele),delete t.ele,e.hasZ=!0):s.push(0),"time"in t?(s.push(t.time),delete t.time,e.hasM=!0):s.push(0),s}function H(s,e,r){let t="XY",n=2;if(s.hasZ&&s.hasM?(t="XYZM",n=4):s.hasZ?(t="XYZ",n=3):s.hasM&&(t="XYM",n=3),n!==4){for(let o=0,i=e.length/4;o<i;o++)e[o*n]=e[o*4],e[o*n+1]=e[o*4+1],s.hasZ&&(e[o*n+2]=e[o*4+2]),s.hasM&&(e[o*n+2]=e[o*4+3]);if(e.length=e.length/4*n,r)for(let o=0,i=r.length;o<i;o++)r[o]=r[o]/4*n}return t}function J(s,e){const r=e[e.length-1],t=s.getAttribute("href");t!==null&&(r.link=t),ie(Ge,s,e)}function V(s,e){const r=e[e.length-1];r.extensionsNode_=s}function et(s,e){const r=A({},ve,s,e);if(r){const t=e[e.length-1],n=t.flatCoordinates,o=t.layoutOptions;W(n,o,s,r)}}function tt(s,e){const r=A({},Ke,s,e);if(r){const t=e[e.length-1],n=t.flatCoordinates,o=t.layoutOptions;W(n,o,s,r)}}function rt(s,e){const r=e[e.length-1];ie(Xe,s,e);const t=r.flatCoordinates;r.ends.push(t.length)}function ae(s,e){const r=e[0],t=A({flatCoordinates:[],layoutOptions:{}},Ce,s,e);if(!t)return;const n=t.flatCoordinates;delete t.flatCoordinates;const o=t.layoutOptions;delete t.layoutOptions;const i=H(o,n),a=new Y(n,i);_(a,!1,r);const u=new N(a);return u.setProperties(t,!0),u}function ue(s,e){const r=e[0],t=A({flatCoordinates:[],ends:[],layoutOptions:{}},Ue,s,e);if(!t)return;const n=t.flatCoordinates;delete t.flatCoordinates;const o=t.ends;delete t.ends;const i=t.layoutOptions;delete t.layoutOptions;const a=H(i,n,o),u=new se(n,a,o);_(u,!1,r);const p=new N(u);return p.setProperties(t,!0),p}function ce(s,e){const r=e[0],t=A({},ke,s,e);if(!t)return;const n={},o=W([],n,s,t),i=H(n,o),a=new re(o,i);_(a,!1,r);const u=new N(a);return u.setProperties(t,!0),u}function Q(s,e,r){s.setAttribute("href",e);const n=r[r.length-1].properties,o=[n.linkText,n.linkType];w({node:s},Ze,v,o,r,Ye)}function $(s,e,r){const t=r[r.length-1],o=t.node.namespaceURI,i=t.properties;switch(s.setAttributeNS(null,"lat",String(e[1])),s.setAttributeNS(null,"lon",String(e[0])),t.geometryLayout){case"XYZM":e[3]!==0&&(i.time=e[3]);case"XYZ":e[2]!==0&&(i.ele=e[2]);break;case"XYM":e[2]!==0&&(i.time=e[2]);break}const u=s.nodeName=="rtept"?He[o]:ze[o],p=B(i,u);w({node:s,properties:i},qe,v,p,r,u)}function st(s,e,r){const t=r[0],n=e.getProperties(),o={node:s};o.properties=n;const i=e.getGeometry();if(i.getType()=="LineString"){const f=_(i,!0,t);o.geometryLayout=f.getLayout(),n.rtept=f.getCoordinates()}const a=r[r.length-1].node,u=Be[a.namespaceURI],p=B(n,u);w(o,We,v,p,r,u)}function nt(s,e,r){const t=r[0],n=e.getProperties(),o={node:s};o.properties=n;const i=e.getGeometry();if(i.getType()=="MultiLineString"){const f=_(i,!0,t);n.trkseg=f.getLineStrings()}const a=r[r.length-1].node,u=Je[a.namespaceURI],p=B(n,u);w(o,Ve,v,p,r,u)}function ot(s,e,r){const t={node:s};t.geometryLayout=e.getLayout(),t.properties={},w(t,$e,Qe,e.getCoordinates(),r)}function it(s,e,r){const t=r[0],n=r[r.length-1];n.properties=e.getProperties();const o=e.getGeometry();if(o.getType()=="Point"){const i=_(o,!0,t);n.geometryLayout=i.getLayout(),$(s,i.getCoordinates(),r)}}const Mt=Me;class at extends Pe{constructor(){super()}getType(){return"text"}readFeature(e,r){return this.readFeatureFromText(G(e),this.adaptOptions(r))}readFeatureFromText(e,r){return P()}readFeatures(e,r){return this.readFeaturesFromText(G(e),this.adaptOptions(r))}readFeaturesFromText(e,r){return P()}readGeometry(e,r){return this.readGeometryFromText(G(e),this.adaptOptions(r))}readGeometryFromText(e,r){return P()}readProjection(e){return this.readProjectionFromText(G(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,r){return this.writeFeatureText(e,this.adaptOptions(r))}writeFeatureText(e,r){return P()}writeFeatures(e,r){return this.writeFeaturesText(e,this.adaptOptions(r))}writeFeaturesText(e,r){return P()}writeGeometry(e,r){return this.writeGeometryText(e,this.adaptOptions(r))}writeGeometryText(e,r){return P()}}function G(s){return typeof s=="string"?s:""}const ut=at,ct=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,lt=/^H.([A-Z]{3}).*?:(.*)/,pt=/^HFDTE(\d{2})(\d{2})(\d{2})/,dt=/\r\n|\r|\n/;class ft extends ut{constructor(e){super(),e=e||{},this.dataProjection=C("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,r){const t=this.altitudeMode_,n=e.split(dt),o={},i=[];let a=2e3,u=0,p=1,f=-1,E,T;for(E=0,T=n.length;E<T;++E){const F=n[E];let d;if(F.charAt(0)=="B"){if(d=ct.exec(F),d){const j=parseInt(d[1],10),b=parseInt(d[2],10),ee=parseInt(d[3],10);let X=parseInt(d[4],10)+parseInt(d[5],10)/6e4;d[6]=="S"&&(X=-X);let K=parseInt(d[7],10)+parseInt(d[8],10)/6e4;if(d[9]=="W"&&(K=-K),i.push(K,X),t!="none"){let O;t=="gps"?O=parseInt(d[11],10):t=="barometric"?O=parseInt(d[12],10):O=0,i.push(O)}let L=Date.UTC(a,u,p,j,b,ee);L<f&&(L=Date.UTC(a,u,p+1,j,b,ee)),i.push(L/1e3),f=L}}else F.charAt(0)=="H"&&(d=pt.exec(F),d?(p=parseInt(d[1],10),u=parseInt(d[2],10)-1,a=2e3+parseInt(d[3],10)):(d=lt.exec(F),d&&(o[d[1]]=d[2].trim())))}if(i.length===0)return null;const pe=t=="none"?"XYM":"XYZM",de=new Y(i,pe),q=new N(_(de,!1,r));return q.setProperties(o,!0),q}readFeaturesFromText(e,r){const t=this.readFeatureFromText(e,r);return t?[t]:[]}}const Ct=ft;class ht extends Ae{constructor(e){super(),e=e||{},this.layerName_=e.layerName,this.layers_=e.layers?e.layers:null,this.dataProjection=C(e.dataProjection?e.dataProjection:"EPSG:4326")}readFeaturesFromObject(e,r){if(e.type=="Topology"){const t=e;let n,o=null,i=null;t.transform&&(n=t.transform,o=n.scale,i=n.translate);const a=t.arcs;n&&Pt(a,o,i);const u=[],p=t.objects,f=this.layerName_;let E;for(const T in p)this.layers_&&!this.layers_.includes(T)||(p[T].type==="GeometryCollection"?(E=p[T],u.push.apply(u,xt(E,a,o,i,f,T,r))):(E=p[T],u.push(le(E,a,o,i,f,T,r))));return u}return[]}readProjectionFromObject(e){return this.dataProjection}}const mt={Point:gt,LineString:Et,Polygon:Rt,MultiPoint:yt,MultiLineString:Tt,MultiPolygon:_t};function U(s,e){const r=[];let t;for(let n=0,o=s.length;n<o;++n)if(t=s[n],n>0&&r.pop(),t>=0){const i=e[t];for(let a=0,u=i.length;a<u;++a)r.push(i[a].slice(0))}else{const i=e[~t];for(let a=i.length-1;a>=0;--a)r.push(i[a].slice(0))}return r}function gt(s,e,r){const t=s.coordinates;return e&&r&&z(t,e,r),new re(t)}function yt(s,e,r){const t=s.coordinates;if(e&&r)for(let n=0,o=t.length;n<o;++n)z(t[n],e,r);return new we(t)}function Et(s,e){const r=U(s.arcs,e);return new Y(r)}function Tt(s,e){const r=[];for(let t=0,n=s.arcs.length;t<n;++t)r[t]=U(s.arcs[t],e);return new se(r)}function Rt(s,e){const r=[];for(let t=0,n=s.arcs.length;t<n;++t)r[t]=U(s.arcs[t],e);return new Ee(r)}function _t(s,e){const r=[];for(let t=0,n=s.arcs.length;t<n;++t){const o=s.arcs[t],i=[];for(let a=0,u=o.length;a<u;++a)i[a]=U(o[a],e);r[t]=i}return new Te(r)}function xt(s,e,r,t,n,o,i){const a=s.geometries,u=[];for(let p=0,f=a.length;p<f;++p)u[p]=le(a[p],e,r,t,n,o,i);return u}function le(s,e,r,t,n,o,i){let a=null;const u=s.type;if(u){const E=mt[u];u==="Point"||u==="MultiPoint"?a=E(s,r,t):a=E(s,e),a=_(a,!1,i)}const p=new N({geometry:a});s.id!==void 0&&p.setId(s.id);let f=s.properties;return n&&(f||(f={}),f[n]=o),f&&p.setProperties(f,!0),p}function Pt(s,e,r){for(let t=0,n=s.length;t<n;++t)At(s[t],e,r)}function At(s,e,r){let t=0,n=0;for(let o=0,i=s.length;o<i;++o){const a=s[o];t+=a[0],n+=a[1],a[0]=t,a[1]=n,z(a,e,r)}}function z(s,e,r){s[0]=s[0]*e[0]+r[0],s[1]=s[1]*e[1]+r[1]}const vt=ht;export{Dt as D,Mt as G,Ct as I,vt as T};
