import{I as Bt,T as $t,g as de,cm as Ht,a3 as me,E as ie,a4 as Vt,B as Qt,q as P,av as V,P as ke,a as Ke,ba as se,aY as Wt,cn as Jt}from"./Layer-da76b588.js";import{F as ne}from"./Vector-844a0c6a.js";import{L as fe}from"./LineString-e19dc84a.js";import{F as ut,t as k,M as Te,a as dt,b as ft}from"./MultiPolygon-79cfbc3b.js";import{a as q,F as be,I as mt,S as Me,T as gt}from"./featureloader-5ea9ad61.js";import{a as W}from"./GeoJSON-1f2a259b.js";import{p as le}from"./string-30bf5402.js";import{J as qt}from"./JSONFeature-c33571f5.js";const jt={ADD_FEATURES:"addfeatures"};class en extends Qt{constructor(e,t,n,r){super(e),this.features=n,this.file=t,this.projection=r}}class tn extends Bt{constructor(e){e=e||{},super({handleEvent:$t}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const t=e.formatConstructors?e.formatConstructors:[];for(let n=0,r=t.length;n<r;++n){let i=t[n];typeof i=="function"&&(i=new i),this.formats_.push(i),this.readAsBuffer_=this.readAsBuffer_||i.getType()==="arraybuffer"}this.projection_=e.projection?de(e.projection):null,this.dropListenKeys_=null,this.source_=e.source||null,this.target=e.target?e.target:null}handleResult_(e,t){const n=t.target.result,r=this.getMap();let i=this.projection_;i||(i=Ht(),i||(i=r.getView().getProjection()));let s;const l=this.formats_;for(let a=0,u=l.length;a<u;++a){const m=l[a];let p=n;this.readAsBuffer_&&m.getType()!=="arraybuffer"&&(s===void 0&&(s=new TextDecoder().decode(n)),p=s);const h=this.tryReadFeatures_(m,p,{featureProjection:i});if(h&&h.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(h)),this.dispatchEvent(new en(jt.ADD_FEATURES,e,h,i));break}}}registerListeners_(){const e=this.getMap();if(e){const t=this.target?this.target:e.getViewport();this.dropListenKeys_=[me(t,ie.DROP,this.handleDrop,this),me(t,ie.DRAGENTER,this.handleStop,this),me(t,ie.DRAGOVER,this.handleStop,this),me(t,ie.DROP,this.handleStop,this)]}}setActive(e){!this.getActive()&&e&&this.registerListeners_(),this.getActive()&&!e&&this.unregisterListeners_(),super.setActive(e)}setMap(e){this.unregisterListeners_(),super.setMap(e),this.getActive()&&this.registerListeners_()}tryReadFeatures_(e,t,n){try{return e.readFeatures(t,n)}catch{return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(Vt),this.dropListenKeys_=null)}handleDrop(e){const t=e.dataTransfer.files;for(let n=0,r=t.length;n<r;++n){const i=t.item(n),s=new FileReader;s.addEventListener(ie.LOAD,this.handleResult_.bind(this,i)),this.readAsBuffer_?s.readAsArrayBuffer(i):s.readAsText(i)}}handleStop(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}}const jo=tn,Ee="http://www.w3.org/2001/XMLSchema-instance";function J(o,e){return re().createElementNS(o,e)}function v(o,e){return pt(o,e,[]).join("")}function pt(o,e,t){if(o.nodeType==Node.CDATA_SECTION_NODE||o.nodeType==Node.TEXT_NODE)e?t.push(String(o.nodeValue).replace(/(\r\n|\r|\n)/g,"")):t.push(o.nodeValue);else{let n;for(n=o.firstChild;n;n=n.nextSibling)pt(n,e,t)}return t}function z(o){return"documentElement"in o}function Z(o){return new DOMParser().parseFromString(o,"application/xml")}function rt(o,e){return function(t,n){const r=o.call(e!==void 0?e:this,t,n);if(r!==void 0){const i=n[n.length-1];P(i,r)}}}function Y(o,e){return function(t,n){const r=o.call(e!==void 0?e:this,t,n);r!==void 0&&n[n.length-1].push(r)}}function ze(o,e){return function(t,n){const r=o.call(e!==void 0?e:this,t,n);r!==void 0&&(n[n.length-1]=r)}}function c(o,e,t){return function(n,r){const i=o.call(t!==void 0?t:this,n,r);if(i!==void 0){const s=r[r.length-1],l=e!==void 0?e:n.localName;s[l]=i}}}function d(o,e){return function(t,n,r){o.call(e!==void 0?e:this,t,n,r),r[r.length-1].node.appendChild(t)}}function ht(o,e){let t,n;return function(r,i,s){if(t===void 0){t={};const l={};l[r.localName]=o,t[r.namespaceURI]=l,n=X(r.localName)}yt(t,n,i,s)}}function X(o,e){return function(t,n,r){const s=n[n.length-1].node;let l=o;l===void 0&&(l=r);const a=e!==void 0?e:s.namespaceURI;return J(a,l)}}const I=X();function M(o,e){const t=e.length,n=new Array(t);for(let r=0;r<t;++r)n[r]=o[e[r]];return n}function f(o,e,t){t=t!==void 0?t:{};let n,r;for(n=0,r=o.length;n<r;++n)t[o[n]]=e;return t}function $(o,e,t,n){let r;for(r=e.firstElementChild;r;r=r.nextElementSibling){const i=o[r.namespaceURI];if(i!==void 0){const s=i[r.localName];s!==void 0&&s.call(n,r,t)}}}function S(o,e,t,n,r){return n.push(o),$(e,t,n,r),n.pop()}function yt(o,e,t,n,r,i){const s=(r!==void 0?r:t).length;let l,a;for(let u=0;u<s;++u)l=t[u],l!==void 0&&(a=e.call(i!==void 0?i:this,l,n,r!==void 0?r[u]:void 0),a!==void 0&&o[a.namespaceURI][a.localName].call(i,a,l,n))}function N(o,e,t,n,r,i,s){return r.push(o),yt(e,t,n,r,i,s),r.pop()}let Ie;function nn(){return Ie===void 0&&typeof XMLSerializer<"u"&&(Ie=new XMLSerializer),Ie}let Oe;function re(){return Oe===void 0&&typeof document<"u"&&(Oe=document.implementation.createDocument("","",null)),Oe}class rn extends ut{constructor(){super(),this.xmlSerializer_=nn()}getType(){return"xml"}readFeature(e,t){if(!e)return null;if(typeof e=="string"){const n=Z(e);return this.readFeatureFromDocument(n,t)}return z(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}readFeatureFromDocument(e,t){const n=this.readFeaturesFromDocument(e,t);return n.length>0?n[0]:null}readFeatureFromNode(e,t){return null}readFeatures(e,t){if(!e)return[];if(typeof e=="string"){const n=Z(e);return this.readFeaturesFromDocument(n,t)}return z(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}readFeaturesFromDocument(e,t){const n=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&P(n,this.readFeaturesFromNode(r,t));return n}readFeaturesFromNode(e,t){return V()}readGeometry(e,t){if(!e)return null;if(typeof e=="string"){const n=Z(e);return this.readGeometryFromDocument(n,t)}return z(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}readGeometryFromDocument(e,t){return null}readGeometryFromNode(e,t){return null}readProjection(e){if(!e)return null;if(typeof e=="string"){const t=Z(e);return this.readProjectionFromDocument(t)}return z(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,t){const n=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(n)}writeFeatureNode(e,t){return null}writeFeatures(e,t){const n=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(n)}writeFeaturesNode(e,t){return null}writeGeometry(e,t){const n=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(n)}writeGeometryNode(e,t){return null}}const Et=rn;function B(o){const e=v(o,!1);return on(e)}function on(o){const e=/^\s*(true|1)|(false|0)\s*$/.exec(o);if(e)return e[1]!==void 0||!1}function Ze(o){const e=v(o,!1),t=Date.parse(e);return isNaN(t)?void 0:t/1e3}function R(o){const e=v(o,!1);return sn(e)}function sn(o){const e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(o);if(e)return parseFloat(e[1])}function Se(o){const e=v(o,!1);return ln(e)}function ln(o){const e=/^\s*(\d+)\s*$/.exec(o);if(e)return parseInt(e[1],10)}function E(o){return v(o,!1).trim()}function te(o,e){_(o,e?"1":"0")}function an(o,e){o.appendChild(re().createCDATASection(e))}function cn(o,e){const t=new Date(e*1e3),n=t.getUTCFullYear()+"-"+le(t.getUTCMonth()+1,2)+"-"+le(t.getUTCDate(),2)+"T"+le(t.getUTCHours(),2)+":"+le(t.getUTCMinutes(),2)+":"+le(t.getUTCSeconds(),2)+"Z";o.appendChild(re().createTextNode(n))}function C(o,e){const t=e.toPrecision();o.appendChild(re().createTextNode(t))}function Re(o,e){const t=e.toString();o.appendChild(re().createTextNode(t))}function _(o,e){o.appendChild(re().createTextNode(e))}const L=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],un="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",dn={rte:St,trk:Rt,wpt:_t},fn=f(L,{rte:Y(St),trk:Y(Rt),wpt:Y(_t)}),mn=f(L,{text:c(E,"linkText"),type:c(E,"linkType")}),gn=f(L,{rte:d(vn),trk:d(Xn),wpt:d(Kn)});class pn extends Et{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,n=e.length;t<n;++t){const r=e[t];if(this.readExtensions_){const i=r.get("extensionsNode_")||null;this.readExtensions_(r,i)}r.set("extensionsNode_",void 0)}}readFeatureFromNode(e,t){if(!L.includes(e.namespaceURI))return null;const n=dn[e.localName];if(!n)return null;const r=n(e,[this.getReadOptions(e,t)]);return r?(this.handleReadExtensions_([r]),r):null}readFeaturesFromNode(e,t){if(!L.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const n=S([],fn,e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=J("http://www.topografix.com/GPX/1/1","gpx"),r="http://www.w3.org/2000/xmlns/";return n.setAttributeNS(r,"xmlns:xsi",Ee),n.setAttributeNS(Ee,"xsi:schemaLocation",un),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),N({node:n},gn,Mn,e,[t]),n}}const hn=f(L,{name:c(E),cmt:c(E),desc:c(E),src:c(E),link:He,number:c(Se),extensions:Ve,type:c(E),rtept:Un}),yn=f(L,{ele:c(R),time:c(Ze)}),En=f(L,{name:c(E),cmt:c(E),desc:c(E),src:c(E),link:He,number:c(Se),type:c(E),extensions:Ve,trkseg:Yn}),Sn=f(L,{trkpt:Gn}),Rn=f(L,{ele:c(R),time:c(Ze)}),_n=f(L,{ele:c(R),time:c(Ze),magvar:c(R),geoidheight:c(R),name:c(E),cmt:c(E),desc:c(E),src:c(E),link:He,sym:c(E),type:c(E),fix:c(E),sat:c(Se),hdop:c(R),vdop:c(R),pdop:c(R),ageofdgpsdata:c(R),dgpsid:c(Se),extensions:Ve}),Nn=["text","type"],Tn=f(L,{text:d(_),type:d(_)}),xn=f(L,["name","cmt","desc","src","link","number","type","rtept"]),An=f(L,{name:d(_),cmt:d(_),desc:d(_),src:d(_),link:d(Qe),number:d(Re),type:d(_),rtept:ht(d(We))}),Pn=f(L,["ele","time"]),Ln=f(L,["name","cmt","desc","src","link","number","type","trkseg"]),Fn=f(L,{name:d(_),cmt:d(_),desc:d(_),src:d(_),link:d(Qe),number:d(Re),type:d(_),trkseg:ht(d(kn))}),wn=X("trkpt"),In=f(L,{trkpt:d(We)}),On=f(L,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Dn=f(L,{ele:d(C),time:d(cn),magvar:d(C),geoidheight:d(C),name:d(_),cmt:d(_),desc:d(_),src:d(_),link:d(Qe),sym:d(_),type:d(_),fix:d(_),sat:d(Re),hdop:d(C),vdop:d(C),pdop:d(C),ageofdgpsdata:d(C),dgpsid:d(Re)}),Cn={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Mn(o,e,t){const n=o.getGeometry();if(n){const r=Cn[n.getType()];if(r){const i=e[e.length-1].node;return J(i.namespaceURI,r)}}}function Be(o,e,t,n){return o.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in n?(o.push(n.ele),delete n.ele,e.hasZ=!0):o.push(0),"time"in n?(o.push(n.time),delete n.time,e.hasM=!0):o.push(0),o}function $e(o,e,t){let n="XY",r=2;if(o.hasZ&&o.hasM?(n="XYZM",r=4):o.hasZ?(n="XYZ",r=3):o.hasM&&(n="XYM",r=3),r!==4){for(let i=0,s=e.length/4;i<s;i++)e[i*r]=e[i*4],e[i*r+1]=e[i*4+1],o.hasZ&&(e[i*r+2]=e[i*4+2]),o.hasM&&(e[i*r+2]=e[i*4+3]);if(e.length=e.length/4*r,t)for(let i=0,s=t.length;i<s;i++)t[i]=t[i]/4*r}return n}function He(o,e){const t=e[e.length-1],n=o.getAttribute("href");n!==null&&(t.link=n),$(mn,o,e)}function Ve(o,e){const t=e[e.length-1];t.extensionsNode_=o}function Un(o,e){const t=S({},yn,o,e);if(t){const n=e[e.length-1],r=n.flatCoordinates,i=n.layoutOptions;Be(r,i,o,t)}}function Gn(o,e){const t=S({},Rn,o,e);if(t){const n=e[e.length-1],r=n.flatCoordinates,i=n.layoutOptions;Be(r,i,o,t)}}function Yn(o,e){const t=e[e.length-1];$(Sn,o,e);const n=t.flatCoordinates;t.ends.push(n.length)}function St(o,e){const t=e[0],n=S({flatCoordinates:[],layoutOptions:{}},hn,o,e);if(!n)return;const r=n.flatCoordinates;delete n.flatCoordinates;const i=n.layoutOptions;delete n.layoutOptions;const s=$e(i,r),l=new fe(r,s);k(l,!1,t);const a=new ne(l);return a.setProperties(n,!0),a}function Rt(o,e){const t=e[0],n=S({flatCoordinates:[],ends:[],layoutOptions:{}},En,o,e);if(!n)return;const r=n.flatCoordinates;delete n.flatCoordinates;const i=n.ends;delete n.ends;const s=n.layoutOptions;delete n.layoutOptions;const l=$e(s,r,i),a=new Te(r,l,i);k(a,!1,t);const u=new ne(a);return u.setProperties(n,!0),u}function _t(o,e){const t=e[0],n=S({},_n,o,e);if(!n)return;const r={},i=Be([],r,o,n),s=$e(r,i),l=new ke(i,s);k(l,!1,t);const a=new ne(l);return a.setProperties(n,!0),a}function Qe(o,e,t){o.setAttribute("href",e);const r=t[t.length-1].properties,i=[r.linkText,r.linkType];N({node:o},Tn,I,i,t,Nn)}function We(o,e,t){const n=t[t.length-1],i=n.node.namespaceURI,s=n.properties;switch(o.setAttributeNS(null,"lat",String(e[1])),o.setAttributeNS(null,"lon",String(e[0])),n.geometryLayout){case"XYZM":e[3]!==0&&(s.time=e[3]);case"XYZ":e[2]!==0&&(s.ele=e[2]);break;case"XYM":e[2]!==0&&(s.time=e[2]);break}const a=o.nodeName=="rtept"?Pn[i]:On[i],u=M(s,a);N({node:o,properties:s},Dn,I,u,t,a)}function vn(o,e,t){const n=t[0],r=e.getProperties(),i={node:o};i.properties=r;const s=e.getGeometry();if(s.getType()=="LineString"){const m=k(s,!0,n);i.geometryLayout=m.getLayout(),r.rtept=m.getCoordinates()}const l=t[t.length-1].node,a=xn[l.namespaceURI],u=M(r,a);N(i,An,I,u,t,a)}function Xn(o,e,t){const n=t[0],r=e.getProperties(),i={node:o};i.properties=r;const s=e.getGeometry();if(s.getType()=="MultiLineString"){const m=k(s,!0,n);r.trkseg=m.getLineStrings()}const l=t[t.length-1].node,a=Ln[l.namespaceURI],u=M(r,a);N(i,Fn,I,u,t,a)}function kn(o,e,t){const n={node:o};n.geometryLayout=e.getLayout(),n.properties={},N(n,In,wn,e.getCoordinates(),t)}function Kn(o,e,t){const n=t[0],r=t[t.length-1];r.properties=e.getProperties();const i=e.getGeometry();if(i.getType()=="Point"){const s=k(i,!0,n);r.geometryLayout=s.getLayout(),We(o,s.getCoordinates(),t)}}const ei=pn;class bn extends ut{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(ge(e),this.adaptOptions(t))}readFeatureFromText(e,t){return V()}readFeatures(e,t){return this.readFeaturesFromText(ge(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return V()}readGeometry(e,t){return this.readGeometryFromText(ge(e),this.adaptOptions(t))}readGeometryFromText(e,t){return V()}readProjection(e){return this.readProjectionFromText(ge(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return V()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return V()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return V()}}function ge(o){return typeof o=="string"?o:""}const zn=bn,Zn=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,Bn=/^H.([A-Z]{3}).*?:(.*)/,$n=/^HFDTE(\d{2})(\d{2})(\d{2})/,Hn=/\r\n|\r|\n/;class Vn extends zn{constructor(e){super(),e=e||{},this.dataProjection=de("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none"}readFeatureFromText(e,t){const n=this.altitudeMode_,r=e.split(Hn),i={},s=[];let l=2e3,a=0,u=1,m=-1,p,h;for(p=0,h=r.length;p<h;++p){const T=r[p];let y;if(T.charAt(0)=="B"){if(y=Zn.exec(T),y){const O=parseInt(y[1],10),D=parseInt(y[2],10),F=parseInt(y[3],10);let K=parseInt(y[4],10)+parseInt(y[5],10)/6e4;y[6]=="S"&&(K=-K);let G=parseInt(y[7],10)+parseInt(y[8],10)/6e4;if(y[9]=="W"&&(G=-G),s.push(G,K),n!="none"){let H;n=="gps"?H=parseInt(y[11],10):n=="barometric"?H=parseInt(y[12],10):H=0,s.push(H)}let w=Date.UTC(l,a,u,O,D,F);w<m&&(w=Date.UTC(l,a,u+1,O,D,F)),s.push(w/1e3),m=w}}else T.charAt(0)=="H"&&(y=$n.exec(T),y?(u=parseInt(y[1],10),a=parseInt(y[2],10)-1,l=2e3+parseInt(y[3],10)):(y=Bn.exec(T),y&&(i[y[1]]=y[2].trim())))}if(s.length===0)return null;const x=n=="none"?"XYM":"XYZM",A=new fe(s,x),U=new ne(k(A,!1,t));return U.setProperties(i,!0),U}readFeaturesFromText(e,t){const n=this.readFeatureFromText(e,t);return n?[n]:[]}}const ti=Vn,b=["http://www.google.com/kml/ext/2.2"],g=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],Qn="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",ot={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},Wn=f(g,{ExtendedData:Gt,Region:Yt,MultiGeometry:c(Ct,"geometry"),LineString:c(Ot,"geometry"),LinearRing:c(Dt,"geometry"),Point:c(Mt,"geometry"),Polygon:c(Ut,"geometry"),Style:c(je),StyleMap:Cr,address:c(E),description:c(E),name:c(E),open:c(B),phoneNumber:c(E),styleUrl:c(Pt),visibility:c(B)},f(b,{MultiTrack:c(Rr,"geometry"),Track:c(It,"geometry")})),Jn=f(g,{ExtendedData:Gt,Region:Yt,Link:Br,address:c(E),description:c(E),name:c(E),open:c(B),phoneNumber:c(E),visibility:c(B)}),qn=f(g,{href:c(At)}),jn=f(g,{Altitude:c(R),Longitude:c(R),Latitude:c(R),Tilt:c(R),AltitudeMode:c(E),Heading:c(R),Roll:c(R)}),Nt=f(g,{LatLonAltBox:vr,Lod:kr}),er=f(g,["Document","Placemark"]),tr=f(g,{Document:d(jr),Placemark:d(kt)});let j,he=null,Ue,ae,ce,ue,_e,Ge=null,Je,Ye=null,ve,Q=null,it=null,Xe=null;function Ne(o){return 32/Math.min(o[0],o[1])}function nr(){j=[255,255,255,1],he=new be({color:j}),Ue=[20,2],ae="pixels",ce="pixels",ue=[64,64],_e="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",Ge=new mt({anchor:Ue,anchorOrigin:"bottom-left",anchorXUnits:ae,anchorYUnits:ce,crossOrigin:"anonymous",rotation:0,scale:Ne(ue),size:ue,src:_e}),Je="NO_IMAGE",Ye=new Me({color:j,width:1}),ve=new Me({color:[51,51,51,1],width:2}),Q=new gt({font:"bold 16px Helvetica",fill:he,stroke:ve,scale:.8}),it=new q({fill:he,image:Ge,text:Q,stroke:Ye,zIndex:0}),Xe=[it]}let pe;function rr(o){return o}class or extends Et{constructor(e){super(),e=e||{},Xe||nr(),this.dataProjection=de("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:Xe,this.extractStyles_=e.extractStyles!==void 0?e.extractStyles:!0,this.writeStyles_=e.writeStyles!==void 0?e.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=e.showPointNames!==void 0?e.showPointNames:!0,this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:rr,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,t){const n=f(g,{Document:rt(this.readDocumentOrFolder_,this),Folder:rt(this.readDocumentOrFolder_,this),Placemark:Y(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),r=S([],n,e,t,this);if(r)return r}readPlacemark_(e,t){const n=S({geometry:null},Wn,e,t,this);if(!n)return;const r=new ne,i=e.getAttribute("id");i!==null&&r.setId(i);const s=t[0],l=n.geometry;if(l&&k(l,!1,s),r.setGeometry(l),delete n.geometry,this.extractStyles_){const a=n.Style,u=n.styleUrl,m=sr(a,u,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(m)}return delete n.Style,r.setProperties(n,!0),r}readSharedStyle_(e,t){const n=e.getAttribute("id");if(n!==null){const r=je.call(this,e,t);if(r){let i,s=e.baseURI;(!s||s=="about:blank")&&(s=window.location.href),s?i=new URL("#"+n,s).href:i="#"+n,this.sharedStyles_[i]=r}}}readSharedStyleMap_(e,t){const n=e.getAttribute("id");if(n===null)return;const r=Ft.call(this,e,t);if(!r)return;let i,s=e.baseURI;(!s||s=="about:blank")&&(s=window.location.href),s?i=new URL("#"+n,s).href:i="#"+n,this.sharedStyles_[i]=r}readFeatureFromNode(e,t){if(!g.includes(e.namespaceURI))return null;const n=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return n||null}readFeaturesFromNode(e,t){if(!g.includes(e.namespaceURI))return[];let n;const r=e.localName;if(r=="Document"||r=="Folder")return n=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),n||[];if(r=="Placemark"){const i=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return i?[i]:[]}if(r=="kml"){n=[];for(let i=e.firstElementChild;i;i=i.nextElementSibling){const s=this.readFeaturesFromNode(i,t);s&&P(n,s)}return n}return[]}readName(e){if(e){if(typeof e=="string"){const t=Z(e);return this.readNameFromDocument(t)}return z(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const n=this.readNameFromNode(t);if(n)return n}}readNameFromNode(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(g.includes(t.namespaceURI)&&t.localName=="name")return E(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const n=t.localName;if(g.includes(t.namespaceURI)&&(n=="Document"||n=="Folder"||n=="Placemark"||n=="kml")){const r=this.readNameFromNode(t);if(r)return r}}}readNetworkLinks(e){const t=[];if(typeof e=="string"){const n=Z(e);P(t,this.readNetworkLinksFromDocument(n))}else z(e)?P(t,this.readNetworkLinksFromDocument(e)):P(t,this.readNetworkLinksFromNode(e));return t}readNetworkLinksFromDocument(e){const t=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&P(t,this.readNetworkLinksFromNode(n));return t}readNetworkLinksFromNode(e){const t=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(g.includes(n.namespaceURI)&&n.localName=="NetworkLink"){const r=S({},Jn,n,[]);t.push(r)}for(let n=e.firstElementChild;n;n=n.nextElementSibling){const r=n.localName;g.includes(n.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&P(t,this.readNetworkLinksFromNode(n))}return t}readRegion(e){const t=[];if(typeof e=="string"){const n=Z(e);P(t,this.readRegionFromDocument(n))}else z(e)?P(t,this.readRegionFromDocument(e)):P(t,this.readRegionFromNode(e));return t}readRegionFromDocument(e){const t=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&P(t,this.readRegionFromNode(n));return t}readRegionFromNode(e){const t=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(g.includes(n.namespaceURI)&&n.localName=="Region"){const r=S({},Nt,n,[]);t.push(r)}for(let n=e.firstElementChild;n;n=n.nextElementSibling){const r=n.localName;g.includes(n.namespaceURI)&&(r=="Document"||r=="Folder"||r=="kml")&&P(t,this.readRegionFromNode(n))}return t}readCamera(e){const t=[];if(typeof e=="string"){const n=Z(e);P(t,this.readCameraFromDocument(n))}else z(e)?P(t,this.readCameraFromDocument(e)):P(t,this.readCameraFromNode(e));return t}readCameraFromDocument(e){const t=[];for(let n=e.firstChild;n;n=n.nextSibling)n.nodeType===Node.ELEMENT_NODE&&P(t,this.readCameraFromNode(n));return t}readCameraFromNode(e){const t=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling)if(g.includes(n.namespaceURI)&&n.localName==="Camera"){const r=S({},jn,n,[]);t.push(r)}for(let n=e.firstElementChild;n;n=n.nextElementSibling){const r=n.localName;g.includes(n.namespaceURI)&&(r==="Document"||r==="Folder"||r==="Placemark"||r==="kml")&&P(t,this.readCameraFromNode(n))}return t}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=J(g[4],"kml"),r="http://www.w3.org/2000/xmlns/";n.setAttributeNS(r,"xmlns:gx",b[0]),n.setAttributeNS(r,"xmlns:xsi",Ee),n.setAttributeNS(Ee,"xsi:schemaLocation",Qn);const i={node:n},s={};e.length>1?s.Document=e:e.length==1&&(s.Placemark=e[0]);const l=er[n.namespaceURI],a=M(s,l);return N(i,tr,I,a,[t],l,this),n}}function ir(o,e){const t=[0,0];let n="start";const r=o.getImage();if(r){const l=r.getSize();if(l&&l.length==2){const a=r.getScaleArray(),u=r.getAnchor();t[0]=a[0]*(l[0]-u[0]),t[1]=a[1]*(l[1]/2-u[1]),n="left"}}let i=o.getText();return i?(i=i.clone(),i.setFont(i.getFont()||Q.getFont()),i.setScale(i.getScale()||Q.getScale()),i.setFill(i.getFill()||Q.getFill()),i.setStroke(i.getStroke()||ve)):i=Q.clone(),i.setText(e),i.setOffsetX(t[0]),i.setOffsetY(t[1]),i.setTextAlign(n),new q({image:r,text:i})}function sr(o,e,t,n,r){return function(i,s){let l=r,a="",u=[];if(l){const p=i.getGeometry();if(p)if(p instanceof W)u=p.getGeometriesArrayRecursive().filter(function(h){const x=h.getType();return x==="Point"||x==="MultiPoint"}),l=u.length>0;else{const h=p.getType();l=h==="Point"||h==="MultiPoint"}}l&&(a=i.get("name"),l=l&&!!a,l&&/&[^&]+;/.test(a)&&(pe||(pe=document.createElement("textarea")),pe.innerHTML=a,a=pe.value));let m=t;if(o?m=o:e&&(m=Tt(e,t,n)),l){const p=ir(m[0],a);if(u.length>0){p.setGeometry(new W(u));const h=new q({geometry:m[0].getGeometry(),image:null,fill:m[0].getFill(),stroke:m[0].getStroke(),text:null});return[p,h].concat(m.slice(1))}return p}return m}}function Tt(o,e,t){return Array.isArray(o)?o:typeof o=="string"?Tt(t[o],e,t):e}function xe(o){const e=v(o,!1),t=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(t){const n=t[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function xt(o){let e=v(o,!1);const t=[];e=e.replace(/\s*,\s*/g,",");const n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let r;for(;r=n.exec(e);){const i=parseFloat(r[1]),s=parseFloat(r[2]),l=r[3]?parseFloat(r[3]):0;t.push(i,s,l),e=e.substr(r[0].length)}if(e==="")return t}function At(o){const e=v(o,!1).trim();let t=o.baseURI;return(!t||t=="about:blank")&&(t=window.location.href),t?new URL(e,t).href:e}function Pt(o){const e=v(o,!1).trim().replace(/^(?!.*#)/,"#");let t=o.baseURI;return(!t||t=="about:blank")&&(t=window.location.href),t?new URL(e,t).href:e}function lr(o){const e=o.getAttribute("xunits"),t=o.getAttribute("yunits");let n;return e!=="insetPixels"?t!=="insetPixels"?n="bottom-left":n="top-left":t!=="insetPixels"?n="bottom-right":n="top-right",{x:parseFloat(o.getAttribute("x")),xunits:ot[e],y:parseFloat(o.getAttribute("y")),yunits:ot[t],origin:n}}function Lt(o){return R(o)}const ar=f(g,{Pair:Dr});function Ft(o,e){return S(void 0,ar,o,e,this)}const cr=f(g,{Icon:c(Tr),color:c(xe),heading:c(R),hotSpot:c(lr),scale:c(Lt)});function ur(o,e){const t=S({},cr,o,e);if(!t)return;const n=e[e.length-1],r="Icon"in t?t.Icon:{},i=!("Icon"in t)||Object.keys(r).length>0;let s;const l=r.href;l?s=l:i&&(s=_e);let a,u,m,p="bottom-left";const h=t.hotSpot;h?(a=[h.x,h.y],u=h.xunits,m=h.yunits,p=h.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(s)&&(s.includes("pushpin")?(a=Ue,u=ae,m=ce):s.includes("arrow-reverse")?(a=[54,42],u=ae,m=ce):s.includes("paddle")&&(a=[32,1],u=ae,m=ce));let x;const A=r.x,U=r.y;A!==void 0&&U!==void 0&&(x=[A,U]);let T;const y=r.w,O=r.h;y!==void 0&&O!==void 0&&(T=[y,O]);let D;const F=t.heading;F!==void 0&&(D=Jt(F));const K=t.scale,G=t.color;if(i){s==_e&&(T=ue);const w=new mt({anchor:a,anchorOrigin:p,anchorXUnits:u,anchorYUnits:m,crossOrigin:this.crossOrigin_,offset:x,offsetOrigin:"bottom-left",rotation:D,scale:K,size:T,src:this.iconUrlFunction_(s),color:G}),H=w.getScaleArray()[0],Fe=w.getSize();if(Fe===null){const oe=w.getImageState();if(oe===se.IDLE||oe===se.LOADING){const tt=function(){const nt=w.getImageState();if(!(nt===se.IDLE||nt===se.LOADING)){const we=w.getSize();if(we&&we.length==2){const Zt=Ne(we);w.setScale(H*Zt)}w.unlistenImageChange(tt)}};w.listenImageChange(tt),oe===se.IDLE&&w.load()}}else if(Fe.length==2){const oe=Ne(Fe);w.setScale(H*oe)}n.imageStyle=w}else n.imageStyle=Je}const dr=f(g,{color:c(xe),scale:c(Lt)});function fr(o,e){const t=S({},dr,o,e);if(!t)return;const n=e[e.length-1],r=new gt({fill:new be({color:"color"in t?t.color:j}),scale:t.scale});n.textStyle=r}const mr=f(g,{color:c(xe),width:c(R)});function gr(o,e){const t=S({},mr,o,e);if(!t)return;const n=e[e.length-1],r=new Me({color:"color"in t?t.color:j,width:"width"in t?t.width:1});n.strokeStyle=r}const pr=f(g,{color:c(xe),fill:c(B),outline:c(B)});function hr(o,e){const t=S({},pr,o,e);if(!t)return;const n=e[e.length-1],r=new be({color:"color"in t?t.color:j});n.fillStyle=r;const i=t.fill;i!==void 0&&(n.fill=i);const s=t.outline;s!==void 0&&(n.outline=s)}const yr=f(g,{coordinates:ze(xt)});function wt(o,e){return S(null,yr,o,e)}function Er(o,e){const n=e[e.length-1].coordinates,r=v(o,!1),s=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(r);if(s){const l=parseFloat(s[1]),a=parseFloat(s[2]),u=parseFloat(s[3]);n.push([l,a,u])}else n.push([])}const Sr=f(b,{Track:Y(It)});function Rr(o,e){const t=S([],Sr,o,e);if(t)return new Te(t)}const _r=f(g,{when:$r},f(b,{coord:Er}));function It(o,e){const t=S({coordinates:[],whens:[]},_r,o,e);if(!t)return;const n=[],r=t.coordinates,i=t.whens;for(let s=0,l=Math.min(r.length,i.length);s<l;++s)r[s].length==3&&n.push(r[s][0],r[s][1],r[s][2],i[s]);return new fe(n,"XYZM")}const Nr=f(g,{href:c(At)},f(b,{x:c(R),y:c(R),w:c(R),h:c(R)}));function Tr(o,e){const t=S({},Nr,o,e);return t||null}const xr=f(g,{coordinates:ze(xt)});function qe(o,e){return S(null,xr,o,e)}const Ae=f(g,{extrude:c(B),tessellate:c(B),altitudeMode:c(E)});function Ot(o,e){const t=S({},Ae,o,e),n=qe(o,e);if(n){const r=new fe(n,"XYZ");return r.setProperties(t,!0),r}}function Dt(o,e){const t=S({},Ae,o,e),n=qe(o,e);if(n){const r=new Ke(n,"XYZ",[n.length]);return r.setProperties(t,!0),r}}const Ar=f(g,{LineString:Y(Ot),LinearRing:Y(Dt),MultiGeometry:Y(Ct),Point:Y(Mt),Polygon:Y(Ut)});function Ct(o,e){const t=S([],Ar,o,e);if(!t)return null;if(t.length===0)return new W(t);let n,r=!0;const i=t[0].getType();let s;for(let l=1,a=t.length;l<a;++l)if(s=t[l],s.getType()!=i){r=!1;break}if(r){let l,a;if(i=="Point"){const u=t[0];l=u.getLayout(),a=u.getFlatCoordinates();for(let m=1,p=t.length;m<p;++m)s=t[m],P(a,s.getFlatCoordinates());n=new dt(a,l),De(n,t)}else if(i=="LineString")n=new Te(t),De(n,t);else if(i=="Polygon")n=new ft(t),De(n,t);else if(i=="GeometryCollection")n=new W(t);else throw new Error("Unknown geometry type found")}else n=new W(t);return n}function Mt(o,e){const t=S({},Ae,o,e),n=qe(o,e);if(n){const r=new ke(n,"XYZ");return r.setProperties(t,!0),r}}const Pr=f(g,{innerBoundaryIs:br,outerBoundaryIs:Zr});function Ut(o,e){const t=S({},Ae,o,e),n=S([null],Pr,o,e);if(n&&n[0]){const r=n[0],i=[r.length];for(let l=1,a=n.length;l<a;++l)P(r,n[l]),i.push(r.length);const s=new Ke(r,"XYZ",i);return s.setProperties(t,!0),s}}const Lr=f(g,{IconStyle:ur,LabelStyle:fr,LineStyle:gr,PolyStyle:hr});function je(o,e){const t=S({},Lr,o,e,this);if(!t)return null;let n="fillStyle"in t?t.fillStyle:he;const r=t.fill;r!==void 0&&!r&&(n=null);let i;"imageStyle"in t?t.imageStyle!=Je&&(i=t.imageStyle):i=Ge;const s="textStyle"in t?t.textStyle:Q,l="strokeStyle"in t?t.strokeStyle:Ye,a=t.outline;return a!==void 0&&!a?[new q({geometry:function(u){const m=u.getGeometry(),p=m.getType();if(p==="GeometryCollection"){const h=m;return new W(h.getGeometriesArrayRecursive().filter(function(x){const A=x.getType();return A!=="Polygon"&&A!=="MultiPolygon"}))}if(p!=="Polygon"&&p!=="MultiPolygon")return m},fill:n,image:i,stroke:l,text:s,zIndex:void 0}),new q({geometry:function(u){const m=u.getGeometry(),p=m.getType();if(p==="GeometryCollection"){const h=m;return new W(h.getGeometriesArrayRecursive().filter(function(x){const A=x.getType();return A==="Polygon"||A==="MultiPolygon"}))}if(p==="Polygon"||p==="MultiPolygon")return m},fill:n,stroke:null,zIndex:void 0})]:[new q({fill:n,image:i,stroke:l,text:s,zIndex:void 0})]}function De(o,e){const t=e.length,n=new Array(e.length),r=new Array(e.length),i=new Array(e.length);let s,l,a;s=!1,l=!1,a=!1;for(let u=0;u<t;++u){const m=e[u];n[u]=m.get("extrude"),r[u]=m.get("tessellate"),i[u]=m.get("altitudeMode"),s=s||n[u]!==void 0,l=l||r[u]!==void 0,a=a||i[u]}s&&o.set("extrude",n),l&&o.set("tessellate",r),a&&o.set("altitudeMode",i)}const Fr=f(g,{displayName:c(E),value:c(E)});function wr(o,e){const t=o.getAttribute("name");$(Fr,o,e);const n=e[e.length-1];t&&n.displayName?n[t]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:t!==null?n[t]=n.value:n.displayName!==null&&(n[n.displayName]=n.value),delete n.value}const Ir=f(g,{Data:wr,SchemaData:Ur});function Gt(o,e){$(Ir,o,e)}function Yt(o,e){$(Nt,o,e)}const Or=f(g,{Style:c(je),key:c(E),styleUrl:c(Pt)});function Dr(o,e){const t=S({},Or,o,e,this);if(!t)return;const n=t.key;if(n&&n=="normal"){const r=t.styleUrl;r&&(e[e.length-1]=r);const i=t.Style;i&&(e[e.length-1]=i)}}function Cr(o,e){const t=Ft.call(this,o,e);if(!t)return;const n=e[e.length-1];if(Array.isArray(t))n.Style=t;else if(typeof t=="string")n.styleUrl=t;else throw new Error("`styleMapValue` has an unknown type")}const Mr=f(g,{SimpleData:Gr});function Ur(o,e){$(Mr,o,e)}function Gr(o,e){const t=o.getAttribute("name");if(t!==null){const n=E(o),r=e[e.length-1];r[t]=n}}const Yr=f(g,{altitudeMode:c(E),minAltitude:c(R),maxAltitude:c(R),north:c(R),south:c(R),east:c(R),west:c(R)});function vr(o,e){const t=S({},Yr,o,e);if(!t)return;const n=e[e.length-1],r=[parseFloat(t.west),parseFloat(t.south),parseFloat(t.east),parseFloat(t.north)];n.extent=r,n.altitudeMode=t.altitudeMode,n.minAltitude=parseFloat(t.minAltitude),n.maxAltitude=parseFloat(t.maxAltitude)}const Xr=f(g,{minLodPixels:c(R),maxLodPixels:c(R),minFadeExtent:c(R),maxFadeExtent:c(R)});function kr(o,e){const t=S({},Xr,o,e);if(!t)return;const n=e[e.length-1];n.minLodPixels=parseFloat(t.minLodPixels),n.maxLodPixels=parseFloat(t.maxLodPixels),n.minFadeExtent=parseFloat(t.minFadeExtent),n.maxFadeExtent=parseFloat(t.maxFadeExtent)}const Kr=f(g,{LinearRing:Y(wt)});function br(o,e){const t=S([],Kr,o,e);t.length>0&&e[e.length-1].push(...t)}const zr=f(g,{LinearRing:ze(wt)});function Zr(o,e){const t=S(void 0,zr,o,e);if(t){const n=e[e.length-1];n[0]=t}}function Br(o,e){$(qn,o,e)}function $r(o,e){const n=e[e.length-1].whens,r=v(o,!1),i=Date.parse(r);n.push(isNaN(i)?0:i)}function Pe(o,e){const t=Wt(e),r=[(t.length==4?t[3]:1)*255,t[2],t[1],t[0]];for(let i=0;i<4;++i){const s=Math.floor(r[i]).toString(16);r[i]=s.length==1?"0"+s:s}_(o,r.join(""))}function Hr(o,e,t){const n=t[t.length-1],r=n.layout,i=n.stride;let s;if(r=="XY"||r=="XYM")s=2;else if(r=="XYZ"||r=="XYZM")s=3;else throw new Error("Invalid geometry layout");const l=e.length;let a="";if(l>0){a+=e[0];for(let u=1;u<s;++u)a+=","+e[u];for(let u=i;u<l;u+=i){a+=" "+e[u];for(let m=1;m<s;++m)a+=","+e[u+m]}}_(o,a)}const ye=f(g,{Data:d(Vr),value:d(Wr),displayName:d(Qr)});function Vr(o,e,t){o.setAttribute("name",e.name);const n={node:o},r=e.value;typeof r=="object"?(r!==null&&r.displayName&&N(n,ye,I,[r.displayName],t,["displayName"]),r!==null&&r.value&&N(n,ye,I,[r.value],t,["value"])):N(n,ye,I,[r],t,["value"])}function Qr(o,e){an(o,e)}function Wr(o,e){_(o,e)}const Jr=f(g,{Placemark:d(kt)}),qr=function(o,e,t){const n=e[e.length-1].node;return J(n.namespaceURI,"Placemark")};function jr(o,e,t){N({node:o},Jr,qr,e,t,void 0,this)}const eo=X("Data");function to(o,e,t){const n={node:o},r=e.names,i=e.values,s=r.length;for(let l=0;l<s;l++)N(n,ye,eo,[{name:r[l],value:i[l]}],t)}const st=f(g,["href"],f(b,["x","y","w","h"])),lt=f(g,{href:d(_)},f(b,{x:d(C),y:d(C),w:d(C),h:d(C)})),no=function(o,e,t){return J(b[0],"gx:"+t)};function ro(o,e,t){const n={node:o},r=t[t.length-1].node;let i=st[r.namespaceURI],s=M(e,i);N(n,lt,I,s,t,i),i=st[b[0]],s=M(e,i),N(n,lt,no,s,t,i)}const oo=f(g,["scale","heading","Icon","color","hotSpot"]),io=f(g,{Icon:d(ro),color:d(Pe),heading:d(C),hotSpot:d(Co),scale:d(bt)});function so(o,e,t){const n={node:o},r={},i=e.getSrc(),s=e.getSize(),l=e.getImageSize(),a={href:i};if(s){a.w=s[0],a.h=s[1];const T=e.getAnchor(),y=e.getOrigin();if(y&&l&&y[0]!==0&&y[1]!==s[1]&&(a.x=y[0],a.y=l[1]-(y[1]+s[1])),T&&(T[0]!==s[0]/2||T[1]!==s[1]/2)){const O={x:T[0],xunits:"pixels",y:s[1]-T[1],yunits:"pixels"};r.hotSpot=O}}r.Icon=a;let u=e.getScaleArray()[0],m=s;if(m===null&&(m=ue),m.length==2){const T=Ne(m);u=u/T}u!==1&&(r.scale=u);const p=e.getRotation();p!==0&&(r.heading=p);const h=e.getColor();h&&(r.color=h);const x=t[t.length-1].node,A=oo[x.namespaceURI],U=M(r,A);N(n,io,I,U,t,A)}const lo=f(g,["color","scale"]),ao=f(g,{color:d(Pe),scale:d(bt)});function co(o,e,t){const n={node:o},r={},i=e.getFill();i&&(r.color=i.getColor());const s=e.getScale();s&&s!==1&&(r.scale=s);const l=t[t.length-1].node,a=lo[l.namespaceURI],u=M(r,a);N(n,ao,I,u,t,a)}const uo=f(g,["color","width"]),fo=f(g,{color:d(Pe),width:d(C)});function mo(o,e,t){const n={node:o},r={color:e.getColor(),width:Number(e.getWidth())||1},i=t[t.length-1].node,s=uo[i.namespaceURI],l=M(r,s);N(n,fo,I,l,t,s)}const go={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},vt=function(o,e,t){if(o){const n=e[e.length-1].node;return J(n.namespaceURI,go[o.getType()])}},po=X("Point"),ho=X("LineString"),yo=X("LinearRing"),Eo=X("Polygon"),So=f(g,{LineString:d(ee),Point:d(ee),Polygon:d(Kt),GeometryCollection:d(Xt)});function Xt(o,e,t){const n={node:o},r=e.getType();let i=[],s;if(r==="GeometryCollection")e.getGeometriesArrayRecursive().forEach(function(l){const a=l.getType();if(a==="MultiPoint")i=i.concat(l.getPoints());else if(a==="MultiLineString")i=i.concat(l.getLineStrings());else if(a==="MultiPolygon")i=i.concat(l.getPolygons());else if(a==="Point"||a==="LineString"||a==="Polygon")i.push(l);else throw new Error("Unknown geometry type")}),s=vt;else if(r==="MultiPoint")i=e.getPoints(),s=po;else if(r==="MultiLineString")i=e.getLineStrings(),s=ho;else if(r==="MultiPolygon")i=e.getPolygons(),s=Eo;else throw new Error("Unknown geometry type");N(n,So,s,i,t)}const Ro=f(g,{LinearRing:d(ee)});function at(o,e,t){N({node:o},Ro,yo,[e],t)}const Ce=f(g,{ExtendedData:d(to),MultiGeometry:d(Xt),LineString:d(ee),LinearRing:d(ee),Point:d(ee),Polygon:d(Kt),Style:d(Do),address:d(_),description:d(_),name:d(_),open:d(te),phoneNumber:d(_),styleUrl:d(_),visibility:d(te)}),_o=f(g,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),No=X("ExtendedData");function kt(o,e,t){const n={node:o};e.getId()&&o.setAttribute("id",e.getId());const r=e.getProperties(),i={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};i[e.getGeometryName()]=1;const s=Object.keys(r||{}).sort().filter(function(x){return!i[x]}),l=e.getStyleFunction();if(l){const x=l(e,0);if(x){const A=Array.isArray(x)?x:[x];let U=A;if(e.getGeometry()&&(U=A.filter(function(T){const y=T.getGeometryFunction()(e);if(y){const O=y.getType();return O==="GeometryCollection"?y.getGeometriesArrayRecursive().filter(function(D){const F=D.getType();return F==="Point"||F==="MultiPoint"}).length:O==="Point"||O==="MultiPoint"}})),this.writeStyles_){let T=A,y=A;e.getGeometry()&&(T=A.filter(function(O){const D=O.getGeometryFunction()(e);if(D){const F=D.getType();return F==="GeometryCollection"?D.getGeometriesArrayRecursive().filter(function(K){const G=K.getType();return G==="LineString"||G==="MultiLineString"}).length:F==="LineString"||F==="MultiLineString"}}),y=A.filter(function(O){const D=O.getGeometryFunction()(e);if(D){const F=D.getType();return F==="GeometryCollection"?D.getGeometriesArrayRecursive().filter(function(K){const G=K.getType();return G==="Polygon"||G==="MultiPolygon"}).length:F==="Polygon"||F==="MultiPolygon"}})),r.Style={pointStyles:U,lineStyles:T,polyStyles:y}}if(U.length&&r.name===void 0){const T=U[0].getText();T&&(r.name=T.getText())}}}const a=t[t.length-1].node,u=_o[a.namespaceURI],m=M(r,u);if(N(n,Ce,I,m,t,u),s.length>0){const x=M(r,s);N(n,Ce,No,[{names:s,values:x}],t)}const p=t[0];let h=e.getGeometry();h&&(h=k(h,!0,p)),N(n,Ce,vt,[h],t)}const To=f(g,["extrude","tessellate","altitudeMode","coordinates"]),xo=f(g,{extrude:d(te),tessellate:d(te),altitudeMode:d(_),coordinates:d(Hr)});function ee(o,e,t){const n=e.getFlatCoordinates(),r={node:o};r.layout=e.getLayout(),r.stride=e.getStride();const i=e.getProperties();i.coordinates=n;const s=t[t.length-1].node,l=To[s.namespaceURI],a=M(i,l);N(r,xo,I,a,t,l)}const Ao=f(g,["color","fill","outline"]),ct=f(g,{outerBoundaryIs:d(at),innerBoundaryIs:d(at)}),Po=X("innerBoundaryIs"),Lo=X("outerBoundaryIs");function Kt(o,e,t){const n=e.getLinearRings(),r=n.shift(),i={node:o};N(i,ct,Po,n,t),N(i,ct,Lo,[r],t)}const Fo=f(g,{color:d(Pe),fill:d(te),outline:d(te)});function wo(o,e,t){const n={node:o},r=e.getFill(),i=e.getStroke(),s={color:r?r.getColor():void 0,fill:r?void 0:!1,outline:i?void 0:!1},l=t[t.length-1].node,a=Ao[l.namespaceURI],u=M(s,a);N(n,Fo,I,u,t,a)}function bt(o,e){C(o,Math.round(e*1e6)/1e6)}const Io=f(g,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),Oo=f(g,{IconStyle:d(so),LabelStyle:d(co),LineStyle:d(mo),PolyStyle:d(wo)});function Do(o,e,t){const n={node:o},r={};if(e.pointStyles.length){const a=e.pointStyles[0].getText();a&&(r.LabelStyle=a);const u=e.pointStyles[0].getImage();u&&typeof u.getSrc=="function"&&(r.IconStyle=u)}if(e.lineStyles.length){const a=e.lineStyles[0].getStroke();a&&(r.LineStyle=a)}if(e.polyStyles.length){const a=e.polyStyles[0].getStroke();a&&!r.LineStyle&&(r.LineStyle=a),r.PolyStyle=e.polyStyles[0]}const i=t[t.length-1].node,s=Io[i.namespaceURI],l=M(r,s);N(n,Oo,I,l,t,s)}function Co(o,e){o.setAttribute("x",String(e.x)),o.setAttribute("y",String(e.y)),o.setAttribute("xunits",e.xunits),o.setAttribute("yunits",e.yunits)}const ni=or;class Mo extends qt{constructor(e){super(),e=e||{},this.layerName_=e.layerName,this.layers_=e.layers?e.layers:null,this.dataProjection=de(e.dataProjection?e.dataProjection:"EPSG:4326")}readFeaturesFromObject(e,t){if(e.type=="Topology"){const n=e;let r,i=null,s=null;n.transform&&(r=n.transform,i=r.scale,s=r.translate);const l=n.arcs;r&&zo(l,i,s);const a=[],u=n.objects,m=this.layerName_;let p;for(const h in u)this.layers_&&!this.layers_.includes(h)||(u[h].type==="GeometryCollection"?(p=u[h],a.push.apply(a,bo(p,l,i,s,m,h,t))):(p=u[h],a.push(zt(p,l,i,s,m,h,t))));return a}return[]}readProjectionFromObject(e){return this.dataProjection}}const Uo={Point:Go,LineString:vo,Polygon:ko,MultiPoint:Yo,MultiLineString:Xo,MultiPolygon:Ko};function Le(o,e){const t=[];let n;for(let r=0,i=o.length;r<i;++r)if(n=o[r],r>0&&t.pop(),n>=0){const s=e[n];for(let l=0,a=s.length;l<a;++l)t.push(s[l].slice(0))}else{const s=e[~n];for(let l=s.length-1;l>=0;--l)t.push(s[l].slice(0))}return t}function Go(o,e,t){const n=o.coordinates;return e&&t&&et(n,e,t),new ke(n)}function Yo(o,e,t){const n=o.coordinates;if(e&&t)for(let r=0,i=n.length;r<i;++r)et(n[r],e,t);return new dt(n)}function vo(o,e){const t=Le(o.arcs,e);return new fe(t)}function Xo(o,e){const t=[];for(let n=0,r=o.arcs.length;n<r;++n)t[n]=Le(o.arcs[n],e);return new Te(t)}function ko(o,e){const t=[];for(let n=0,r=o.arcs.length;n<r;++n)t[n]=Le(o.arcs[n],e);return new Ke(t)}function Ko(o,e){const t=[];for(let n=0,r=o.arcs.length;n<r;++n){const i=o.arcs[n],s=[];for(let l=0,a=i.length;l<a;++l)s[l]=Le(i[l],e);t[n]=s}return new ft(t)}function bo(o,e,t,n,r,i,s){const l=o.geometries,a=[];for(let u=0,m=l.length;u<m;++u)a[u]=zt(l[u],e,t,n,r,i,s);return a}function zt(o,e,t,n,r,i,s){let l=null;const a=o.type;if(a){const p=Uo[a];a==="Point"||a==="MultiPoint"?l=p(o,t,n):l=p(o,e),l=k(l,!1,s)}const u=new ne({geometry:l});o.id!==void 0&&u.setId(o.id);let m=o.properties;return r&&(m||(m={}),m[r]=i),m&&u.setProperties(m,!0),u}function zo(o,e,t){for(let n=0,r=o.length;n<r;++n)Zo(o[n],e,t)}function Zo(o,e,t){let n=0,r=0;for(let i=0,s=o.length;i<s;++i){const l=o[i];n+=l[0],r+=l[1],l[0]=n,l[1]=r,et(l,e,t)}}function et(o,e,t){o[0]=o[0]*e[0]+t[0],o[1]=o[1]*e[1]+t[1]}const ri=Mo;export{jo as D,ei as G,ti as I,ni as K,ri as T};
