var v=Object.defineProperty;var m=(d,t,e)=>t in d?v(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var x=(d,t,e)=>(m(d,typeof t!="symbol"?t+"":t,e),e);import{aG as T,aH as E,aI as u,aJ as I,aK as p,Q as _,a8 as P,ag as L,ah as D,ai as M,_ as h,aL as z,aM as l,a4 as w}from"./Layer-3b715193.js";class b{constructor(){x(this,"pushMethodArgs_",(...t)=>(this.instructions_[this.zIndex+this.offset_].push(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(t,e)=>{if(typeof T()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(t,e,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,n),!0)})}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let n=0,r=e.length;n<r;n+=2){const s=e[n],i=e[n+1];if(typeof t[s]=="function")t[s](...i);else{if(typeof i=="function"){t[s]=i(t);continue}t[s]=i}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const N=b,q=[];let c=null;function k(){c=_(1,1,void 0,{willReadFrequently:!0})}class B extends E{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=u(),this.pixelTransform=u(),this.inversePixelTransform=u(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,n){c||k(),c.clearRect(0,0,1,1);let r;try{c.drawImage(t,e,n,1,1,0,0,1,1),r=c.getImageData(0,0,1,1).data}catch{return c=null,null}return r}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,e,n){const r=this.getLayer().getClassName();let s,i;if(t&&t.className===r&&(!n||t&&t.style.backgroundColor&&I(p(t.style.backgroundColor),p(n)))){const o=t.firstElementChild;o instanceof HTMLCanvasElement&&(i=o.getContext("2d"))}if(i&&i.canvas.style.transform===e?(this.container=t,this.context=i,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let o=s.style;o.position="absolute",o.width="100%",o.height="100%",i=_();const a=i.canvas;s.appendChild(a),o=a.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=s,this.context=i}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const r=P(n),s=L(n),i=D(n),o=M(n);h(e.coordinateToPixelTransform,r),h(e.coordinateToPixelTransform,s),h(e.coordinateToPixelTransform,i),h(e.coordinateToPixelTransform,o);const a=this.inversePixelTransform;h(a,r),h(a,s),h(a,i),h(a,o),t.save(),t.beginPath(),t.moveTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}dispatchRenderEvent_(t,e,n){const r=this.getLayer();if(r.hasListener(t)){const s=new z(t,this.inversePixelTransform,n,e);r.dispatchEvent(s)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(l.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(l.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new N),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(l.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(l.POSTRENDER,this.context,t))}getRenderTransform(t,e,n,r,s,i,o){const a=s/2,g=i/2,f=r/e,R=-f,C=-t[0]+o,y=-t[1];return w(this.tempTransform,a,g,f,R,-n,C,y)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const A=B;export{A as C,N as Z,q as c};
