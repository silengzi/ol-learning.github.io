import{j as d,k as g,l as f,m as a,i as F}from"./TileProperty-e33ea24b.js";import{ak as T,a3 as U,Z as c}from"./Layer-3b715193.js";function p(r,e){const t=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,l=/\{-y\}/g;return function(s,E,R){if(s)return r.replace(t,s[0].toString()).replace(n,s[1].toString()).replace(i,s[2].toString()).replace(l,function(){const h=s[0],u=e.getFullTileRange(h);if(!u)throw new Error("The {-y} placeholder requires a tile grid with extent");return(u.getHeight()-s[2]-1).toString()})}}function y(r,e){const t=r.length,n=new Array(t);for(let i=0;i<t;++i)n[i]=p(r[i],e);return x(n)}function x(r){return r.length===1?r[0]:function(e,t,n){if(!e)return;const i=d(e),l=T(i,r.length);return r[l](e,t,n)}}function L(r){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(r);if(t){const n=t[1].charCodeAt(0),i=t[2].charCodeAt(0);let l;for(l=n;l<=i;++l)e.push(r.replace(t[0],String.fromCharCode(l)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(r),t){const n=parseInt(t[2],10);for(let i=parseInt(t[1],10);i<=n;i++)e.push(r.replace(t[0],i.toString()));return e}return e.push(r),e}class o extends g{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===o.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,n=U(t),i=t.getState();let l;i==c.LOADING?(this.tileLoadingKeys_[n]=!0,l=a.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],l=i==c.ERROR?a.TILELOADERROR:i==c.LOADED?a.TILELOADEND:void 0),l!=null&&this.dispatchEvent(new f(l,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=L(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(y(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,n){}useTile(e,t,n){const i=F(e,t,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}}const z=o;export{z as U,y as a,x as c,L as e};
