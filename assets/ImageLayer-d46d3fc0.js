import{cI as W,c2 as d,w as Y,a1 as M,aO as N,cm as $,_ as z,$ as F,e as O,a0 as b,a4 as j,a6 as U,a5 as X,i as B,aQ as Q}from"./Layer-3b715193.js";import{C as V}from"./Layer-37ea9c2e.js";function Z(u){return Array.isArray(u)?Math.min(...u):u}class q extends W{constructor(t,h,r,i,s){const n=s!==void 0?d.IDLE:d.LOADED;super(t,h,r,n),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=d.ERROR):this.state=d.LOADED,this.changed()}load(){this.state==d.IDLE&&(this.state=d.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const tt=q;class J extends V{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const h=t.layerStatesArray[t.layerIndex],r=t.pixelRatio,i=t.viewState,s=i.resolution,n=this.getLayer().getSource(),o=t.viewHints;let a=t.extent;if(h.extent!==void 0&&(a=Y(a,M(h.extent,i.projection))),!o[N.ANIMATING]&&!o[N.INTERACTING]&&!$(a))if(n){const l=i.projection,e=n.getImage(a,s,r,l);e&&(this.loadImage(e)?this.image_=e:e.getState()===d.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const h=this.frameState;if(!h)return null;const r=this.getLayer(),i=z(h.pixelToCoordinateTransform,t.slice()),s=r.getExtent();if(s&&!F(s,i))return null;const n=this.image_.getExtent(),o=this.image_.getImage(),a=O(n),l=Math.floor(o.width*((i[0]-n[0])/a));if(l<0||l>=o.width)return null;const e=b(n),g=Math.floor(o.height*((n[3]-i[1])/e));return g<0||g>=o.height?null:this.getImageData(o,l,g)}renderFrame(t,h){const r=this.image_,i=r.getExtent(),s=r.getResolution(),[n,o]=Array.isArray(s)?s:[s,s],a=r.getPixelRatio(),l=t.layerStatesArray[t.layerIndex],e=t.pixelRatio,g=t.viewState,_=g.center,L=g.resolution,H=e*n/(L*a),P=e*o/(L*a),A=t.extent,C=g.resolution,k=g.rotation,x=Math.round(O(A)/C*e),p=Math.round(b(A)/C*e);j(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/e,1/e,k,-x/2,-p/2),U(this.inversePixelTransform,this.pixelTransform);const R=X(this.pixelTransform);this.useContainer(h,R,this.getBackground(t));const c=this.getRenderContext(t),m=this.context.canvas;m.width!=x||m.height!=p?(m.width=x,m.height=p):this.containerReused||c.clearRect(0,0,x,p);let v=!1,E=!0;if(l.extent){const I=M(l.extent,g.projection);E=B(I,t.extent),v=E&&!Q(I,t.extent),v&&this.clipUnrotated(c,t,I)}const f=r.getImage(),y=j(this.tempTransform,x/2,p/2,H,P,0,a*(i[0]-_[0])/n,a*(_[1]-i[3])/o);this.renderedResolution=o*e/a;const T=f.width*y[0],D=f.height*y[3];if(this.getLayer().getSource().getInterpolate()||(c.imageSmoothingEnabled=!1),this.preRender(c,t),E&&T>=.5&&D>=.5){const I=y[4],G=y[5],w=l.opacity;w!==1&&(c.save(),c.globalAlpha=w),c.drawImage(f,0,0,+f.width,+f.height,I,G,T,D),w!==1&&c.restore()}return this.postRender(this.context,t),v&&c.restore(),c.imageSmoothingEnabled=!0,R!==m.style.transform&&(m.style.transform=R),this.container}}const et=J;export{et as C,tt as I,Z as f};
